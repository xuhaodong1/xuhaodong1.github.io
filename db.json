{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/images/avatar.jpeg","path":"images/avatar.jpeg","modified":1,"renderable":0},{"_id":"source/images/logo.png","path":"images/logo.png","modified":1,"renderable":0},{"_id":"source/images/Common/android-chrome-192x192.png","path":"images/Common/android-chrome-192x192.png","modified":1,"renderable":0},{"_id":"source/images/Common/android-chrome-512x512.png","path":"images/Common/android-chrome-512x512.png","modified":1,"renderable":0},{"_id":"source/images/Common/apple-touch-icon.png","path":"images/Common/apple-touch-icon.png","modified":1,"renderable":0},{"_id":"source/images/Common/favicon-16x16.png","path":"images/Common/favicon-16x16.png","modified":1,"renderable":0},{"_id":"source/images/Common/favicon-32x32.png","path":"images/Common/favicon-32x32.png","modified":1,"renderable":0},{"_id":"source/images/Common/safari-pinned-tab.svg","path":"images/Common/safari-pinned-tab.svg","modified":1,"renderable":0},{"_id":"themes/stun/source/js/header.js","path":"js/header.js","modified":1,"renderable":1},{"_id":"themes/stun/source/js/scroll.js","path":"js/scroll.js","modified":1,"renderable":1},{"_id":"themes/stun/source/js/sidebar.js","path":"js/sidebar.js","modified":1,"renderable":1},{"_id":"themes/stun/source/js/stun-boot.js","path":"js/stun-boot.js","modified":1,"renderable":1},{"_id":"themes/stun/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/stun/source/images/algolia.svg","path":"images/algolia.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/images/loading.svg","path":"images/loading.svg","modified":1,"renderable":1},{"_id":"themes/stun/source/css/index.styl","path":"css/index.styl","modified":1,"renderable":1},{"_id":"themes/stun/source/images/icons/favicon-16x16.png","path":"images/icons/favicon-16x16.png","modified":1,"renderable":1},{"_id":"themes/stun/source/images/icons/favicon-32x32.png","path":"images/icons/favicon-32x32.png","modified":1,"renderable":1},{"_id":"themes/stun/source/images/icons/stun-logo.svg","path":"images/icons/stun-logo.svg","modified":1,"renderable":1}],"Cache":[{"_id":"source/categories/index.md","hash":"a5983c49174d91e4836ddf9d857475e2147b2345","modified":1635993929054},{"_id":"source/_posts/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³.md","hash":"06972a6085522c782f8be9b591030662257535c2","modified":1632981868614},{"_id":"source/_posts/2021-11-03-iOSç¼–è¯‘è¿‡ç¨‹.md","hash":"619c7fcb8fd0f3660bbe09c3ed3dfdf75b9af4d6","modified":1636007574165},{"_id":"source/tags/index.md","hash":"dd6913d248820047ffced5b07ea79af0ab59f7c2","modified":1635993966706},{"_id":"source/.DS_Store","hash":"6df395b19e8da87cef39c5095989d43f5b281355","modified":1636006541654},{"_id":"source/_posts/.DS_Store","hash":"1ae6ee2b130110b301978ff75398d3b160276c78","modified":1636009974492},{"_id":"source/tags/.DS_Store","hash":"34fe290bc8d934cf4c51deea76c7ec16f3cf4d2f","modified":1635993979770},{"_id":"source/images/.DS_Store","hash":"ebef34085880350ef1e9f36a899b852a113de135","modified":1636005985707},{"_id":"source/images/Common/favicon-16x16.png","hash":"a08b6dcee35a779728fd8913a4760ddefb349351","modified":1635997269000},{"_id":"source/images/avatar.jpeg","hash":"18b2e6c338238f0f5182b5e17f04917f766dbb07","modified":1635994494511},{"_id":"source/images/Common/android-chrome-192x192.png","hash":"3476e26eace27a2527d8b0b29b354414a5b97da1","modified":1635997268000},{"_id":"source/images/Common/favicon-32x32.png","hash":"a4e7bb814ec13c73b94a46b76bf48502d2f5c0bd","modified":1635997269000},{"_id":"source/images/Common/safari-pinned-tab.svg","hash":"e8e13aeb58933f948310ea05b6bec212f8eea416","modified":1635997270000},{"_id":"source/images/Common/.DS_Store","hash":"8627dfe4667b87a9ef714f5d40de458acd28f295","modified":1636006541652},{"_id":"source/images/Common/apple-touch-icon.png","hash":"ad6ba7b0df1de25d56361db8e681989f3ad896ea","modified":1635997269000},{"_id":"source/images/logo.png","hash":"e3d0494e7d14edf0fcd8087bb5aa4bfa919d72b2","modified":1635994494519},{"_id":"source/images/Common/android-chrome-512x512.png","hash":"de244e4eae54cc80fbb05e552ad41c4f2178fd80","modified":1635997269000},{"_id":"themes/stun/_config.yml","hash":"3edc10a7954c55cc5a8e8ff838d14b28a4744ab4","modified":1636006261946},{"_id":"themes/stun/package.json","hash":"3a8970ff8499ddd68a3d23ce16c0eb73074a2ccd","modified":1635993607776},{"_id":"themes/stun/languages/zh-CN.yml","hash":"8535e2d34d24769067ba7bd3d9c0b94d1fd01cc7","modified":1635993607765},{"_id":"themes/stun/languages/es.yml","hash":"e150c8a1f56ae9ed065611951aa124fb548577fc","modified":1635993607765},{"_id":"themes/stun/languages/en.yml","hash":"e1348852aa00d2d57f5215c83709f6428f8e8a71","modified":1635993607764},{"_id":"themes/stun/languages/zh-HK.yml","hash":"aef25f329cc05dbe8e38753fccd98d63c9fcd174","modified":1635993607765},{"_id":"themes/stun/layout/_layout.pug","hash":"5052ee5040ae736d78ad208df7352be69b61b0d1","modified":1635993607765},{"_id":"themes/stun/layout/archive.pug","hash":"d45d078ae4196add83e21fcaed3ef168b237af90","modified":1635993607775},{"_id":"themes/stun/layout/index.pug","hash":"df40cf1f051fd29f0f51ace74e9f7394f6ea2ab7","modified":1635993607775},{"_id":"themes/stun/.DS_Store","hash":"a5db2e7fe60b7ff0a0178774a620ca5c7d83c4af","modified":1636010781934},{"_id":"themes/stun/layout/category.pug","hash":"24153408b2971542d177227f09e93da7754bf75e","modified":1635993607775},{"_id":"themes/stun/layout/.DS_Store","hash":"3533d7af440fbce33e5adfac83d868938b9e727a","modified":1635997325129},{"_id":"themes/stun/layout/page.pug","hash":"22ba5928bd9ae8c56b3242b7caa5fc3ec471b082","modified":1635993607775},{"_id":"themes/stun/layout/tag.pug","hash":"46f956ad7e2aed879999ddf5e768d80c4bbe5b5f","modified":1635993607775},{"_id":"themes/stun/scripts/engine.js","hash":"a63a57c9206a77a79f93dbd86e86204447d7d904","modified":1635993607776},{"_id":"themes/stun/layout/post.pug","hash":"a4d16dbb919df5d4ffdb5a1d0114a4e1c8c21197","modified":1635993607775},{"_id":"themes/stun/scripts/merge-config.js","hash":"bb914100129c5ca2d1a9e087fffd7bedcb6ae6a6","modified":1635993607777},{"_id":"themes/stun/layout/_mixins/gallery.pug","hash":"3054e2c09bc205173c517fb1c36321f7c4c0db63","modified":1635993607766},{"_id":"themes/stun/layout/_partials/config.pug","hash":"4fb832652485161148ea957067c06d50ed11578b","modified":1635993607767},{"_id":"themes/stun/layout/_mixins/meta-item.pug","hash":"3d74dc8ba8651efd4a605e56a21e314678d04057","modified":1635993607766},{"_id":"themes/stun/layout/_mixins/menu-item.pug","hash":"93c4454e48a6f1456c29aeb9d1332be186b49d4f","modified":1635993607766},{"_id":"themes/stun/layout/_mixins/post-header.pug","hash":"9486d07e56acf7bcc5d691bef93c19e2e5c98022","modified":1635993607766},{"_id":"themes/stun/layout/_mixins/timeline.pug","hash":"4e19a670f002d3c6bc740a2d6ef03964e6b59c09","modified":1635993607766},{"_id":"themes/stun/layout/_partials/.DS_Store","hash":"feb40b07220e1cc93490603d807864ed57a105ca","modified":1635997325128},{"_id":"themes/stun/source/.DS_Store","hash":"71f744a9ac28dff4194ff882f515caad2a6d944f","modified":1636005951924},{"_id":"themes/stun/layout/_scripts/stun.pug","hash":"961554914427578b57ea3912d751d398f4eb381d","modified":1635993607770},{"_id":"themes/stun/layout/_scripts/vendors.pug","hash":"62a6831d3b1d90d6c8335ce3402efc50e141eafb","modified":1635993607771},{"_id":"themes/stun/layout/_third-party/pjax.pug","hash":"4a786459a8e6a4f378a9d834502f8b11aa66f185","modified":1635993607773},{"_id":"themes/stun/layout/_third-party/quicklink.pug","hash":"2bed65ed4d314dc587e2359e20ae099b46181ed5","modified":1635993607774},{"_id":"themes/stun/source/js/header.js","hash":"63d407ee6f80114e220171ba829b79b28d420fe0","modified":1635993607792},{"_id":"themes/stun/source/js/scroll.js","hash":"8926ab87181a49c730ce5132518b608c54b8cdb1","modified":1635993607792},{"_id":"themes/stun/source/js/sidebar.js","hash":"20adff7f54bcd8299d32690d41ebc7a4eb7a8728","modified":1635993607792},{"_id":"themes/stun/source/images/cc-by-nc-nd.svg","hash":"017ad912874686a982ebceae359299b8f2a492e2","modified":1635993607790},{"_id":"themes/stun/source/js/stun-boot.js","hash":"8358ac0d879c0ca340c52e4de606523c2a91e156","modified":1635993607792},{"_id":"themes/stun/source/images/algolia.svg","hash":"90322f80db6ad0daf26ea3ec71dea6f691a8b2f1","modified":1635993607790},{"_id":"themes/stun/source/images/cc-by-nc.svg","hash":"4608189edbe7636dd651df65473298a3c5afb20d","modified":1635993607790},{"_id":"themes/stun/source/images/cc-by-nc-sa.svg","hash":"71d035c34219f924dbf1bf852166ee8fb58d2f24","modified":1635993607790},{"_id":"themes/stun/source/js/utils.js","hash":"b570eafe77e47d7701348f172a4dbaaba6fa8123","modified":1635993607793},{"_id":"themes/stun/source/images/cc-by-sa.svg","hash":"0455a8857ba096925d4145a56e8d10537fccb378","modified":1635993607791},{"_id":"themes/stun/source/images/cc-by-nd.svg","hash":"20c66ae3c393903e6eab3bc8cf7c3be6d753f9f8","modified":1635993607790},{"_id":"themes/stun/source/css/index.styl","hash":"8a75ec81fb064b0da2f978a064cc5bec2395f27d","modified":1635993607789},{"_id":"themes/stun/source/images/cc-by.svg","hash":"77f74c241902447424207869c74cb9d9264bdced","modified":1635993607791},{"_id":"themes/stun/source/images/loading.svg","hash":"32a6e770d217ae6c0cf0f6beef3172f1b5b9a0a2","modified":1635993607791},{"_id":"themes/stun/scripts/filters/external-link.js","hash":"f5369becfd8cc6e43d6dc3595b1edbe014d9aa7c","modified":1635993607776},{"_id":"themes/stun/scripts/filters/wrap-table.js","hash":"888c9eaaddcdb9b88d07837a9091aa39ed3fe677","modified":1635993607777},{"_id":"themes/stun/scripts/filters/image-setting.js","hash":"412318b6d189d5355dbcc52c9762072f7ecdaad4","modified":1635993607776},{"_id":"themes/stun/scripts/filters/lazyload.js","hash":"d5baf39faeff5368182be1f59fb598d023985cde","modified":1635993607776},{"_id":"themes/stun/scripts/filters/post-heading.js","hash":"b504aa047e3f080fc3f95f3e96fad88bbbce20cb","modified":1635993607777},{"_id":"themes/stun/scripts/filters/shake-file.js","hash":"159dff6e4f7020545c9b151108398cd383d613e2","modified":1635993607777},{"_id":"themes/stun/scripts/tags/friends.js","hash":"c2fe1e8e128f464d772bcb7534efef54ad224310","modified":1635993607777},{"_id":"themes/stun/scripts/tags/note.js","hash":"b436593a56e3bab8dd59c71e73ac9efbc8fa29d4","modified":1635993607778},{"_id":"themes/stun/scripts/tags/table.js","hash":"177061e1bfb296981a101643f51a27ccc1469307","modified":1635993607778},{"_id":"themes/stun/layout/_partials/footer/footer.pug","hash":"e3d5e4d6ebec59a2511d03fa2b143fd24ae83507","modified":1636006523543},{"_id":"themes/stun/layout/_partials/analytics/busuanzi.pug","hash":"80d2f4f8706a96b367ac1e89f5b56ada4684d571","modified":1635993607767},{"_id":"themes/stun/layout/_partials/header/header.pug","hash":"7ecbe18da15d3a52c56f69c542540291b6178763","modified":1635993607768},{"_id":"themes/stun/layout/_partials/head/head.pug","hash":"c7909a6a50c7a76a6c1810b700a5d72bcb1e20c9","modified":1635993607767},{"_id":"themes/stun/layout/_partials/head/kill-old-ie.pug","hash":"427a95d02844f29e63c5e9f014ede3609aec1a5b","modified":1635993607767},{"_id":"themes/stun/layout/_partials/post/post-list.pug","hash":"c049078009aa251fc76cd948837c7a5efdd39cb2","modified":1635993607768},{"_id":"themes/stun/layout/_partials/search/algolia.pug","hash":"61181bece0e27929fe00df5204fefd8dee31a354","modified":1635993607768},{"_id":"themes/stun/layout/_partials/search/localsearch.pug","hash":"4d8e0bc33f92a603e0b2a5f4296af6bcc7cc31b8","modified":1635993607769},{"_id":"themes/stun/layout/_partials/search/index.pug","hash":"0f84aa013a96e7eb3bb25b87f20bab9b7ac55538","modified":1635993607769},{"_id":"themes/stun/layout/_partials/sidebar/sidebar.pug","hash":"18173a2acf99db39748c392f2e669acd805b4090","modified":1635993607769},{"_id":"themes/stun/layout/_partials/search/assist-btns.pug","hash":"7e6dc0d975ccbe291116487b15277d27a391fb9a","modified":1635993607768},{"_id":"themes/stun/layout/_partials/widgets/comments.pug","hash":"af1b16be74c7e1242e0f57986672dc73e93546e2","modified":1635993607769},{"_id":"themes/stun/layout/_partials/widgets/copyright.pug","hash":"0938c885697f6eb388b28ddbf88f5631d024fe73","modified":1635993607769},{"_id":"themes/stun/layout/_partials/widgets/back2top.pug","hash":"48b7fedeb472bd01fd1f3317359a10e83ca919e1","modified":1635993607769},{"_id":"themes/stun/layout/_partials/widgets/loading-bar.pug","hash":"6cda7866f9589c9ffc05ce4a3d7c33b706e70324","modified":1635993607770},{"_id":"themes/stun/layout/_partials/widgets/reward.pug","hash":"c9081c1dcf0ca18df06d23638654d8f43b28d55c","modified":1635993607770},{"_id":"themes/stun/layout/_partials/widgets/night-mode.pug","hash":"c7f9bd67cd231b9bd40a84123644e009ac8d8ef3","modified":1635993607770},{"_id":"themes/stun/layout/_partials/widgets/paginator.pug","hash":"b0045dcb9b151ee31f1db5b7d741f10ef3b74be0","modified":1635993607770},{"_id":"themes/stun/layout/_third-party/advertising/google-adsense.pug","hash":"e489020f1130976d3ec2245915ede6319d89b89c","modified":1635993607771},{"_id":"themes/stun/layout/_partials/widgets/sticky-top.pug","hash":"bf86b2f9f4b1471afb8b31965d3230f6088682ae","modified":1635993607770},{"_id":"themes/stun/layout/_partials/widgets/share.pug","hash":"1bb3d25298b7ee6a28150aa286ed6b0ae42ead4f","modified":1635993607770},{"_id":"themes/stun/layout/_third-party/advertising/index.pug","hash":"1285cd65a873f688ae3c51846c1284447f502adc","modified":1635993607771},{"_id":"themes/stun/layout/_third-party/analytics/baidu-analytics.pug","hash":"f7300991a29dbe2e8091a588dfa8c65c3dee6302","modified":1635993607771},{"_id":"themes/stun/layout/_third-party/analytics/busuanzi.pug","hash":"78a4fc9c9380e31536f5b500638f2d005accd361","modified":1635993607771},{"_id":"themes/stun/layout/_third-party/analytics/google-analytics.pug","hash":"4eef66fbb8a8ad55e0868cf4b77a6b7bca0e7f35","modified":1635993607771},{"_id":"themes/stun/layout/_third-party/analytics/index.pug","hash":"0d72f844bf9532b3be644c27b0af7cb4331fc46c","modified":1635993607771},{"_id":"themes/stun/layout/_third-party/analytics/tencent-analytics.pug","hash":"f88fb0f085812db6023c30308ba3458da7742993","modified":1635993607772},{"_id":"themes/stun/layout/_third-party/comments/disqus.pug","hash":"57bcbaac3d237d9168dd8f4b682f34351f11d250","modified":1635993607772},{"_id":"themes/stun/layout/_third-party/comments/gitalk.pug","hash":"c2a90e80c51b5b99e6804dbed5457a071b980bbd","modified":1635993607772},{"_id":"themes/stun/layout/_third-party/comments/index.pug","hash":"bec4d9c8ea360637e7da3314fa987e33facd8071","modified":1635993607772},{"_id":"themes/stun/layout/_third-party/comments/minivaline.pug","hash":"5584ade7dd19deca418373115bde9d563d37d826","modified":1635993607772},{"_id":"themes/stun/layout/_third-party/comments/fbcomments.pug","hash":"fb651812c87dc5e2134d7fb7d8f98d4d4227f1f6","modified":1635993607772},{"_id":"themes/stun/layout/_third-party/comments/utterances.pug","hash":"6418baeb3aedcddb02a64bd89b26ac12e18551c8","modified":1635993607773},{"_id":"themes/stun/layout/_third-party/comments/valine.pug","hash":"b519a6948d6ef37c037385e3e3f9590c17f7ad62","modified":1635993607773},{"_id":"themes/stun/layout/_third-party/comments/livere.pug","hash":"687f74a998519608944b40a41f3a98ccf4535139","modified":1635993607772},{"_id":"themes/stun/layout/_third-party/comments/waline.pug","hash":"fd4c958b13777752f176556c7b109b7dede7cc68","modified":1635993607773},{"_id":"themes/stun/layout/_third-party/math/index.pug","hash":"e952be6c736545e73c0e02f833f87a4f8c5a2582","modified":1635993607773},{"_id":"themes/stun/layout/_third-party/math/katex.pug","hash":"345c59fe76a7c83b529328e5144d1036cb14f533","modified":1635993607773},{"_id":"themes/stun/layout/_third-party/math/mathjax.pug","hash":"72d51538cc85f01c8c64db74b9219ccaf334c9e9","modified":1635993607773},{"_id":"themes/stun/layout/_third-party/search/algolia.pug","hash":"54233748e22ceae063f70ee49b44c4bd0a78f391","modified":1635993607774},{"_id":"themes/stun/layout/_third-party/search/localsearch.pug","hash":"d98db7ed7e3e4c574212fa9d75adba681f3d0687","modified":1635993607774},{"_id":"themes/stun/layout/_third-party/search/index.pug","hash":"0f84aa013a96e7eb3bb25b87f20bab9b7ac55538","modified":1635993607774},{"_id":"themes/stun/source/images/icons/favicon-16x16.png","hash":"7bfd64eac26e17ea162f0c399a4a40164c26b412","modified":1635993607791},{"_id":"themes/stun/source/images/icons/stun-logo.svg","hash":"069dc7590ad152373f1c346d892e32faa2bbdd87","modified":1635993607791},{"_id":"themes/stun/source/css/_common/index.styl","hash":"86057db6cb18263866d62a6669feee8752882398","modified":1635993607787},{"_id":"themes/stun/source/css/_common/responsive.styl","hash":"618c6005f1bc7c482fa37ae3ce15729a64044d9d","modified":1635993607788},{"_id":"themes/stun/source/css/_custom/index.styl","hash":"0d1adc70250941074c742f94f7801b3b43a7f1db","modified":1635993607789},{"_id":"themes/stun/source/images/icons/favicon-32x32.png","hash":"02fead07726920400ede57ddfdbf071dd7203fd5","modified":1635993607791},{"_id":"themes/stun/source/css/_variables/index.styl","hash":"c81aac4285eb058026b255e31282d35f55a820ab","modified":1635993607789},{"_id":"themes/stun/source/css/_mixins/index.styl","hash":"f3060519f3acd05cb4b26bb5f6a5c6b857cb0d68","modified":1635993607789},{"_id":"themes/stun/source/css/_common/components/index.styl","hash":"a54720db94121efd1a34ac88d344197c8206837e","modified":1635993607780},{"_id":"themes/stun/source/css/_common/outline/macro.styl","hash":"13b96f239de15e1cfdc14d9c80e6959506556dd2","modified":1635993607787},{"_id":"themes/stun/source/css/_common/outline/index.styl","hash":"467d4171c0690a95d40fbecea02e6b212b7c74f1","modified":1635993607787},{"_id":"themes/stun/source/css/_common/scaffolding/base.styl","hash":"4064a7e2c3f71d2ed72a47edd60e9be01af6c354","modified":1635993607788},{"_id":"themes/stun/source/css/_common/scaffolding/normalize.styl","hash":"c15a9616fddb267431416304d709185aeb3d45f5","modified":1635993607788},{"_id":"themes/stun/source/css/_common/scaffolding/index.styl","hash":"e750f2dae9eb3385039ee018ff8001b0e6ec3b64","modified":1635993607788},{"_id":"themes/stun/source/css/_common/scaffolding/utils.styl","hash":"7e62f34521ea539a25a101f25e1684e3a3ac4be8","modified":1635993607788},{"_id":"themes/stun/source/css/_common/components/analytics/index.styl","hash":"339a43fd5ee97a77775b723118f6ab1af754fed4","modified":1635993607778},{"_id":"themes/stun/source/css/_common/components/analytics/busuanzi.styl","hash":"d196c88ea2e9b851e8d8f9c5a315dfc2929eb897","modified":1635993607778},{"_id":"themes/stun/source/css/_common/components/footer/index.styl","hash":"14464841145cf3ecab66f1094653daa033c261eb","modified":1635993607779},{"_id":"themes/stun/source/css/_common/components/highlight/diff.styl","hash":"056e70f6dfe45ec50427d7ab293d33361c9b956f","modified":1635993607779},{"_id":"themes/stun/source/css/_common/components/header/index.styl","hash":"904af0e73cdf0767ec781271856d7b5b63e043ef","modified":1635993607779},{"_id":"themes/stun/source/css/_common/components/pages/index.styl","hash":"463a4e6a92ec5f757e167fbeb171e4e92e83a822","modified":1635993607780},{"_id":"themes/stun/source/css/_common/components/highlight/highlight.styl","hash":"bc0b01021a0d19b2c98f0c5c9fa1af96d67c1099","modified":1635993607779},{"_id":"themes/stun/source/css/_common/components/highlight/index.styl","hash":"85848179cbc78152d2521b601ac9f888dea4e255","modified":1635993607779},{"_id":"themes/stun/source/css/_common/components/pages/timeline.styl","hash":"21e9c8def1613030f0927e2ce80f4ecc721f078e","modified":1635993607780},{"_id":"themes/stun/source/css/_common/components/highlight/theme.styl","hash":"dfc99b05302f8203040431e563c9f63d63da46de","modified":1635993607780},{"_id":"themes/stun/source/css/_common/components/pages/page.styl","hash":"df732e267dfd9f1bda6a8cf1ede3198a205925f9","modified":1635993607780},{"_id":"themes/stun/source/css/_common/components/post/index.styl","hash":"08aad11e329cda0550efef226e0c4d0bb4540454","modified":1635993607781},{"_id":"themes/stun/source/css/_common/components/post/post.styl","hash":"8b7b22225b40d028efee689d3700a9796291cb8d","modified":1635993607782},{"_id":"themes/stun/source/css/_common/components/search/algolia.styl","hash":"fb62e4baf25a66e46c27783be5d79353ec394b44","modified":1635993607782},{"_id":"themes/stun/source/css/_common/components/post/post-list.styl","hash":"d0ed844e28533f832cbd9b3f09203d16936628f7","modified":1635993607782},{"_id":"themes/stun/source/css/_common/components/search/common.styl","hash":"1939b7dfbcf557794a188fbf8fec4ef2b5afa437","modified":1635993607782},{"_id":"themes/stun/source/css/_common/components/search/index.styl","hash":"1990d2c2a9bfe8e09d656f0c2ae6cf0c9f7f5542","modified":1635993607782},{"_id":"themes/stun/source/css/_common/components/search/localsearch.styl","hash":"bf1ac1b8ee8c4daaa7e6b47eec097a176624e6d0","modified":1635993607783},{"_id":"themes/stun/source/css/_common/components/plugins/friends.styl","hash":"bdb015173f8e5fa391fc4fb2b2a8d42787022c4b","modified":1635993607781},{"_id":"themes/stun/source/css/_common/components/sidebar/index.styl","hash":"02138647437f7e8ee8927cae225d41072d936bdc","modified":1635993607783},{"_id":"themes/stun/source/css/_common/components/plugins/index.styl","hash":"c35d0cf421c6669ee0458c2f0264dca05769c01d","modified":1635993607781},{"_id":"themes/stun/source/css/_common/components/plugins/note.styl","hash":"ae0ad9b44a87839d220792336478a9ae6db11c47","modified":1635993607781},{"_id":"themes/stun/source/css/_common/components/widgets/comments.styl","hash":"41d229ac4fa02a3a8b46687ccbafa7a608008e2f","modified":1635993607784},{"_id":"themes/stun/source/css/_common/components/plugins/table.styl","hash":"98cacc91e42f5e45279e2174a90ab26171085e2f","modified":1635993607781},{"_id":"themes/stun/source/css/_common/components/widgets/copy-button.styl","hash":"378961fa7c986e3313053814806902bf76204a93","modified":1635993607784},{"_id":"themes/stun/source/css/_common/components/widgets/back2top.styl","hash":"b3da5ea71a9947e781056d1bd7d42e4045fa2aca","modified":1635993607783},{"_id":"themes/stun/source/css/_common/components/widgets/ending.styl","hash":"63985ca9a3f6c481cc60207966fa1267de14d945","modified":1635993607784},{"_id":"themes/stun/source/css/_common/components/widgets/fancybox.styl","hash":"3d677c0323d77199bb9fbfefd65e97d8b882d7b3","modified":1635993607784},{"_id":"themes/stun/source/css/_common/components/widgets/copyright.styl","hash":"1d28fc8f76f7164a306ed81a9ede21c0a2b0f7cd","modified":1635993607784},{"_id":"themes/stun/source/css/_common/components/widgets/font-icon.styl","hash":"bdda0953611378e93a8d6387cbdc93e1de4f7f0a","modified":1635993607785},{"_id":"themes/stun/source/css/_common/components/widgets/gallery-image.styl","hash":"99b1cc42f38816083f93233778b299422b6d8f32","modified":1635993607785},{"_id":"themes/stun/source/css/_common/components/widgets/index.styl","hash":"03ffdc55fd5fb64c3158bc222d0e8e9d7844686b","modified":1635993607785},{"_id":"themes/stun/source/css/_common/components/widgets/lazyload.styl","hash":"eced96235f0ff5dc6a8fd068d4ed05934a29b430","modified":1635993607785},{"_id":"themes/stun/source/css/_common/components/widgets/loading-bar.styl","hash":"9f23e8762d01fb4a3cbf5e786fdead2926849e8a","modified":1635993607786},{"_id":"themes/stun/source/css/_common/components/widgets/night-mode.styl","hash":"9caeef13a913aba38976f082e1f0ca191bffc64e","modified":1635993607786},{"_id":"themes/stun/source/css/_common/components/widgets/reward.styl","hash":"de1130ec3765879884cbdc77a15b458da6e37bcc","modified":1635993607786},{"_id":"themes/stun/source/css/_common/components/widgets/paginator.styl","hash":"71ddb6a1e9664a4fde04a0ce143b8786ba6e0089","modified":1635993607786},{"_id":"themes/stun/source/css/_common/components/widgets/share.styl","hash":"fe32e3434107d92cefd7aacfdcef526a93c4b865","modified":1635993607786},{"_id":"themes/stun/source/css/_common/components/widgets/sticky-top.styl","hash":"f0e37944168a74a64b18dc54c6fde2308e4bf023","modified":1635993607786},{"_id":"themes/stun/source/css/_common/components/widgets/zoom-image.styl","hash":"40f832a199320642debabe32910c1168e3c6e40c","modified":1635993607787}],"Category":[{"name":"iOS","_id":"ckvko2j2d0003qezueplv40vs"}],"Data":[],"Page":[{"title":"tags","date":"2021-11-04T02:44:32.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2021-11-04 10:44:32\ntype: \"tags\"\n---\n","updated":"2021-11-04T02:46:06.706Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckvko2j260000qezu0z2r2q0n","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"categories","date":"2021-11-04T02:44:20.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2021-11-04 10:44:20\ntype: \"categories\"\n---\n","updated":"2021-11-04T02:45:29.054Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ckvko2j2b0002qezua42ggvjf","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"iOS ç¼–è¯‘è¿‡ç¨‹","_content":"\n# iOS ç¼–è¯‘è¿‡ç¨‹ \n\n## 1. å‰è¨€\n\nå­¦ä¹  **iOS** ç¼–è¯‘è¿‡ç¨‹ï¼ˆ**Compile**ï¼‰æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½ç†è§£ä»£ç æ˜¯å¦‚ä½•è¢«è®¡ç®—æœºè¿ä½œèµ·æ¥ï¼Œç¼–è¯‘å™¨ä¸ºä»£ç åšäº†å“ªäº›ä¼˜åŒ–ï¼Œè®©æˆ‘ä»¬å­¦ä¼šä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹å¾…é—®é¢˜ã€‚\n\n## 2. ç¼–è¯‘å™¨ç»“æ„\n\nç°ä»£ç¼–è¯‘å™¨æ˜¯å°†æºä»£ç è½¬æ¢æˆå¯æ‰§è¡Œæ–‡ä»¶çš„ç¨‹åºï¼Œå·¥ä½œæµç¨‹ä¸»è¦åˆ†ä¸º **å‰ç«¯** å’Œ **åç«¯** ä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\n1. å‰ç«¯ï¼šå¯¹æºä»£ç è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆä¸­é—´ä»£ç ã€‚\n2. åç«¯ï¼šé’ˆå¯¹ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬æ¢æˆç›®æ ‡æœºå™¨çš„ä»£ç æŒ‡ä»¤ã€‚\n\n```mermaid\ngraph LR\n\tA(SourceCode) --> B(Frontend)\n    B(Frontend) --> C(Backend)\n    C(Backend) --> D(Machine Code)\n```\n\né’ˆå¯¹iOSå¹³å°ï¼Œä¸åŒè¯­è¨€é‡‡ç”¨äº†ä¸åŒçš„ç¼–è¯‘å™¨å‰ç«¯ï¼š\n\n1. **Frontendï¼šClang / SwiftC**\n\n   å¯¹äº **Objective-C / C / C++ / Objective-C++**  æ¥è¯´é‡‡ç”¨ **Clang** ç¼–è¯‘å™¨å‰ç«¯ï¼›\n\n   å¯¹äº **Swift** æ¥è¯´åˆ™é‡‡ç”¨ **SwiftC**ï¼›\n\n2. **Backendï¼šLLVM**\n\n   æ— è®ºæ˜¯ **C** ç³»è¯­è¨€è¿˜æ˜¯ **Swift** éƒ½é‡‡ç”¨ **LLVM** ä½œä¸ºç¼–è¯‘å™¨åç«¯ï¼›\n\nå€¼å¾—æ³¨æ„çš„æ˜¯åœ¨ **Xcode3** ä»¥å‰ï¼Œéƒ½é‡‡ç”¨ **GCC** ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ï¼Œä½†ä¸º **Apple** å¿«é€Ÿå‘å±•éœ€è¦åŠŸèƒ½æ›´å¼ºå¤§å’Œæ€§èƒ½æ›´å¥½çš„ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥ **Apple** è‡ªå·±å¼€å‘äº† **Clang** ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ã€‚ä¸‹é¢å¯¹ç¼–è¯‘å™¨åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼š\n\n* **GCC**\n\n**GCC**ï¼ˆ**GNU Compile Collection**ï¼Œ**GNU **ç¼–è¯‘å™¨å¥—è£…ï¼‰ï¼Œæ˜¯ä¸€å¥—ç”± **GNU** å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ç¼–è¯‘å™¨ã€‚æ¥æœ¬åªèƒ½å¤„ç† *C* è¯­è¨€ï¼Œåæ¥å¿«é€Ÿæ¼”è¿›ï¼Œå˜å¾—å¯å¤„ç† **C++ã€Objective-Cã€Javaã€Fortran** ç­‰å…¶ä»–è¯­è¨€ã€‚ä½†ç”±äºä¸€äº›ç¼ºé™·ï¼Œå¯¼è‡´äº† **Apple** æŠ›å¼ƒäº† **GCC** ï¼Œå¼€å‘å‡ºäº† **Clang** ä½œä¸ºå…¶å‰ç«¯ç¼–è¯‘å™¨ã€‚\n\n1. **GCC** çš„ **Objective-C Frontend** ä¸æ˜¯ **Apple** ç»´æŠ¤ï¼Œå¯¼è‡´æƒ³è¦æ·»åŠ ä¸€äº›è¯­æ³•æç¤ºç­‰åŠŸèƒ½å¾—å»è¦æ±‚ **GCC** å›¢é˜Ÿåšã€‚\n2. **GCC** çš„æ’ä»¶ã€å·¥å…·ã€**IDE** çš„æ”¯æŒè–„å¼±ã€‚\n3. **GCC** çš„ç¼–è¯‘æ•ˆç‡å’Œæ€§èƒ½ä¸è¶³ã€‚\n\n* **Clang**\n\n**Clang1.0** äº **2009** å¹´æ­£å¼ä¸ **LLVM2.6** æ­£å¼å‘å¸ƒï¼Œæ—¨åœ¨æä¾› **GCC** çš„æ›¿ä»£å“ï¼Œæ”¯æŒäº† **GUN** ç¼–è¯‘å™¨å¤§å¤šæ•°çš„ç¼–è¯‘å™¨è®¾ç½®ä»¥åŠéå®˜æ–¹è¯­è¨€çš„æ‹“å±•ï¼Œç›¸è¾ƒäº **GCC** ï¼Œ**Clang** å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n\n1. ç¼–è¯‘é€Ÿåº¦æ›´å¿«ã€‚\n2. å ç”¨å†…å­˜æ›´å°ã€‚\n3. æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‹“å±•ä¸é‡ç”¨ã€‚\n4. è¯Šæ–­ä¿¡æ¯å¯è¯»æ€§å¼ºã€‚\n\n* **SwiftC**\n\n**SwiftC** åœ¨å‰ç«¯é‡‡ç”¨äº† **SIL** ä¸­é—´è¯­è¨€ï¼Œè¿™æ˜¯å› ä¸º **Swift** ä½œä¸ºä¸€ç§é«˜çº§è¯­è¨€ï¼Œæœ‰è®¸å¤šç‰¹æ€§ï¼Œå¦‚ **protocol** çš„æ³›å‹ï¼Œä¹Ÿæ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œç¡®ä¿å˜é‡åœ¨ä½¿ç”¨ä¹‹å‰è¢«åˆå§‹åŒ–ã€æ£€æµ‹ä¸å¯æ‰§è¡Œçš„ä»£ç ï¼Œäºæ˜¯å¢åŠ äº†ä¸€å±‚ **SIL** æ¥åšè¿™äº›äº‹æƒ…ã€‚\n\n* **LLVM**\n\n**LLVM** æ˜¯ä¸€å¥—ç¼–è¯‘å™¨åŸºç¡€è®¾å¤‡é¡¹ç›®ï¼Œç”± **C++** å†™æˆï¼ŒåŒ…å«ä¸€ç³»åˆ—æ¨¡å—åŒ–çš„ç¼–è¯‘å™¨ç»„ä»¶å’Œå·¥å…·é“¾ï¼Œç”¨æ¥å¼€å‘ç¼–è¯‘å™¨çš„å‰ç«¯å’Œåç«¯ã€‚åœ¨ **iOS** ä¸­ï¼Œ**LLVM** ä½œä¸ºç¼–è¯‘å™¨åç«¯ä¸»è¦æä¾› **Optimizer** å’Œ **Code Generator** ï¼Œå°†æ¥æ”¶åˆ°çš„ **IR** ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»¥åŠæœºå™¨ä»£ç ç”Ÿæˆã€‚\n\n## 3. ç¼–è¯‘è¿‡ç¨‹\n\n### 3.1 æµç¨‹æ¢³ç†\n\n```mermaid\ngraph TD\n    subgraph Clang\n\tid1(æºä»£ç ) --> id2(é¢„å¤„ç†) \n    id2(é¢„å¤„ç†) --> id3(è¯­æ³•åˆ†æ)   \n    id3(è¯­æ³•åˆ†æ) --  token  --> id4(è¯­æ³•åˆ†æ)\n    id4(è¯­æ³•åˆ†æ) --  AST  --> id5(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    subgraph Optimizer, Backend\n    id6(ä¸­é—´ä»£ç ä¼˜åŒ–) --> id7(BitCodeç”Ÿæˆ)\n    id7(BitCodeç”Ÿæˆ) --> id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ)\n    id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ) --> id9(æœºå™¨ç ç”Ÿæˆ)\n    id9(æœºå™¨ç ç”Ÿæˆ) --> id11(é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶)\n    end\n    \n    subgraph SwiftC\n    id12(æºä»£ç ) --> id13(è§£æ)\n    id13(è§£æ) --> id14(è¯­ä¹‰åˆ†æ)\n    id14(è¯­ä¹‰åˆ†æ) --> id15(Clangå¯¼å…¥å™¨)\n    id15(Clangå¯¼å…¥å™¨) --> id16(SILç”Ÿæˆ)\n    id16(SILç”Ÿæˆ) --> id17(SILä¿è¯è½¬æ¢)\n    id17 --> id18(SILä¼˜åŒ–)\n    id18(SILä¼˜åŒ–) --> id19(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    id5 --  IR  --> id6\n    id19 --  IR  --> id6\n```\n\nåœ¨å‰ç«¯ **Objective-C** å’Œ **Swift** åˆ†åˆ«ç”±è‡ªå·±çš„å¤„ç†é˜¶æ®µï¼Œä½†æœ€åéƒ½ä¼šç”Ÿæˆ **IR** ä¸­é—´ä»£ç ï¼Œäº¤ç”±åç«¯è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚\n\nä¸‹é¢æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„.mæ–‡ä»¶è¿›è¡Œç¼–è¯‘è¿‡ç¨‹æ¢³ç†ï¼Œé¦–å…ˆåœ¨æŸä¸€ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª **nihao.m**æ–‡ä»¶\n\n```shell\ntouch nihao.m\n```\n\n**nihao.mï¼š**\n\n```objective-c\n#import <Foundation/Foundation.h>\nint main(int argc, char *argv[])\n{\n    @autoreleasepool {\n        NSLog(@\"nihao!!!\");\n        return 0;\n    }\n}\n```\n\n### 3.2 Clangé˜¶æ®µï¼ˆObjective-C / C++ / C / Objective-C++ï¼‰\n\n#### é¢„å¤„ç†é˜¶æ®µï¼š\n\n```shell\nxcrun clang -E helloworld.c | open -f\n```\n\n```\n# 1 \"nihao.m\"\n# 1 \"<built-in>\" 1\n# 1 \"<built-in>\" 3\n# 380 \"<built-in>\" 3\n# 1 \"<command line>\" 1\n# 1 \"<built-in>\" 2\n# 1 \"nihao.m\" 2\n# 1 \"/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/Foundation.framework/Headers/Foundation.h\" 1 3\n\n...\n...\n...\n\nint main(int argc, char *argv[])\n{\n    @autoreleasepool {\n        NSLog(@\"nihao!!!\");\n        return 0;\n    }\n}\n```\n\nå°†é¢„å¤„ç†é˜¶æ®µè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œ å¯ä»¥çœ‹åˆ°å¾ˆå¤šä»¥ **#** å¼€å¤´çš„è¯­å¥ï¼Œè¿™äº›è¯­å¥å‘Šè¯‰æˆ‘ä»¬åé¢è·Ÿç€çš„å†…å®¹æ¥è‡ªå“ªé‡Œï¼Œè¿™é‡Œå¯ä»¥çœ‹è§ **Foundation.h** æ–‡ä»¶çš„å†…å®¹ä¹ŸåŒ…å«äº†è¿›æ¥ã€‚åœ¨ **Xcode** ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ **Product ->  Perfrom Action -> Preprocess** æŸ¥çœ‹é¢„å¤„ç†é˜¶æ®µä¹‹åçš„ä»£ç ã€‚åœ¨é¢„å¤„ç†é˜¶æ®µåšäº†ä»¥ä¸‹è¿™äº›äº‹æƒ…ï¼š\n\n* å°†å¤´æ–‡ä»¶å¼•å…¥çš„å…¶ä»–æ–‡ä»¶åŠ å…¥æºæ–‡ä»¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚\n* è¿›è¡Œæ¡ä»¶ç¼–è¯‘å¤„ç†ã€‚\n* å°†å®å®šä¹‰ç›´æ¥æ›¿æ¢ï¼Œä¸è¿›è¡Œè¯­æ³•æ£€æŸ¥ã€‚\n* å°†æ³¨é‡Šè¿›è¡Œåˆ é™¤å¤„ç†ã€‚\n\n#### è¯æ³•åˆ†æé˜¶æ®µ\n\n```shell\nxcrun clang -fmodules -fsyntax-only -Xclang -dump-tokens nihao.m\n```\n\n```\nannot_module_include '#import <Foundation/Foundation.h>\n\n'\t\tLoc=<nihao.m:1:1>\nint 'int'\t [StartOfLine]\tLoc=<nihao.m:3:1>\nidentifier 'main'\t [LeadingSpace]\tLoc=<nihao.m:3:5>\nl_paren '('\t\tLoc=<nihao.m:3:9>\nint 'int'\t\tLoc=<nihao.m:3:10>\nidentifier 'argc'\t [LeadingSpace]\tLoc=<nihao.m:3:14>\ncomma ','\t\tLoc=<nihao.m:3:18>\nchar 'char'\t [LeadingSpace]\tLoc=<nihao.m:3:20>\nstar '*'\t [LeadingSpace]\tLoc=<nihao.m:3:25>\nidentifier 'argv'\t\tLoc=<nihao.m:3:26>\nl_square '['\t\tLoc=<nihao.m:3:30>\nr_square ']'\t\tLoc=<nihao.m:3:31>\nr_paren ')'\t\tLoc=<nihao.m:3:32>\nl_brace '{'\t [StartOfLine]\tLoc=<nihao.m:4:1>\nat '@'\t [StartOfLine] [LeadingSpace]\tLoc=<nihao.m:5:5>\nidentifier 'autoreleasepool'\t\tLoc=<nihao.m:5:6>\n...\n```\n\nè¯æ³•åˆ†æé˜¶æ®µå…¶å®æ˜¯å°†æºä»£ç ä»¥å­—ç¬¦æ–‡æœ¬çš„å½¢å¼è½¬æ¢æˆ **Token** æµçš„å½¢å¼ï¼Œä¸æ¶‰åŠè¯­ä¹‰æ ¡éªŒï¼Œç”¨æ¥æ ‡è¯†å‡ºè¿™ä¸ªå­—ç¬¦æ˜¯æ ‡è¯†ç¬¦ã€æ‹¬å·ã€ifè¯­å¥...ï¼Œæœ€åè¿˜ä¼šæ ‡è¯†å‡ºå…¶æ‰€åœ¨ä½ç½®ï¼Œæ–¹ä¾¿åç»­åˆ†æèƒ½å¤Ÿæ‰¾å‡ºå‡ºé”™çš„åŸå§‹ä½ç½®ã€‚\n\n#### è¯­æ³•åˆ†æé˜¶æ®µ\n\n```\nxcrun clang -fsyntax-only -Xclang -ast-dump nihao.m | open -f\n```\n\n```\n...\n`-FunctionDecl 0x7f9eb4bd61a0 <nihao.m:3:1, line:9:1> line:3:5 main 'int (int, char **)'\n  |-ParmVarDecl 0x7f9eb4bd5fc0 <col:10, col:14> col:14 argc 'int'\n  |-ParmVarDecl 0x7f9eb4bd6080 <col:20, col:31> col:26 argv 'char **':'char **'\n  `-CompoundStmt 0x7f9eb4bd63d0 <line:4:1, line:9:1>\n    `-ObjCAutoreleasePoolStmt 0x7f9eb4bd63b8 <line:5:5, line:8:5>\n      `-CompoundStmt 0x7f9eb4bd6398 <line:5:22, line:8:5>\n        |-CallExpr 0x7f9eb4bd6328 <line:6:9, col:26> 'void'\n        | |-ImplicitCastExpr 0x7f9eb4bd6310 <col:9> 'void (*)(id, ...)' <FunctionToPointerDecay>\n        | | `-DeclRefExpr 0x7f9eb4bd6250 <col:9> 'void (id, ...)' Function 0x7f9eb0c8d6c8 'NSLog' 'void (id, ...)'\n        | `-ImplicitCastExpr 0x7f9eb4bd6350 <col:15, col:16> 'id':'id' <BitCast>\n        |   `-ObjCStringLiteral 0x7f9eb4bd6290 <col:15, col:16> 'NSString *'\n        |     `-StringLiteral 0x7f9eb4bd6270 <col:16> 'char [9]' lvalue \"nihao!!!\"\n        `-ReturnStmt 0x7f9eb4bd6388 <line:7:9, col:16>\n          `-IntegerLiteral 0x7f9eb4bd6368 <col:16> 'int' 0\n```\n\nè¯­æ³•åˆ†æé˜¶æ®µä¼šè¾“å‡º **AST**ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œå®ƒæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚é€šè¿‡å®ƒï¼Œå¯ä»¥è¿›è¡Œè¯­æ³•é”™è¯¯åˆ†æï¼Œä»¥åŠé™æ€åˆ†ææ“ä½œï¼Œæ¶µç›–å†…å­˜æ“ä½œå’Œå®‰å…¨ç­‰æ–¹é¢ã€‚\n\n#### CodeGené˜¶æ®µ\n\n```shell\nxcrun clang -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll\n```\n\n```\n; ModuleID = 'nihao.m'\nsource_filename = \"nihao.m\"\ntarget datalayout = \"e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx11.0.0\"\n\n%struct.__NSConstantString_tag = type { i32*, i32, i8*, i64 }\n\n@__CFConstantStringClassReference = external global [0 x i32]\n@.str = private unnamed_addr constant [9 x i8] c\"nihao!!!\\00\", section \"__TEXT,__cstring,cstring_literals\", align 1\n@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag { i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 }, section \"__DATA,__cfstring\", align 8 #0\n\n; Function Attrs: noinline optnone ssp uwtable\ndefine i32 @main(i32 %0, i8** %1) #1 {\n  %3 = alloca i32, align 4\n  %4 = alloca i32, align 4\n  %5 = alloca i8**, align 8\n  store i32 0, i32* %3, align 4\n  store i32 %0, i32* %4, align 4\n  store i8** %1, i8*** %5, align 8\n  %6 = call i8* @llvm.objc.autoreleasePoolPush() #2\n  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*))\n  store i32 0, i32* %3, align 4\n  call void @llvm.objc.autoreleasePoolPop(i8* %6)\n  %7 = load i32, i32* %3, align 4\n  ret i32 %7\n}\n\n; Function Attrs: nounwind\ndeclare i8* @llvm.objc.autoreleasePoolPush() #2\n\ndeclare void @NSLog(i8*, ...) #3\n\n; Function Attrs: nounwind\ndeclare void @llvm.objc.autoreleasePoolPop(i8*) #2\n\nattributes #0 = { \"objc_arc_inert\" }\nattributes #1 = { noinline optnone ssp uwtable \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"min-legal-vector-width\"=\"0\" \"no-infs-fp-math\"=\"false\" \"no-jump-tables\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #2 = { nounwind }\nattributes #3 = { \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n\n!llvm.module.flags = !{!0, !1, !2, !3, !4, !5, !6, !7}\n!llvm.ident = !{!8}\n\n!0 = !{i32 2, !\"SDK Version\", [2 x i32] [i32 12, i32 0]}\n!1 = !{i32 1, !\"Objective-C Version\", i32 2}\n!2 = !{i32 1, !\"Objective-C Image Info Version\", i32 0}\n!3 = !{i32 1, !\"Objective-C Image Info Section\", !\"__DATA,__objc_imageinfo,regular,no_dead_strip\"}\n!4 = !{i32 1, !\"Objective-C Garbage Collection\", i8 0}\n!5 = !{i32 1, !\"Objective-C Class Properties\", i32 64}\n!6 = !{i32 1, !\"wchar_size\", i32 4}\n!7 = !{i32 7, !\"PIC Level\", i32 2}\n!8 = !{!\"Apple clang version 13.0.0 (clang-1300.0.29.3)\"}\n```\n\n**CodeGen** é˜¶æ®µè´Ÿè´£å°† **AST** è‡ªé¡¶å‘ä¸‹éå†é€æ­¥ç¿»è¯‘æˆ **LLVM IR**ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨åç«¯æ‰€éœ€è¦çš„ä¸­é—´ä»£ç ï¼ŒåŒæ—¶ **Objective-C** ä»£ç ä¹Ÿä¼šåœ¨è¿™ä¸€æ­¥è¿›è¡Œ **Runtime** æ¡¥æ¥ï¼š **property** åˆæˆï¼Œ**ARC** å¤„ç†ç­‰ï¼Œå¦‚ä¸Šæ–¹å¯ä»¥çœ‹è§ **autoreleasePoolPush** ã€ **autoreleasePoolPop** æ“ä½œã€‚\n\nè‡³æ­¤ **Clang** å‰ç«¯å·¥ä½œç®—æ˜¯å®Œæˆï¼Œæ¥ä¸‹æ¥å°±äº¤ç»™åç«¯è¿›è¡Œå¤„ç†ã€‚\n\n### 3.3 LLVM Optimizer é˜¶æ®µ\n\n#### IRä»£ç ä¼˜åŒ–\n\n```shell\nxcrun clang -Os -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll\n```\n\n```\n; ModuleID = 'nihao.m'\nsource_filename = \"nihao.m\"\ntarget datalayout = \"e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx11.0.0\"\n\n%struct.__NSConstantString_tag = type { i32*, i32, i8*, i64 }\n\n@__CFConstantStringClassReference = external global [0 x i32]\n@.str = private unnamed_addr constant [9 x i8] c\"nihao!!!\\00\", section \"__TEXT,__cstring,cstring_literals\", align 1\n@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag { i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 }, section \"__DATA,__cfstring\", align 8 #0\n\n; Function Attrs: optsize ssp uwtable\ndefine i32 @main(i32 %0, i8** nocapture readnone %1) local_unnamed_addr #1 {\n  %3 = tail call i8* @llvm.objc.autoreleasePoolPush() #2\n  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*)) #4, !clang.arc.no_objc_arc_exceptions !9\n  tail call void @llvm.objc.autoreleasePoolPop(i8* %3) #2\n  ret i32 0\n}\n\n; Function Attrs: nounwind\ndeclare i8* @llvm.objc.autoreleasePoolPush() #2\n\n; Function Attrs: optsize\ndeclare void @NSLog(i8*, ...) local_unnamed_addr #3\n\n; Function Attrs: nounwind\ndeclare void @llvm.objc.autoreleasePoolPop(i8*) #2\n\nattributes #0 = { \"objc_arc_inert\" }\nattributes #1 = { optsize ssp uwtable \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"min-legal-vector-width\"=\"0\" \"no-infs-fp-math\"=\"false\" \"no-jump-tables\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #2 = { nounwind }\nattributes #3 = { optsize \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #4 = { optsize }\n\n!llvm.module.flags = !{!0, !1, !2, !3, !4, !5, !6, !7}\n!llvm.ident = !{!8}\n\n!0 = !{i32 2, !\"SDK Version\", [2 x i32] [i32 12, i32 0]}\n!1 = !{i32 1, !\"Objective-C Version\", i32 2}\n!2 = !{i32 1, !\"Objective-C Image Info Version\", i32 0}\n!3 = !{i32 1, !\"Objective-C Image Info Section\", !\"__DATA,__objc_imageinfo,regular,no_dead_strip\"}\n!4 = !{i32 1, !\"Objective-C Garbage Collection\", i8 0}\n!5 = !{i32 1, !\"Objective-C Class Properties\", i32 64}\n!6 = !{i32 1, !\"wchar_size\", i32 4}\n!7 = !{i32 7, !\"PIC Level\", i32 2}\n!8 = !{!\"Apple clang version 13.0.0 (clang-1300.0.29.3)\"}\n!9 = !{}\n```\n\n**IR** ä»£ç ä¼˜åŒ–ä¼šè°ƒç”¨ç›¸åº” **Pass** è¿›è¡Œå¤„ç†ï¼Œ**Pass** ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œéƒ½æ˜¯ **Pass** ç±»çš„å­ç±»ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„ä¼˜åŒ–ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè‡ªä¸»çš„æ§åˆ¶ä¼˜åŒ–çš„å¼ºåº¦ï¼Œåœ¨**Build Strrings -> Optimization Level** ä¸­å¯æŒ‡å®šä¼˜åŒ–ç¨‹åº¦ï¼Œä¸€äº›å¸¸è§çš„ä»£ç ä¼˜åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š\n\n* åˆ é™¤å…¬å…±å­è¡¨è¾¾å¼\n* åˆ é™¤æ— ç”¨ä»£ç \n* å¸¸é‡åˆå¹¶\n* ä»£ç ç§»åŠ¨\n* åˆ é™¤å½’çº³å˜é‡\n\n#### ç”Ÿæˆ BitCodeï¼ˆArchiveæ—¶ï¼‰\n\n```shell\nxrun clang -emit-llvm -c nihao.m -o nihao.bc\n```\n\n```\ndec0 170b 0000 0000 1400 0000 0010 0000\n0700 0001 4243 c0de 3514 0000 0700 0000\n620c 3024 9596 a6a5 f7d7 7f7d d3b4 4ffb\n76ef df3f 2d44 0132 0500 0000 210c 0000\n4903 0000 0b02 2100 0200 0000 1600 0000\n0781 2391 41c8 0449 0610 3239 9201 840c\n2505 0819 1e04 8b62 8014 4502 4292 0b42\na410 3214 3808 184b 0a32 5288 4870 c421\n...\n```\n\n**BitCode** æ˜¯ **LLVM** å¼•å…¥çš„å¦ä¸€ç§ä¸­é—´ä»£ç ï¼Œè™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒæ¥è¿‘æœºå™¨ç ï¼Œä½†æ˜¯åœ¨å‡½æ•°å’ŒæŒ‡ä»¤å±‚é¢ä½¿ç”¨äº†å¾ˆå¤šé«˜çº§è¯­è¨€çš„ç‰¹æ€§ã€‚\n\nä½†åªä¼šåœ¨ **Archive** æ—¶ï¼Œ**BitCode** æ‰ä¼šè¢«åµŒå…¥åˆ°é“¾æ¥åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºæäº¤ç»™ **App Store**ï¼ŒåŒ…å« **Bitcode** é…ç½®çš„ç¨‹åºå°†ä¼šåœ¨ **App Store** ä¸Šè¢«é‡æ–°ç¼–è¯‘å’Œé“¾æ¥ï¼Œè¿›è€Œå¯¹å¯æ‰§è¡Œæ–‡ä»¶åšä¼˜åŒ–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¼˜åŒ–è¿™ä¸€æ­¥æ˜¯åœ¨ **App Store** ä¸­åšçš„å¤„ç†ï¼Œæœ¬åœ°æ²¡æœ‰åšå¤„ç†ã€‚è¿›è¡Œå…¶ä»–ç±»å‹çš„ **Build** (é **Archive** )æ—¶ï¼Œç¼–è¯‘å™¨åªä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³å¼€å¯ **BitCode** çš„æ¡ä»¶ï¼Œä½†å¹¶ä¸ä¼šçœŸæ­£ç”Ÿæˆ **BitCode** ã€‚\n\n### 3.4 LLVM Code Generatoré˜¶æ®µ\n\n#### ç”Ÿæˆæ±‡ç¼–ä»£ç \n\n```shell\nxcrun clang -S -fobjc-arc nihao.m -o nihao.s\n```\n\n```\n\t.section\t__TEXT,__text,regular,pure_instructions\n\t.build_version macos, 11, 0\tsdk_version 12, 0\n\t.globl\t_main                           ## -- Begin function main\n\t.p2align\t4, 0x90\n_main:                                  ## @main\n\t.cfi_startproc\n## %bb.0:\n\tpushq\t%rbp\n\t.cfi_def_cfa_offset 16\n\t.cfi_offset %rbp, -16\n\tmovq\t%rsp, %rbp\n\t.cfi_def_cfa_register %rbp\n\tsubq\t$32, %rsp\n\tmovl\t$0, -4(%rbp)\n\tmovl\t%edi, -8(%rbp)\n\tmovq\t%rsi, -16(%rbp)\n\tcallq\t_objc_autoreleasePoolPush\n\tmovq\t%rax, -24(%rbp)                 ## 8-byte Spill\n\tleaq\tL__unnamed_cfstring_(%rip), %rdi\n\tmovb\t$0, %al\n\tcallq\t_NSLog\n\tmovq\t-24(%rbp), %rdi                 ## 8-byte Reload\n\tmovl\t$0, -4(%rbp)\n\tcallq\t_objc_autoreleasePoolPop\n\tmovl\t-4(%rbp), %eax\n\taddq\t$32, %rsp\n\tpopq\t%rbp\n\tretq\n\t.cfi_endproc\n                                        ## -- End function\n\t.section\t__TEXT,__cstring,cstring_literals\nL_.str:                                 ## @.str\n\t.asciz\t\"nihao!!!\"\n\n\t.section\t__DATA,__cfstring\n\t.p2align\t3                               ## @_unnamed_cfstring_\nL__unnamed_cfstring_:\n\t.quad\t___CFConstantStringClassReference\n\t.long\t1992                            ## 0x7c8\n\t.space\t4\n\t.quad\tL_.str\n\t.quad\t8                               ## 0x8\n\n\t.section\t__DATA,__objc_imageinfo,regular,no_dead_strip\nL_OBJC_IMAGE_INFO:\n\t.long\t0\n\t.long\t64\n\n.subsections_via_symbols\n```\n\næ±‡ç¼–è¯­è¨€æ›´åŠ æ¥è¿‘æœºå™¨è¯­è¨€ï¼Œèƒ½å¤Ÿç›´æ¥å¯¹ç¡¬ä»¶è¿›è¡Œæ“ä½œï¼Œç”Ÿæˆçš„ç¨‹åºä¸å…¶ä»–çš„è¯­è¨€ç›¸æ¯”å…·æœ‰æ›´é«˜çš„è¿è¡Œé€Ÿåº¦ï¼Œå ç”¨æ›´å°çš„å†…å­˜ã€‚\n\nç›®å‰æ‰€æœ‰ **iOS** è®¾å¤‡éƒ½é‡‡ç”¨ **ARM** å¤„ç†å™¨ï¼Œè¿™æ„å‘³ç€éƒ½æ˜¯é‡‡ç”¨ **ARM** æŒ‡ä»¤é›†ï¼Œå¦‚ **armv6 / armv7 / armv7s / arm64**ï¼Œè¿™äº›æŒ‡ä»¤é›†éƒ½æ˜¯å‘ä¸‹å…¼å®¹çš„ã€‚\n\næ¯ç§ **CPU** æ¶æ„éƒ½æœ‰ç€ç›¸åº”çš„æŒ‡ä»¤é›†ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ¶æ„äº§ç”Ÿä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤ï¼ŒåŠ ä¸Šä¸Šé¢ **- arch arch_type** é€‰é¡¹å³å¯ï¼Œæ›´å¤šè¯·å‚è§[å®˜ç½‘](https://developer.apple.com/library/archive/documentation/DeveloperTools/Reference/Assembler/000-Introduction/introduction.html)ã€‚åœ¨ **Xcode** ä¸­å¯åœ¨ **Build Settings -> Architectrues** æŒ‡å®šäº§ç”Ÿçš„ **CPU** æŒ‡ä»¤é›†ã€‚\n\n#### ç”Ÿæˆæœºå™¨ä»£ç \n\n```shell\nxcrun clang -fmodules -c nihao.s -o nihao.o\n```\n\nå¯ä»¥å‘ç°æœºå™¨ç äºŒè¿›åˆ¶æ–‡ä»¶æ— æ³•é˜…è¯»ï¼Œå¯å€ŸåŠ© **otool** æˆ–è€… **MachOView** ç­‰å·¥å…·æŸ¥çœ‹æ–‡ä»¶ä¸­çš„ç›¸å…³å†…å®¹ï¼š\n\n```shell\notool -v -h nihao.o\n```\n\n```\nnihao.o:\nMach header\n      magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64   X86_64        ALL  0x00      OBJECT     4        680 SUBSECTIONS_VIA_SYMBOLS\n```\n\nå¯ä»¥çœ‹è§ **.o** æ–‡ä»¶å®é™…ä¸Šæ˜¯ **mach-o** æ ¼å¼ï¼Œè¿™é‡Œæˆ‘ä»¬è¾“å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„å¤´éƒ¨ï¼Œè§„å®šäº†è¿™ä¸ªæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œé€‚åº”æ¶æ„çš„ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠæ–‡ä»¶æ˜¯å¦‚ä½•è¢«åŠ è½½çš„ã€‚æ›´å¤šå…³äº **mach-o** çš„çŸ¥è¯†[å‚è§](https://www.jianshu.com/p/54d842db3f69)ã€‚\n\n#### é“¾æ¥\n\n```shell\nxcrun clang nihao.o -Wl,`xcrun --show-sdk-path`/System/Library/Frameworks/Foundation.framework/Foundation\n```\n\n```shell\n./a.out\n```\n\n```\n2021-11-03 16:06:41.734 a.out[6394:220026] nihao!!!\n```\n\nç”±äºæˆ‘ä»¬å¼•å…¥äº† **Foundation** é‡Œé¢çš„æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°†ç›®æ ‡æ–‡ä»¶å’Œ **Foundation framework**è¿›è¡Œé“¾æ¥ï¼Œæ¥ç€å°±å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºäº†ã€‚\n\nè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šç¬¦å·è¡¨ï¼Œé‡Œé¢å­˜å‚¨çš„å…ƒç´ å¦‚ä¸‹ï¼š\n\n```xml\n<èµ·å§‹åœ°å€> <ç»“æŸåœ°å€> <å‡½æ•°> [<æ–‡ä»¶å:è¡Œå·>]\n```\n\nè¿™é‡Œæˆ‘ä»¬è¾“å…¥a.outçš„ç¬¦å·ä¿¡æ¯\n\n```\nnm -nm a.out\n```\n\n```\n                 (undefined) external _NSLog (from Foundation)\n                 (undefined) external ___CFConstantStringClassReference (from CoreFoundation)\n                 (undefined) external _objc_autoreleasePoolPop (from libobjc)\n                 (undefined) external _objc_autoreleasePoolPush (from libobjc)\n                 (undefined) external dyld_stub_binder (from libSystem)\n0000000100000000 (__TEXT,__text) [referenced dynamically] external __mh_execute_header\n0000000100003f20 (__TEXT,__text) external _main\n0000000100008018 (__DATA,__data) non-external __dyld_private\n```\n\nå¯¹äºåŠ¨æ€é“¾æ¥åº“çš„ç¬¦å·ï¼ˆå¦‚ **Foundation**ï¼‰ï¼Œæœ€ç»ˆä¼šè®°å½•ä¸‹è¿™ä¸ªç¬¦å·æ˜¯é€šè¿‡è¿›è¡Œé“¾æ¥çš„ï¼Œå¹¶è®°å½•ä¸‹ä¾èµ–äºå“ªä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨ï¼ˆ**dyld**ï¼‰ä¼šå»è§£æè¿™äº› **undefined** ç¬¦å·ã€‚å¯¹äºå…¶ä»–ä½ç½®çš„ç¬¦å·ï¼Œä¼šç›´æ¥ä¿®æ­£è¿™äº›ç¬¦å·çš„å…·ä½“ä½ç½®ä¿¡æ¯ã€‚\n\n## 4. æ€»ç»“\n\næœ¬æ–‡ä»‹ç»äº†å…³äº iOS ç¼–è¯‘å™¨ã€iOS ç¼–è¯‘è¿‡ç¨‹çš„åŸºç¡€çŸ¥è¯†ã€‚å­¦ä¹ äº†è¿™äº›ï¼Œå¯¹ iOS ç¼–è¯‘æœ‰ä¸ªæ•´ä½“è®¤è¯†ã€‚å°±æœ¬äººè€Œè¨€ï¼Œåœ¨ä¸€è·¯æœå¯»èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹ä¹‹å‰ä¸€äº›é›¶æ•£çš„çŸ¥è¯†ç‚¹æœ‰äº†ä¸€äº›æ›´åŠ æ·±å…¥çš„è®¤è¯†ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œå…³äº SwiftC çš„ç¼–è¯‘è¿‡ç¨‹æ²¡æœ‰å¤šåšä»‹ç»ï¼Œåé¢ä¼šå†å‡ºä¸€ç¯‡è¿›è¡Œä»‹ç»ã€‚\n\n\n\nğŸ”—ï¼š\n\n[ObjC ä¸­å›½ - Mach-O å¯æ‰§è¡Œæ–‡ä»¶](https://objccn.io/issue-6-3/)\n\n[ä»£ç ä¼˜åŒ–ä¸LLVM IR pass](https://kiprey.github.io/2020/06/LLVM-IR-pass/)\n\n[å…³äºbitcode, çŸ¥é“è¿™äº›å°±å¤Ÿäº†](http://xelz.info/blog/2018/11/24/all-you-need-to-know-about-bitcode/)\n\n[iOS ç¼–è¯‘é“¾æ¥ï¼šObjective-C ç¼–è¯‘é“¾æ¥](https://zhuanlan.zhihu.com/p/340782811)\n\n[è¶£æ¢ Mach-Oï¼šæ–‡ä»¶æ ¼å¼åˆ†æ](https://www.jianshu.com/p/54d842db3f69)\n\n","source":"_posts/2021-11-03-iOSç¼–è¯‘è¿‡ç¨‹.md","raw":"---\ntitle: \"iOS ç¼–è¯‘è¿‡ç¨‹\"\ncategories:\n  - iOS\ntags:\n  - iOS\n  - Compile\n---\n\n# iOS ç¼–è¯‘è¿‡ç¨‹ \n\n## 1. å‰è¨€\n\nå­¦ä¹  **iOS** ç¼–è¯‘è¿‡ç¨‹ï¼ˆ**Compile**ï¼‰æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½ç†è§£ä»£ç æ˜¯å¦‚ä½•è¢«è®¡ç®—æœºè¿ä½œèµ·æ¥ï¼Œç¼–è¯‘å™¨ä¸ºä»£ç åšäº†å“ªäº›ä¼˜åŒ–ï¼Œè®©æˆ‘ä»¬å­¦ä¼šä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹å¾…é—®é¢˜ã€‚\n\n## 2. ç¼–è¯‘å™¨ç»“æ„\n\nç°ä»£ç¼–è¯‘å™¨æ˜¯å°†æºä»£ç è½¬æ¢æˆå¯æ‰§è¡Œæ–‡ä»¶çš„ç¨‹åºï¼Œå·¥ä½œæµç¨‹ä¸»è¦åˆ†ä¸º **å‰ç«¯** å’Œ **åç«¯** ä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\n1. å‰ç«¯ï¼šå¯¹æºä»£ç è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆä¸­é—´ä»£ç ã€‚\n2. åç«¯ï¼šé’ˆå¯¹ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬æ¢æˆç›®æ ‡æœºå™¨çš„ä»£ç æŒ‡ä»¤ã€‚\n\n```mermaid\ngraph LR\n\tA(SourceCode) --> B(Frontend)\n    B(Frontend) --> C(Backend)\n    C(Backend) --> D(Machine Code)\n```\n\né’ˆå¯¹iOSå¹³å°ï¼Œä¸åŒè¯­è¨€é‡‡ç”¨äº†ä¸åŒçš„ç¼–è¯‘å™¨å‰ç«¯ï¼š\n\n1. **Frontendï¼šClang / SwiftC**\n\n   å¯¹äº **Objective-C / C / C++ / Objective-C++**  æ¥è¯´é‡‡ç”¨ **Clang** ç¼–è¯‘å™¨å‰ç«¯ï¼›\n\n   å¯¹äº **Swift** æ¥è¯´åˆ™é‡‡ç”¨ **SwiftC**ï¼›\n\n2. **Backendï¼šLLVM**\n\n   æ— è®ºæ˜¯ **C** ç³»è¯­è¨€è¿˜æ˜¯ **Swift** éƒ½é‡‡ç”¨ **LLVM** ä½œä¸ºç¼–è¯‘å™¨åç«¯ï¼›\n\nå€¼å¾—æ³¨æ„çš„æ˜¯åœ¨ **Xcode3** ä»¥å‰ï¼Œéƒ½é‡‡ç”¨ **GCC** ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ï¼Œä½†ä¸º **Apple** å¿«é€Ÿå‘å±•éœ€è¦åŠŸèƒ½æ›´å¼ºå¤§å’Œæ€§èƒ½æ›´å¥½çš„ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥ **Apple** è‡ªå·±å¼€å‘äº† **Clang** ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ã€‚ä¸‹é¢å¯¹ç¼–è¯‘å™¨åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼š\n\n* **GCC**\n\n**GCC**ï¼ˆ**GNU Compile Collection**ï¼Œ**GNU **ç¼–è¯‘å™¨å¥—è£…ï¼‰ï¼Œæ˜¯ä¸€å¥—ç”± **GNU** å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ç¼–è¯‘å™¨ã€‚æ¥æœ¬åªèƒ½å¤„ç† *C* è¯­è¨€ï¼Œåæ¥å¿«é€Ÿæ¼”è¿›ï¼Œå˜å¾—å¯å¤„ç† **C++ã€Objective-Cã€Javaã€Fortran** ç­‰å…¶ä»–è¯­è¨€ã€‚ä½†ç”±äºä¸€äº›ç¼ºé™·ï¼Œå¯¼è‡´äº† **Apple** æŠ›å¼ƒäº† **GCC** ï¼Œå¼€å‘å‡ºäº† **Clang** ä½œä¸ºå…¶å‰ç«¯ç¼–è¯‘å™¨ã€‚\n\n1. **GCC** çš„ **Objective-C Frontend** ä¸æ˜¯ **Apple** ç»´æŠ¤ï¼Œå¯¼è‡´æƒ³è¦æ·»åŠ ä¸€äº›è¯­æ³•æç¤ºç­‰åŠŸèƒ½å¾—å»è¦æ±‚ **GCC** å›¢é˜Ÿåšã€‚\n2. **GCC** çš„æ’ä»¶ã€å·¥å…·ã€**IDE** çš„æ”¯æŒè–„å¼±ã€‚\n3. **GCC** çš„ç¼–è¯‘æ•ˆç‡å’Œæ€§èƒ½ä¸è¶³ã€‚\n\n* **Clang**\n\n**Clang1.0** äº **2009** å¹´æ­£å¼ä¸ **LLVM2.6** æ­£å¼å‘å¸ƒï¼Œæ—¨åœ¨æä¾› **GCC** çš„æ›¿ä»£å“ï¼Œæ”¯æŒäº† **GUN** ç¼–è¯‘å™¨å¤§å¤šæ•°çš„ç¼–è¯‘å™¨è®¾ç½®ä»¥åŠéå®˜æ–¹è¯­è¨€çš„æ‹“å±•ï¼Œç›¸è¾ƒäº **GCC** ï¼Œ**Clang** å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n\n1. ç¼–è¯‘é€Ÿåº¦æ›´å¿«ã€‚\n2. å ç”¨å†…å­˜æ›´å°ã€‚\n3. æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‹“å±•ä¸é‡ç”¨ã€‚\n4. è¯Šæ–­ä¿¡æ¯å¯è¯»æ€§å¼ºã€‚\n\n* **SwiftC**\n\n**SwiftC** åœ¨å‰ç«¯é‡‡ç”¨äº† **SIL** ä¸­é—´è¯­è¨€ï¼Œè¿™æ˜¯å› ä¸º **Swift** ä½œä¸ºä¸€ç§é«˜çº§è¯­è¨€ï¼Œæœ‰è®¸å¤šç‰¹æ€§ï¼Œå¦‚ **protocol** çš„æ³›å‹ï¼Œä¹Ÿæ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œç¡®ä¿å˜é‡åœ¨ä½¿ç”¨ä¹‹å‰è¢«åˆå§‹åŒ–ã€æ£€æµ‹ä¸å¯æ‰§è¡Œçš„ä»£ç ï¼Œäºæ˜¯å¢åŠ äº†ä¸€å±‚ **SIL** æ¥åšè¿™äº›äº‹æƒ…ã€‚\n\n* **LLVM**\n\n**LLVM** æ˜¯ä¸€å¥—ç¼–è¯‘å™¨åŸºç¡€è®¾å¤‡é¡¹ç›®ï¼Œç”± **C++** å†™æˆï¼ŒåŒ…å«ä¸€ç³»åˆ—æ¨¡å—åŒ–çš„ç¼–è¯‘å™¨ç»„ä»¶å’Œå·¥å…·é“¾ï¼Œç”¨æ¥å¼€å‘ç¼–è¯‘å™¨çš„å‰ç«¯å’Œåç«¯ã€‚åœ¨ **iOS** ä¸­ï¼Œ**LLVM** ä½œä¸ºç¼–è¯‘å™¨åç«¯ä¸»è¦æä¾› **Optimizer** å’Œ **Code Generator** ï¼Œå°†æ¥æ”¶åˆ°çš„ **IR** ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»¥åŠæœºå™¨ä»£ç ç”Ÿæˆã€‚\n\n## 3. ç¼–è¯‘è¿‡ç¨‹\n\n### 3.1 æµç¨‹æ¢³ç†\n\n```mermaid\ngraph TD\n    subgraph Clang\n\tid1(æºä»£ç ) --> id2(é¢„å¤„ç†) \n    id2(é¢„å¤„ç†) --> id3(è¯­æ³•åˆ†æ)   \n    id3(è¯­æ³•åˆ†æ) --  token  --> id4(è¯­æ³•åˆ†æ)\n    id4(è¯­æ³•åˆ†æ) --  AST  --> id5(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    subgraph Optimizer, Backend\n    id6(ä¸­é—´ä»£ç ä¼˜åŒ–) --> id7(BitCodeç”Ÿæˆ)\n    id7(BitCodeç”Ÿæˆ) --> id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ)\n    id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ) --> id9(æœºå™¨ç ç”Ÿæˆ)\n    id9(æœºå™¨ç ç”Ÿæˆ) --> id11(é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶)\n    end\n    \n    subgraph SwiftC\n    id12(æºä»£ç ) --> id13(è§£æ)\n    id13(è§£æ) --> id14(è¯­ä¹‰åˆ†æ)\n    id14(è¯­ä¹‰åˆ†æ) --> id15(Clangå¯¼å…¥å™¨)\n    id15(Clangå¯¼å…¥å™¨) --> id16(SILç”Ÿæˆ)\n    id16(SILç”Ÿæˆ) --> id17(SILä¿è¯è½¬æ¢)\n    id17 --> id18(SILä¼˜åŒ–)\n    id18(SILä¼˜åŒ–) --> id19(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    id5 --  IR  --> id6\n    id19 --  IR  --> id6\n```\n\nåœ¨å‰ç«¯ **Objective-C** å’Œ **Swift** åˆ†åˆ«ç”±è‡ªå·±çš„å¤„ç†é˜¶æ®µï¼Œä½†æœ€åéƒ½ä¼šç”Ÿæˆ **IR** ä¸­é—´ä»£ç ï¼Œäº¤ç”±åç«¯è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚\n\nä¸‹é¢æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„.mæ–‡ä»¶è¿›è¡Œç¼–è¯‘è¿‡ç¨‹æ¢³ç†ï¼Œé¦–å…ˆåœ¨æŸä¸€ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª **nihao.m**æ–‡ä»¶\n\n```shell\ntouch nihao.m\n```\n\n**nihao.mï¼š**\n\n```objective-c\n#import <Foundation/Foundation.h>\nint main(int argc, char *argv[])\n{\n    @autoreleasepool {\n        NSLog(@\"nihao!!!\");\n        return 0;\n    }\n}\n```\n\n### 3.2 Clangé˜¶æ®µï¼ˆObjective-C / C++ / C / Objective-C++ï¼‰\n\n#### é¢„å¤„ç†é˜¶æ®µï¼š\n\n```shell\nxcrun clang -E helloworld.c | open -f\n```\n\n```\n# 1 \"nihao.m\"\n# 1 \"<built-in>\" 1\n# 1 \"<built-in>\" 3\n# 380 \"<built-in>\" 3\n# 1 \"<command line>\" 1\n# 1 \"<built-in>\" 2\n# 1 \"nihao.m\" 2\n# 1 \"/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/Foundation.framework/Headers/Foundation.h\" 1 3\n\n...\n...\n...\n\nint main(int argc, char *argv[])\n{\n    @autoreleasepool {\n        NSLog(@\"nihao!!!\");\n        return 0;\n    }\n}\n```\n\nå°†é¢„å¤„ç†é˜¶æ®µè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œ å¯ä»¥çœ‹åˆ°å¾ˆå¤šä»¥ **#** å¼€å¤´çš„è¯­å¥ï¼Œè¿™äº›è¯­å¥å‘Šè¯‰æˆ‘ä»¬åé¢è·Ÿç€çš„å†…å®¹æ¥è‡ªå“ªé‡Œï¼Œè¿™é‡Œå¯ä»¥çœ‹è§ **Foundation.h** æ–‡ä»¶çš„å†…å®¹ä¹ŸåŒ…å«äº†è¿›æ¥ã€‚åœ¨ **Xcode** ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ **Product ->  Perfrom Action -> Preprocess** æŸ¥çœ‹é¢„å¤„ç†é˜¶æ®µä¹‹åçš„ä»£ç ã€‚åœ¨é¢„å¤„ç†é˜¶æ®µåšäº†ä»¥ä¸‹è¿™äº›äº‹æƒ…ï¼š\n\n* å°†å¤´æ–‡ä»¶å¼•å…¥çš„å…¶ä»–æ–‡ä»¶åŠ å…¥æºæ–‡ä»¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚\n* è¿›è¡Œæ¡ä»¶ç¼–è¯‘å¤„ç†ã€‚\n* å°†å®å®šä¹‰ç›´æ¥æ›¿æ¢ï¼Œä¸è¿›è¡Œè¯­æ³•æ£€æŸ¥ã€‚\n* å°†æ³¨é‡Šè¿›è¡Œåˆ é™¤å¤„ç†ã€‚\n\n#### è¯æ³•åˆ†æé˜¶æ®µ\n\n```shell\nxcrun clang -fmodules -fsyntax-only -Xclang -dump-tokens nihao.m\n```\n\n```\nannot_module_include '#import <Foundation/Foundation.h>\n\n'\t\tLoc=<nihao.m:1:1>\nint 'int'\t [StartOfLine]\tLoc=<nihao.m:3:1>\nidentifier 'main'\t [LeadingSpace]\tLoc=<nihao.m:3:5>\nl_paren '('\t\tLoc=<nihao.m:3:9>\nint 'int'\t\tLoc=<nihao.m:3:10>\nidentifier 'argc'\t [LeadingSpace]\tLoc=<nihao.m:3:14>\ncomma ','\t\tLoc=<nihao.m:3:18>\nchar 'char'\t [LeadingSpace]\tLoc=<nihao.m:3:20>\nstar '*'\t [LeadingSpace]\tLoc=<nihao.m:3:25>\nidentifier 'argv'\t\tLoc=<nihao.m:3:26>\nl_square '['\t\tLoc=<nihao.m:3:30>\nr_square ']'\t\tLoc=<nihao.m:3:31>\nr_paren ')'\t\tLoc=<nihao.m:3:32>\nl_brace '{'\t [StartOfLine]\tLoc=<nihao.m:4:1>\nat '@'\t [StartOfLine] [LeadingSpace]\tLoc=<nihao.m:5:5>\nidentifier 'autoreleasepool'\t\tLoc=<nihao.m:5:6>\n...\n```\n\nè¯æ³•åˆ†æé˜¶æ®µå…¶å®æ˜¯å°†æºä»£ç ä»¥å­—ç¬¦æ–‡æœ¬çš„å½¢å¼è½¬æ¢æˆ **Token** æµçš„å½¢å¼ï¼Œä¸æ¶‰åŠè¯­ä¹‰æ ¡éªŒï¼Œç”¨æ¥æ ‡è¯†å‡ºè¿™ä¸ªå­—ç¬¦æ˜¯æ ‡è¯†ç¬¦ã€æ‹¬å·ã€ifè¯­å¥...ï¼Œæœ€åè¿˜ä¼šæ ‡è¯†å‡ºå…¶æ‰€åœ¨ä½ç½®ï¼Œæ–¹ä¾¿åç»­åˆ†æèƒ½å¤Ÿæ‰¾å‡ºå‡ºé”™çš„åŸå§‹ä½ç½®ã€‚\n\n#### è¯­æ³•åˆ†æé˜¶æ®µ\n\n```\nxcrun clang -fsyntax-only -Xclang -ast-dump nihao.m | open -f\n```\n\n```\n...\n`-FunctionDecl 0x7f9eb4bd61a0 <nihao.m:3:1, line:9:1> line:3:5 main 'int (int, char **)'\n  |-ParmVarDecl 0x7f9eb4bd5fc0 <col:10, col:14> col:14 argc 'int'\n  |-ParmVarDecl 0x7f9eb4bd6080 <col:20, col:31> col:26 argv 'char **':'char **'\n  `-CompoundStmt 0x7f9eb4bd63d0 <line:4:1, line:9:1>\n    `-ObjCAutoreleasePoolStmt 0x7f9eb4bd63b8 <line:5:5, line:8:5>\n      `-CompoundStmt 0x7f9eb4bd6398 <line:5:22, line:8:5>\n        |-CallExpr 0x7f9eb4bd6328 <line:6:9, col:26> 'void'\n        | |-ImplicitCastExpr 0x7f9eb4bd6310 <col:9> 'void (*)(id, ...)' <FunctionToPointerDecay>\n        | | `-DeclRefExpr 0x7f9eb4bd6250 <col:9> 'void (id, ...)' Function 0x7f9eb0c8d6c8 'NSLog' 'void (id, ...)'\n        | `-ImplicitCastExpr 0x7f9eb4bd6350 <col:15, col:16> 'id':'id' <BitCast>\n        |   `-ObjCStringLiteral 0x7f9eb4bd6290 <col:15, col:16> 'NSString *'\n        |     `-StringLiteral 0x7f9eb4bd6270 <col:16> 'char [9]' lvalue \"nihao!!!\"\n        `-ReturnStmt 0x7f9eb4bd6388 <line:7:9, col:16>\n          `-IntegerLiteral 0x7f9eb4bd6368 <col:16> 'int' 0\n```\n\nè¯­æ³•åˆ†æé˜¶æ®µä¼šè¾“å‡º **AST**ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œå®ƒæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚é€šè¿‡å®ƒï¼Œå¯ä»¥è¿›è¡Œè¯­æ³•é”™è¯¯åˆ†æï¼Œä»¥åŠé™æ€åˆ†ææ“ä½œï¼Œæ¶µç›–å†…å­˜æ“ä½œå’Œå®‰å…¨ç­‰æ–¹é¢ã€‚\n\n#### CodeGené˜¶æ®µ\n\n```shell\nxcrun clang -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll\n```\n\n```\n; ModuleID = 'nihao.m'\nsource_filename = \"nihao.m\"\ntarget datalayout = \"e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx11.0.0\"\n\n%struct.__NSConstantString_tag = type { i32*, i32, i8*, i64 }\n\n@__CFConstantStringClassReference = external global [0 x i32]\n@.str = private unnamed_addr constant [9 x i8] c\"nihao!!!\\00\", section \"__TEXT,__cstring,cstring_literals\", align 1\n@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag { i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 }, section \"__DATA,__cfstring\", align 8 #0\n\n; Function Attrs: noinline optnone ssp uwtable\ndefine i32 @main(i32 %0, i8** %1) #1 {\n  %3 = alloca i32, align 4\n  %4 = alloca i32, align 4\n  %5 = alloca i8**, align 8\n  store i32 0, i32* %3, align 4\n  store i32 %0, i32* %4, align 4\n  store i8** %1, i8*** %5, align 8\n  %6 = call i8* @llvm.objc.autoreleasePoolPush() #2\n  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*))\n  store i32 0, i32* %3, align 4\n  call void @llvm.objc.autoreleasePoolPop(i8* %6)\n  %7 = load i32, i32* %3, align 4\n  ret i32 %7\n}\n\n; Function Attrs: nounwind\ndeclare i8* @llvm.objc.autoreleasePoolPush() #2\n\ndeclare void @NSLog(i8*, ...) #3\n\n; Function Attrs: nounwind\ndeclare void @llvm.objc.autoreleasePoolPop(i8*) #2\n\nattributes #0 = { \"objc_arc_inert\" }\nattributes #1 = { noinline optnone ssp uwtable \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"min-legal-vector-width\"=\"0\" \"no-infs-fp-math\"=\"false\" \"no-jump-tables\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #2 = { nounwind }\nattributes #3 = { \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n\n!llvm.module.flags = !{!0, !1, !2, !3, !4, !5, !6, !7}\n!llvm.ident = !{!8}\n\n!0 = !{i32 2, !\"SDK Version\", [2 x i32] [i32 12, i32 0]}\n!1 = !{i32 1, !\"Objective-C Version\", i32 2}\n!2 = !{i32 1, !\"Objective-C Image Info Version\", i32 0}\n!3 = !{i32 1, !\"Objective-C Image Info Section\", !\"__DATA,__objc_imageinfo,regular,no_dead_strip\"}\n!4 = !{i32 1, !\"Objective-C Garbage Collection\", i8 0}\n!5 = !{i32 1, !\"Objective-C Class Properties\", i32 64}\n!6 = !{i32 1, !\"wchar_size\", i32 4}\n!7 = !{i32 7, !\"PIC Level\", i32 2}\n!8 = !{!\"Apple clang version 13.0.0 (clang-1300.0.29.3)\"}\n```\n\n**CodeGen** é˜¶æ®µè´Ÿè´£å°† **AST** è‡ªé¡¶å‘ä¸‹éå†é€æ­¥ç¿»è¯‘æˆ **LLVM IR**ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨åç«¯æ‰€éœ€è¦çš„ä¸­é—´ä»£ç ï¼ŒåŒæ—¶ **Objective-C** ä»£ç ä¹Ÿä¼šåœ¨è¿™ä¸€æ­¥è¿›è¡Œ **Runtime** æ¡¥æ¥ï¼š **property** åˆæˆï¼Œ**ARC** å¤„ç†ç­‰ï¼Œå¦‚ä¸Šæ–¹å¯ä»¥çœ‹è§ **autoreleasePoolPush** ã€ **autoreleasePoolPop** æ“ä½œã€‚\n\nè‡³æ­¤ **Clang** å‰ç«¯å·¥ä½œç®—æ˜¯å®Œæˆï¼Œæ¥ä¸‹æ¥å°±äº¤ç»™åç«¯è¿›è¡Œå¤„ç†ã€‚\n\n### 3.3 LLVM Optimizer é˜¶æ®µ\n\n#### IRä»£ç ä¼˜åŒ–\n\n```shell\nxcrun clang -Os -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll\n```\n\n```\n; ModuleID = 'nihao.m'\nsource_filename = \"nihao.m\"\ntarget datalayout = \"e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx11.0.0\"\n\n%struct.__NSConstantString_tag = type { i32*, i32, i8*, i64 }\n\n@__CFConstantStringClassReference = external global [0 x i32]\n@.str = private unnamed_addr constant [9 x i8] c\"nihao!!!\\00\", section \"__TEXT,__cstring,cstring_literals\", align 1\n@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag { i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 }, section \"__DATA,__cfstring\", align 8 #0\n\n; Function Attrs: optsize ssp uwtable\ndefine i32 @main(i32 %0, i8** nocapture readnone %1) local_unnamed_addr #1 {\n  %3 = tail call i8* @llvm.objc.autoreleasePoolPush() #2\n  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*)) #4, !clang.arc.no_objc_arc_exceptions !9\n  tail call void @llvm.objc.autoreleasePoolPop(i8* %3) #2\n  ret i32 0\n}\n\n; Function Attrs: nounwind\ndeclare i8* @llvm.objc.autoreleasePoolPush() #2\n\n; Function Attrs: optsize\ndeclare void @NSLog(i8*, ...) local_unnamed_addr #3\n\n; Function Attrs: nounwind\ndeclare void @llvm.objc.autoreleasePoolPop(i8*) #2\n\nattributes #0 = { \"objc_arc_inert\" }\nattributes #1 = { optsize ssp uwtable \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"min-legal-vector-width\"=\"0\" \"no-infs-fp-math\"=\"false\" \"no-jump-tables\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #2 = { nounwind }\nattributes #3 = { optsize \"darwin-stkchk-strong-link\" \"disable-tail-calls\"=\"false\" \"frame-pointer\"=\"all\" \"less-precise-fpmad\"=\"false\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"no-signed-zeros-fp-math\"=\"false\" \"no-trapping-math\"=\"true\" \"probe-stack\"=\"___chkstk_darwin\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"penryn\" \"target-features\"=\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\" \"tune-cpu\"=\"generic\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #4 = { optsize }\n\n!llvm.module.flags = !{!0, !1, !2, !3, !4, !5, !6, !7}\n!llvm.ident = !{!8}\n\n!0 = !{i32 2, !\"SDK Version\", [2 x i32] [i32 12, i32 0]}\n!1 = !{i32 1, !\"Objective-C Version\", i32 2}\n!2 = !{i32 1, !\"Objective-C Image Info Version\", i32 0}\n!3 = !{i32 1, !\"Objective-C Image Info Section\", !\"__DATA,__objc_imageinfo,regular,no_dead_strip\"}\n!4 = !{i32 1, !\"Objective-C Garbage Collection\", i8 0}\n!5 = !{i32 1, !\"Objective-C Class Properties\", i32 64}\n!6 = !{i32 1, !\"wchar_size\", i32 4}\n!7 = !{i32 7, !\"PIC Level\", i32 2}\n!8 = !{!\"Apple clang version 13.0.0 (clang-1300.0.29.3)\"}\n!9 = !{}\n```\n\n**IR** ä»£ç ä¼˜åŒ–ä¼šè°ƒç”¨ç›¸åº” **Pass** è¿›è¡Œå¤„ç†ï¼Œ**Pass** ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œéƒ½æ˜¯ **Pass** ç±»çš„å­ç±»ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„ä¼˜åŒ–ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè‡ªä¸»çš„æ§åˆ¶ä¼˜åŒ–çš„å¼ºåº¦ï¼Œåœ¨**Build Strrings -> Optimization Level** ä¸­å¯æŒ‡å®šä¼˜åŒ–ç¨‹åº¦ï¼Œä¸€äº›å¸¸è§çš„ä»£ç ä¼˜åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š\n\n* åˆ é™¤å…¬å…±å­è¡¨è¾¾å¼\n* åˆ é™¤æ— ç”¨ä»£ç \n* å¸¸é‡åˆå¹¶\n* ä»£ç ç§»åŠ¨\n* åˆ é™¤å½’çº³å˜é‡\n\n#### ç”Ÿæˆ BitCodeï¼ˆArchiveæ—¶ï¼‰\n\n```shell\nxrun clang -emit-llvm -c nihao.m -o nihao.bc\n```\n\n```\ndec0 170b 0000 0000 1400 0000 0010 0000\n0700 0001 4243 c0de 3514 0000 0700 0000\n620c 3024 9596 a6a5 f7d7 7f7d d3b4 4ffb\n76ef df3f 2d44 0132 0500 0000 210c 0000\n4903 0000 0b02 2100 0200 0000 1600 0000\n0781 2391 41c8 0449 0610 3239 9201 840c\n2505 0819 1e04 8b62 8014 4502 4292 0b42\na410 3214 3808 184b 0a32 5288 4870 c421\n...\n```\n\n**BitCode** æ˜¯ **LLVM** å¼•å…¥çš„å¦ä¸€ç§ä¸­é—´ä»£ç ï¼Œè™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒæ¥è¿‘æœºå™¨ç ï¼Œä½†æ˜¯åœ¨å‡½æ•°å’ŒæŒ‡ä»¤å±‚é¢ä½¿ç”¨äº†å¾ˆå¤šé«˜çº§è¯­è¨€çš„ç‰¹æ€§ã€‚\n\nä½†åªä¼šåœ¨ **Archive** æ—¶ï¼Œ**BitCode** æ‰ä¼šè¢«åµŒå…¥åˆ°é“¾æ¥åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºæäº¤ç»™ **App Store**ï¼ŒåŒ…å« **Bitcode** é…ç½®çš„ç¨‹åºå°†ä¼šåœ¨ **App Store** ä¸Šè¢«é‡æ–°ç¼–è¯‘å’Œé“¾æ¥ï¼Œè¿›è€Œå¯¹å¯æ‰§è¡Œæ–‡ä»¶åšä¼˜åŒ–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¼˜åŒ–è¿™ä¸€æ­¥æ˜¯åœ¨ **App Store** ä¸­åšçš„å¤„ç†ï¼Œæœ¬åœ°æ²¡æœ‰åšå¤„ç†ã€‚è¿›è¡Œå…¶ä»–ç±»å‹çš„ **Build** (é **Archive** )æ—¶ï¼Œç¼–è¯‘å™¨åªä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³å¼€å¯ **BitCode** çš„æ¡ä»¶ï¼Œä½†å¹¶ä¸ä¼šçœŸæ­£ç”Ÿæˆ **BitCode** ã€‚\n\n### 3.4 LLVM Code Generatoré˜¶æ®µ\n\n#### ç”Ÿæˆæ±‡ç¼–ä»£ç \n\n```shell\nxcrun clang -S -fobjc-arc nihao.m -o nihao.s\n```\n\n```\n\t.section\t__TEXT,__text,regular,pure_instructions\n\t.build_version macos, 11, 0\tsdk_version 12, 0\n\t.globl\t_main                           ## -- Begin function main\n\t.p2align\t4, 0x90\n_main:                                  ## @main\n\t.cfi_startproc\n## %bb.0:\n\tpushq\t%rbp\n\t.cfi_def_cfa_offset 16\n\t.cfi_offset %rbp, -16\n\tmovq\t%rsp, %rbp\n\t.cfi_def_cfa_register %rbp\n\tsubq\t$32, %rsp\n\tmovl\t$0, -4(%rbp)\n\tmovl\t%edi, -8(%rbp)\n\tmovq\t%rsi, -16(%rbp)\n\tcallq\t_objc_autoreleasePoolPush\n\tmovq\t%rax, -24(%rbp)                 ## 8-byte Spill\n\tleaq\tL__unnamed_cfstring_(%rip), %rdi\n\tmovb\t$0, %al\n\tcallq\t_NSLog\n\tmovq\t-24(%rbp), %rdi                 ## 8-byte Reload\n\tmovl\t$0, -4(%rbp)\n\tcallq\t_objc_autoreleasePoolPop\n\tmovl\t-4(%rbp), %eax\n\taddq\t$32, %rsp\n\tpopq\t%rbp\n\tretq\n\t.cfi_endproc\n                                        ## -- End function\n\t.section\t__TEXT,__cstring,cstring_literals\nL_.str:                                 ## @.str\n\t.asciz\t\"nihao!!!\"\n\n\t.section\t__DATA,__cfstring\n\t.p2align\t3                               ## @_unnamed_cfstring_\nL__unnamed_cfstring_:\n\t.quad\t___CFConstantStringClassReference\n\t.long\t1992                            ## 0x7c8\n\t.space\t4\n\t.quad\tL_.str\n\t.quad\t8                               ## 0x8\n\n\t.section\t__DATA,__objc_imageinfo,regular,no_dead_strip\nL_OBJC_IMAGE_INFO:\n\t.long\t0\n\t.long\t64\n\n.subsections_via_symbols\n```\n\næ±‡ç¼–è¯­è¨€æ›´åŠ æ¥è¿‘æœºå™¨è¯­è¨€ï¼Œèƒ½å¤Ÿç›´æ¥å¯¹ç¡¬ä»¶è¿›è¡Œæ“ä½œï¼Œç”Ÿæˆçš„ç¨‹åºä¸å…¶ä»–çš„è¯­è¨€ç›¸æ¯”å…·æœ‰æ›´é«˜çš„è¿è¡Œé€Ÿåº¦ï¼Œå ç”¨æ›´å°çš„å†…å­˜ã€‚\n\nç›®å‰æ‰€æœ‰ **iOS** è®¾å¤‡éƒ½é‡‡ç”¨ **ARM** å¤„ç†å™¨ï¼Œè¿™æ„å‘³ç€éƒ½æ˜¯é‡‡ç”¨ **ARM** æŒ‡ä»¤é›†ï¼Œå¦‚ **armv6 / armv7 / armv7s / arm64**ï¼Œè¿™äº›æŒ‡ä»¤é›†éƒ½æ˜¯å‘ä¸‹å…¼å®¹çš„ã€‚\n\næ¯ç§ **CPU** æ¶æ„éƒ½æœ‰ç€ç›¸åº”çš„æŒ‡ä»¤é›†ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ¶æ„äº§ç”Ÿä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤ï¼ŒåŠ ä¸Šä¸Šé¢ **- arch arch_type** é€‰é¡¹å³å¯ï¼Œæ›´å¤šè¯·å‚è§[å®˜ç½‘](https://developer.apple.com/library/archive/documentation/DeveloperTools/Reference/Assembler/000-Introduction/introduction.html)ã€‚åœ¨ **Xcode** ä¸­å¯åœ¨ **Build Settings -> Architectrues** æŒ‡å®šäº§ç”Ÿçš„ **CPU** æŒ‡ä»¤é›†ã€‚\n\n#### ç”Ÿæˆæœºå™¨ä»£ç \n\n```shell\nxcrun clang -fmodules -c nihao.s -o nihao.o\n```\n\nå¯ä»¥å‘ç°æœºå™¨ç äºŒè¿›åˆ¶æ–‡ä»¶æ— æ³•é˜…è¯»ï¼Œå¯å€ŸåŠ© **otool** æˆ–è€… **MachOView** ç­‰å·¥å…·æŸ¥çœ‹æ–‡ä»¶ä¸­çš„ç›¸å…³å†…å®¹ï¼š\n\n```shell\notool -v -h nihao.o\n```\n\n```\nnihao.o:\nMach header\n      magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64   X86_64        ALL  0x00      OBJECT     4        680 SUBSECTIONS_VIA_SYMBOLS\n```\n\nå¯ä»¥çœ‹è§ **.o** æ–‡ä»¶å®é™…ä¸Šæ˜¯ **mach-o** æ ¼å¼ï¼Œè¿™é‡Œæˆ‘ä»¬è¾“å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„å¤´éƒ¨ï¼Œè§„å®šäº†è¿™ä¸ªæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œé€‚åº”æ¶æ„çš„ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠæ–‡ä»¶æ˜¯å¦‚ä½•è¢«åŠ è½½çš„ã€‚æ›´å¤šå…³äº **mach-o** çš„çŸ¥è¯†[å‚è§](https://www.jianshu.com/p/54d842db3f69)ã€‚\n\n#### é“¾æ¥\n\n```shell\nxcrun clang nihao.o -Wl,`xcrun --show-sdk-path`/System/Library/Frameworks/Foundation.framework/Foundation\n```\n\n```shell\n./a.out\n```\n\n```\n2021-11-03 16:06:41.734 a.out[6394:220026] nihao!!!\n```\n\nç”±äºæˆ‘ä»¬å¼•å…¥äº† **Foundation** é‡Œé¢çš„æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°†ç›®æ ‡æ–‡ä»¶å’Œ **Foundation framework**è¿›è¡Œé“¾æ¥ï¼Œæ¥ç€å°±å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºäº†ã€‚\n\nè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šç¬¦å·è¡¨ï¼Œé‡Œé¢å­˜å‚¨çš„å…ƒç´ å¦‚ä¸‹ï¼š\n\n```xml\n<èµ·å§‹åœ°å€> <ç»“æŸåœ°å€> <å‡½æ•°> [<æ–‡ä»¶å:è¡Œå·>]\n```\n\nè¿™é‡Œæˆ‘ä»¬è¾“å…¥a.outçš„ç¬¦å·ä¿¡æ¯\n\n```\nnm -nm a.out\n```\n\n```\n                 (undefined) external _NSLog (from Foundation)\n                 (undefined) external ___CFConstantStringClassReference (from CoreFoundation)\n                 (undefined) external _objc_autoreleasePoolPop (from libobjc)\n                 (undefined) external _objc_autoreleasePoolPush (from libobjc)\n                 (undefined) external dyld_stub_binder (from libSystem)\n0000000100000000 (__TEXT,__text) [referenced dynamically] external __mh_execute_header\n0000000100003f20 (__TEXT,__text) external _main\n0000000100008018 (__DATA,__data) non-external __dyld_private\n```\n\nå¯¹äºåŠ¨æ€é“¾æ¥åº“çš„ç¬¦å·ï¼ˆå¦‚ **Foundation**ï¼‰ï¼Œæœ€ç»ˆä¼šè®°å½•ä¸‹è¿™ä¸ªç¬¦å·æ˜¯é€šè¿‡è¿›è¡Œé“¾æ¥çš„ï¼Œå¹¶è®°å½•ä¸‹ä¾èµ–äºå“ªä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨ï¼ˆ**dyld**ï¼‰ä¼šå»è§£æè¿™äº› **undefined** ç¬¦å·ã€‚å¯¹äºå…¶ä»–ä½ç½®çš„ç¬¦å·ï¼Œä¼šç›´æ¥ä¿®æ­£è¿™äº›ç¬¦å·çš„å…·ä½“ä½ç½®ä¿¡æ¯ã€‚\n\n## 4. æ€»ç»“\n\næœ¬æ–‡ä»‹ç»äº†å…³äº iOS ç¼–è¯‘å™¨ã€iOS ç¼–è¯‘è¿‡ç¨‹çš„åŸºç¡€çŸ¥è¯†ã€‚å­¦ä¹ äº†è¿™äº›ï¼Œå¯¹ iOS ç¼–è¯‘æœ‰ä¸ªæ•´ä½“è®¤è¯†ã€‚å°±æœ¬äººè€Œè¨€ï¼Œåœ¨ä¸€è·¯æœå¯»èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹ä¹‹å‰ä¸€äº›é›¶æ•£çš„çŸ¥è¯†ç‚¹æœ‰äº†ä¸€äº›æ›´åŠ æ·±å…¥çš„è®¤è¯†ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œå…³äº SwiftC çš„ç¼–è¯‘è¿‡ç¨‹æ²¡æœ‰å¤šåšä»‹ç»ï¼Œåé¢ä¼šå†å‡ºä¸€ç¯‡è¿›è¡Œä»‹ç»ã€‚\n\n\n\nğŸ”—ï¼š\n\n[ObjC ä¸­å›½ - Mach-O å¯æ‰§è¡Œæ–‡ä»¶](https://objccn.io/issue-6-3/)\n\n[ä»£ç ä¼˜åŒ–ä¸LLVM IR pass](https://kiprey.github.io/2020/06/LLVM-IR-pass/)\n\n[å…³äºbitcode, çŸ¥é“è¿™äº›å°±å¤Ÿäº†](http://xelz.info/blog/2018/11/24/all-you-need-to-know-about-bitcode/)\n\n[iOS ç¼–è¯‘é“¾æ¥ï¼šObjective-C ç¼–è¯‘é“¾æ¥](https://zhuanlan.zhihu.com/p/340782811)\n\n[è¶£æ¢ Mach-Oï¼šæ–‡ä»¶æ ¼å¼åˆ†æ](https://www.jianshu.com/p/54d842db3f69)\n\n","slug":"2021-11-03-iOSç¼–è¯‘è¿‡ç¨‹","published":1,"date":"2021-11-02T02:35:36.461Z","updated":"2021-11-04T06:32:54.165Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckvko2j290001qezucdkignnj","content":"\n        <h1 id=\"iOS-ç¼–è¯‘è¿‡ç¨‹\"   >\n          <a href=\"#iOS-ç¼–è¯‘è¿‡ç¨‹\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#iOS-ç¼–è¯‘è¿‡ç¨‹\" class=\"headerlink\" title=\"iOS ç¼–è¯‘è¿‡ç¨‹\"></a>iOS ç¼–è¯‘è¿‡ç¨‹</h1>\n      \n        <h2 id=\"1-å‰è¨€\"   >\n          <a href=\"#1-å‰è¨€\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#1-å‰è¨€\" class=\"headerlink\" title=\"1. å‰è¨€\"></a>1. å‰è¨€</h2>\n      <p>å­¦ä¹  <strong>iOS</strong> ç¼–è¯‘è¿‡ç¨‹ï¼ˆ<strong>Compile</strong>ï¼‰æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½ç†è§£ä»£ç æ˜¯å¦‚ä½•è¢«è®¡ç®—æœºè¿ä½œèµ·æ¥ï¼Œç¼–è¯‘å™¨ä¸ºä»£ç åšäº†å“ªäº›ä¼˜åŒ–ï¼Œè®©æˆ‘ä»¬å­¦ä¼šä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹å¾…é—®é¢˜ã€‚</p>\n\n        <h2 id=\"2-ç¼–è¯‘å™¨ç»“æ„\"   >\n          <a href=\"#2-ç¼–è¯‘å™¨ç»“æ„\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#2-ç¼–è¯‘å™¨ç»“æ„\" class=\"headerlink\" title=\"2. ç¼–è¯‘å™¨ç»“æ„\"></a>2. ç¼–è¯‘å™¨ç»“æ„</h2>\n      <p>ç°ä»£ç¼–è¯‘å™¨æ˜¯å°†æºä»£ç è½¬æ¢æˆå¯æ‰§è¡Œæ–‡ä»¶çš„ç¨‹åºï¼Œå·¥ä½œæµç¨‹ä¸»è¦åˆ†ä¸º <strong>å‰ç«¯</strong> å’Œ <strong>åç«¯</strong> ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>\n<ol>\n<li>å‰ç«¯ï¼šå¯¹æºä»£ç è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆä¸­é—´ä»£ç ã€‚</li>\n<li>åç«¯ï¼šé’ˆå¯¹ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬æ¢æˆç›®æ ‡æœºå™¨çš„ä»£ç æŒ‡ä»¤ã€‚</li>\n</ol>\n<pre class=\"mermaid\">graph LR\n    A(SourceCode) --> B(Frontend)\n    B(Frontend) --> C(Backend)\n    C(Backend) --> D(Machine Code)</pre>\n\n<p>é’ˆå¯¹iOSå¹³å°ï¼Œä¸åŒè¯­è¨€é‡‡ç”¨äº†ä¸åŒçš„ç¼–è¯‘å™¨å‰ç«¯ï¼š</p>\n<ol>\n<li><p><strong>Frontendï¼šClang / SwiftC</strong></p>\n<p>å¯¹äº <strong>Objective-C / C / C++ / Objective-C++</strong>  æ¥è¯´é‡‡ç”¨ <strong>Clang</strong> ç¼–è¯‘å™¨å‰ç«¯ï¼›</p>\n<p>å¯¹äº <strong>Swift</strong> æ¥è¯´åˆ™é‡‡ç”¨ <strong>SwiftC</strong>ï¼›</p>\n</li>\n<li><p><strong>Backendï¼šLLVM</strong></p>\n<p>æ— è®ºæ˜¯ <strong>C</strong> ç³»è¯­è¨€è¿˜æ˜¯ <strong>Swift</strong> éƒ½é‡‡ç”¨ <strong>LLVM</strong> ä½œä¸ºç¼–è¯‘å™¨åç«¯ï¼›</p>\n</li>\n</ol>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯åœ¨ <strong>Xcode3</strong> ä»¥å‰ï¼Œéƒ½é‡‡ç”¨ <strong>GCC</strong> ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ï¼Œä½†ä¸º <strong>Apple</strong> å¿«é€Ÿå‘å±•éœ€è¦åŠŸèƒ½æ›´å¼ºå¤§å’Œæ€§èƒ½æ›´å¥½çš„ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥ <strong>Apple</strong> è‡ªå·±å¼€å‘äº† <strong>Clang</strong> ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ã€‚ä¸‹é¢å¯¹ç¼–è¯‘å™¨åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼š</p>\n<ul>\n<li><strong>GCC</strong></li>\n</ul>\n<p><strong>GCC</strong>ï¼ˆ<strong>GNU Compile Collection</strong>ï¼Œ**GNU **ç¼–è¯‘å™¨å¥—è£…ï¼‰ï¼Œæ˜¯ä¸€å¥—ç”± <strong>GNU</strong> å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ç¼–è¯‘å™¨ã€‚æ¥æœ¬åªèƒ½å¤„ç† <em>C</em> è¯­è¨€ï¼Œåæ¥å¿«é€Ÿæ¼”è¿›ï¼Œå˜å¾—å¯å¤„ç† <strong>C++ã€Objective-Cã€Javaã€Fortran</strong> ç­‰å…¶ä»–è¯­è¨€ã€‚ä½†ç”±äºä¸€äº›ç¼ºé™·ï¼Œå¯¼è‡´äº† <strong>Apple</strong> æŠ›å¼ƒäº† <strong>GCC</strong> ï¼Œå¼€å‘å‡ºäº† <strong>Clang</strong> ä½œä¸ºå…¶å‰ç«¯ç¼–è¯‘å™¨ã€‚</p>\n<ol>\n<li><strong>GCC</strong> çš„ <strong>Objective-C Frontend</strong> ä¸æ˜¯ <strong>Apple</strong> ç»´æŠ¤ï¼Œå¯¼è‡´æƒ³è¦æ·»åŠ ä¸€äº›è¯­æ³•æç¤ºç­‰åŠŸèƒ½å¾—å»è¦æ±‚ <strong>GCC</strong> å›¢é˜Ÿåšã€‚</li>\n<li><strong>GCC</strong> çš„æ’ä»¶ã€å·¥å…·ã€<strong>IDE</strong> çš„æ”¯æŒè–„å¼±ã€‚</li>\n<li><strong>GCC</strong> çš„ç¼–è¯‘æ•ˆç‡å’Œæ€§èƒ½ä¸è¶³ã€‚</li>\n</ol>\n<ul>\n<li><strong>Clang</strong></li>\n</ul>\n<p><strong>Clang1.0</strong> äº <strong>2009</strong> å¹´æ­£å¼ä¸ <strong>LLVM2.6</strong> æ­£å¼å‘å¸ƒï¼Œæ—¨åœ¨æä¾› <strong>GCC</strong> çš„æ›¿ä»£å“ï¼Œæ”¯æŒäº† <strong>GUN</strong> ç¼–è¯‘å™¨å¤§å¤šæ•°çš„ç¼–è¯‘å™¨è®¾ç½®ä»¥åŠéå®˜æ–¹è¯­è¨€çš„æ‹“å±•ï¼Œç›¸è¾ƒäº <strong>GCC</strong> ï¼Œ<strong>Clang</strong> å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ol>\n<li>ç¼–è¯‘é€Ÿåº¦æ›´å¿«ã€‚</li>\n<li>å ç”¨å†…å­˜æ›´å°ã€‚</li>\n<li>æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‹“å±•ä¸é‡ç”¨ã€‚</li>\n<li>è¯Šæ–­ä¿¡æ¯å¯è¯»æ€§å¼ºã€‚</li>\n</ol>\n<ul>\n<li><strong>SwiftC</strong></li>\n</ul>\n<p><strong>SwiftC</strong> åœ¨å‰ç«¯é‡‡ç”¨äº† <strong>SIL</strong> ä¸­é—´è¯­è¨€ï¼Œè¿™æ˜¯å› ä¸º <strong>Swift</strong> ä½œä¸ºä¸€ç§é«˜çº§è¯­è¨€ï¼Œæœ‰è®¸å¤šç‰¹æ€§ï¼Œå¦‚ <strong>protocol</strong> çš„æ³›å‹ï¼Œä¹Ÿæ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œç¡®ä¿å˜é‡åœ¨ä½¿ç”¨ä¹‹å‰è¢«åˆå§‹åŒ–ã€æ£€æµ‹ä¸å¯æ‰§è¡Œçš„ä»£ç ï¼Œäºæ˜¯å¢åŠ äº†ä¸€å±‚ <strong>SIL</strong> æ¥åšè¿™äº›äº‹æƒ…ã€‚</p>\n<ul>\n<li><strong>LLVM</strong></li>\n</ul>\n<p><strong>LLVM</strong> æ˜¯ä¸€å¥—ç¼–è¯‘å™¨åŸºç¡€è®¾å¤‡é¡¹ç›®ï¼Œç”± <strong>C++</strong> å†™æˆï¼ŒåŒ…å«ä¸€ç³»åˆ—æ¨¡å—åŒ–çš„ç¼–è¯‘å™¨ç»„ä»¶å’Œå·¥å…·é“¾ï¼Œç”¨æ¥å¼€å‘ç¼–è¯‘å™¨çš„å‰ç«¯å’Œåç«¯ã€‚åœ¨ <strong>iOS</strong> ä¸­ï¼Œ<strong>LLVM</strong> ä½œä¸ºç¼–è¯‘å™¨åç«¯ä¸»è¦æä¾› <strong>Optimizer</strong> å’Œ <strong>Code Generator</strong> ï¼Œå°†æ¥æ”¶åˆ°çš„ <strong>IR</strong> ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»¥åŠæœºå™¨ä»£ç ç”Ÿæˆã€‚</p>\n\n        <h2 id=\"3-ç¼–è¯‘è¿‡ç¨‹\"   >\n          <a href=\"#3-ç¼–è¯‘è¿‡ç¨‹\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-ç¼–è¯‘è¿‡ç¨‹\" class=\"headerlink\" title=\"3. ç¼–è¯‘è¿‡ç¨‹\"></a>3. ç¼–è¯‘è¿‡ç¨‹</h2>\n      \n        <h3 id=\"3-1-æµç¨‹æ¢³ç†\"   >\n          <a href=\"#3-1-æµç¨‹æ¢³ç†\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-1-æµç¨‹æ¢³ç†\" class=\"headerlink\" title=\"3.1 æµç¨‹æ¢³ç†\"></a>3.1 æµç¨‹æ¢³ç†</h3>\n      <pre class=\"mermaid\">graph TD\n    subgraph Clang\n    id1(æºä»£ç ) --> id2(é¢„å¤„ç†) \n    id2(é¢„å¤„ç†) --> id3(è¯­æ³•åˆ†æ)   \n    id3(è¯­æ³•åˆ†æ) --  token  --> id4(è¯­æ³•åˆ†æ)\n    id4(è¯­æ³•åˆ†æ) --  AST  --> id5(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    subgraph Optimizer, Backend\n    id6(ä¸­é—´ä»£ç ä¼˜åŒ–) --> id7(BitCodeç”Ÿæˆ)\n    id7(BitCodeç”Ÿæˆ) --> id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ)\n    id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ) --> id9(æœºå™¨ç ç”Ÿæˆ)\n    id9(æœºå™¨ç ç”Ÿæˆ) --> id11(é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶)\n    end\n    \n    subgraph SwiftC\n    id12(æºä»£ç ) --> id13(è§£æ)\n    id13(è§£æ) --> id14(è¯­ä¹‰åˆ†æ)\n    id14(è¯­ä¹‰åˆ†æ) --> id15(Clangå¯¼å…¥å™¨)\n    id15(Clangå¯¼å…¥å™¨) --> id16(SILç”Ÿæˆ)\n    id16(SILç”Ÿæˆ) --> id17(SILä¿è¯è½¬æ¢)\n    id17 --> id18(SILä¼˜åŒ–)\n    id18(SILä¼˜åŒ–) --> id19(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    id5 --  IR  --> id6\n    id19 --  IR  --> id6</pre>\n\n<p>åœ¨å‰ç«¯ <strong>Objective-C</strong> å’Œ <strong>Swift</strong> åˆ†åˆ«ç”±è‡ªå·±çš„å¤„ç†é˜¶æ®µï¼Œä½†æœ€åéƒ½ä¼šç”Ÿæˆ <strong>IR</strong> ä¸­é—´ä»£ç ï¼Œäº¤ç”±åç«¯è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„.mæ–‡ä»¶è¿›è¡Œç¼–è¯‘è¿‡ç¨‹æ¢³ç†ï¼Œé¦–å…ˆåœ¨æŸä¸€ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <strong>nihao.m</strong>æ–‡ä»¶</p>\n<figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch nihao.m</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>nihao.mï¼š</strong></p>\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#import &lt;Foundation/Foundation.h&gt;</span><br><span class=\"line\">int main(int argc, char *argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    @autoreleasepool &#123;</span><br><span class=\"line\">        NSLog(@&quot;nihao!!!&quot;);</span><br><span class=\"line\">        return 0;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n\n        <h3 id=\"3-2-Clangé˜¶æ®µï¼ˆObjective-C-C-C-Objective-C-ï¼‰\"   >\n          <a href=\"#3-2-Clangé˜¶æ®µï¼ˆObjective-C-C-C-Objective-C-ï¼‰\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-2-Clangé˜¶æ®µï¼ˆObjective-C-C-C-Objective-C-ï¼‰\" class=\"headerlink\" title=\"3.2 Clangé˜¶æ®µï¼ˆObjective-C / C++ / C / Objective-C++ï¼‰\"></a>3.2 Clangé˜¶æ®µï¼ˆObjective-C / C++ / C / Objective-C++ï¼‰</h3>\n      \n        <h4 id=\"é¢„å¤„ç†é˜¶æ®µï¼š\"   >\n          <a href=\"#é¢„å¤„ç†é˜¶æ®µï¼š\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é¢„å¤„ç†é˜¶æ®µï¼š\" class=\"headerlink\" title=\"é¢„å¤„ç†é˜¶æ®µï¼š\"></a>é¢„å¤„ç†é˜¶æ®µï¼š</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -E helloworld.c | open -f</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1 &quot;nihao.m&quot;</span><br><span class=\"line\"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class=\"line\"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class=\"line\"># 380 &quot;&lt;built-in&gt;&quot; 3</span><br><span class=\"line\"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class=\"line\"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class=\"line\"># 1 &quot;nihao.m&quot; 2</span><br><span class=\"line\"># 1 &quot;/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/Foundation.framework/Headers/Foundation.h&quot; 1 3</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char *argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    @autoreleasepool &#123;</span><br><span class=\"line\">        NSLog(@&quot;nihao!!!&quot;);</span><br><span class=\"line\">        return 0;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>å°†é¢„å¤„ç†é˜¶æ®µè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œ å¯ä»¥çœ‹åˆ°å¾ˆå¤šä»¥ <strong>#</strong> å¼€å¤´çš„è¯­å¥ï¼Œè¿™äº›è¯­å¥å‘Šè¯‰æˆ‘ä»¬åé¢è·Ÿç€çš„å†…å®¹æ¥è‡ªå“ªé‡Œï¼Œè¿™é‡Œå¯ä»¥çœ‹è§ <strong>Foundation.h</strong> æ–‡ä»¶çš„å†…å®¹ä¹ŸåŒ…å«äº†è¿›æ¥ã€‚åœ¨ <strong>Xcode</strong> ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <strong>Product -&gt;  Perfrom Action -&gt; Preprocess</strong> æŸ¥çœ‹é¢„å¤„ç†é˜¶æ®µä¹‹åçš„ä»£ç ã€‚åœ¨é¢„å¤„ç†é˜¶æ®µåšäº†ä»¥ä¸‹è¿™äº›äº‹æƒ…ï¼š</p>\n<ul>\n<li>å°†å¤´æ–‡ä»¶å¼•å…¥çš„å…¶ä»–æ–‡ä»¶åŠ å…¥æºæ–‡ä»¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚</li>\n<li>è¿›è¡Œæ¡ä»¶ç¼–è¯‘å¤„ç†ã€‚</li>\n<li>å°†å®å®šä¹‰ç›´æ¥æ›¿æ¢ï¼Œä¸è¿›è¡Œè¯­æ³•æ£€æŸ¥ã€‚</li>\n<li>å°†æ³¨é‡Šè¿›è¡Œåˆ é™¤å¤„ç†ã€‚</li>\n</ul>\n\n        <h4 id=\"è¯æ³•åˆ†æé˜¶æ®µ\"   >\n          <a href=\"#è¯æ³•åˆ†æé˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#è¯æ³•åˆ†æé˜¶æ®µ\" class=\"headerlink\" title=\"è¯æ³•åˆ†æé˜¶æ®µ\"></a>è¯æ³•åˆ†æé˜¶æ®µ</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -fmodules -fsyntax-only -Xclang -dump-tokens nihao.m</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">annot_module_include &#x27;#import &lt;Foundation/Foundation.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x27;\t\tLoc=&lt;nihao.m:1:1&gt;</span><br><span class=\"line\">int &#x27;int&#x27;\t [StartOfLine]\tLoc=&lt;nihao.m:3:1&gt;</span><br><span class=\"line\">identifier &#x27;main&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:5&gt;</span><br><span class=\"line\">l_paren &#x27;(&#x27;\t\tLoc=&lt;nihao.m:3:9&gt;</span><br><span class=\"line\">int &#x27;int&#x27;\t\tLoc=&lt;nihao.m:3:10&gt;</span><br><span class=\"line\">identifier &#x27;argc&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:14&gt;</span><br><span class=\"line\">comma &#x27;,&#x27;\t\tLoc=&lt;nihao.m:3:18&gt;</span><br><span class=\"line\">char &#x27;char&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:20&gt;</span><br><span class=\"line\">star &#x27;*&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:25&gt;</span><br><span class=\"line\">identifier &#x27;argv&#x27;\t\tLoc=&lt;nihao.m:3:26&gt;</span><br><span class=\"line\">l_square &#x27;[&#x27;\t\tLoc=&lt;nihao.m:3:30&gt;</span><br><span class=\"line\">r_square &#x27;]&#x27;\t\tLoc=&lt;nihao.m:3:31&gt;</span><br><span class=\"line\">r_paren &#x27;)&#x27;\t\tLoc=&lt;nihao.m:3:32&gt;</span><br><span class=\"line\">l_brace &#x27;&#123;&#x27;\t [StartOfLine]\tLoc=&lt;nihao.m:4:1&gt;</span><br><span class=\"line\">at &#x27;@&#x27;\t [StartOfLine] [LeadingSpace]\tLoc=&lt;nihao.m:5:5&gt;</span><br><span class=\"line\">identifier &#x27;autoreleasepool&#x27;\t\tLoc=&lt;nihao.m:5:6&gt;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></div></figure>\n\n<p>è¯æ³•åˆ†æé˜¶æ®µå…¶å®æ˜¯å°†æºä»£ç ä»¥å­—ç¬¦æ–‡æœ¬çš„å½¢å¼è½¬æ¢æˆ <strong>Token</strong> æµçš„å½¢å¼ï¼Œä¸æ¶‰åŠè¯­ä¹‰æ ¡éªŒï¼Œç”¨æ¥æ ‡è¯†å‡ºè¿™ä¸ªå­—ç¬¦æ˜¯æ ‡è¯†ç¬¦ã€æ‹¬å·ã€ifè¯­å¥â€¦ï¼Œæœ€åè¿˜ä¼šæ ‡è¯†å‡ºå…¶æ‰€åœ¨ä½ç½®ï¼Œæ–¹ä¾¿åç»­åˆ†æèƒ½å¤Ÿæ‰¾å‡ºå‡ºé”™çš„åŸå§‹ä½ç½®ã€‚</p>\n\n        <h4 id=\"è¯­æ³•åˆ†æé˜¶æ®µ\"   >\n          <a href=\"#è¯­æ³•åˆ†æé˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#è¯­æ³•åˆ†æé˜¶æ®µ\" class=\"headerlink\" title=\"è¯­æ³•åˆ†æé˜¶æ®µ\"></a>è¯­æ³•åˆ†æé˜¶æ®µ</h4>\n      <figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -fsyntax-only -Xclang -ast-dump nihao.m | open -f</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">`-FunctionDecl 0x7f9eb4bd61a0 &lt;nihao.m:3:1, line:9:1&gt; line:3:5 main &#x27;int (int, char **)&#x27;</span><br><span class=\"line\">  |-ParmVarDecl 0x7f9eb4bd5fc0 &lt;col:10, col:14&gt; col:14 argc &#x27;int&#x27;</span><br><span class=\"line\">  |-ParmVarDecl 0x7f9eb4bd6080 &lt;col:20, col:31&gt; col:26 argv &#x27;char **&#x27;:&#x27;char **&#x27;</span><br><span class=\"line\">  `-CompoundStmt 0x7f9eb4bd63d0 &lt;line:4:1, line:9:1&gt;</span><br><span class=\"line\">    `-ObjCAutoreleasePoolStmt 0x7f9eb4bd63b8 &lt;line:5:5, line:8:5&gt;</span><br><span class=\"line\">      `-CompoundStmt 0x7f9eb4bd6398 &lt;line:5:22, line:8:5&gt;</span><br><span class=\"line\">        |-CallExpr 0x7f9eb4bd6328 &lt;line:6:9, col:26&gt; &#x27;void&#x27;</span><br><span class=\"line\">        | |-ImplicitCastExpr 0x7f9eb4bd6310 &lt;col:9&gt; &#x27;void (*)(id, ...)&#x27; &lt;FunctionToPointerDecay&gt;</span><br><span class=\"line\">        | | `-DeclRefExpr 0x7f9eb4bd6250 &lt;col:9&gt; &#x27;void (id, ...)&#x27; Function 0x7f9eb0c8d6c8 &#x27;NSLog&#x27; &#x27;void (id, ...)&#x27;</span><br><span class=\"line\">        | `-ImplicitCastExpr 0x7f9eb4bd6350 &lt;col:15, col:16&gt; &#x27;id&#x27;:&#x27;id&#x27; &lt;BitCast&gt;</span><br><span class=\"line\">        |   `-ObjCStringLiteral 0x7f9eb4bd6290 &lt;col:15, col:16&gt; &#x27;NSString *&#x27;</span><br><span class=\"line\">        |     `-StringLiteral 0x7f9eb4bd6270 &lt;col:16&gt; &#x27;char [9]&#x27; lvalue &quot;nihao!!!&quot;</span><br><span class=\"line\">        `-ReturnStmt 0x7f9eb4bd6388 &lt;line:7:9, col:16&gt;</span><br><span class=\"line\">          `-IntegerLiteral 0x7f9eb4bd6368 &lt;col:16&gt; &#x27;int&#x27; 0</span><br></pre></td></tr></table></div></figure>\n\n<p>è¯­æ³•åˆ†æé˜¶æ®µä¼šè¾“å‡º <strong>AST</strong>ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œå®ƒæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚é€šè¿‡å®ƒï¼Œå¯ä»¥è¿›è¡Œè¯­æ³•é”™è¯¯åˆ†æï¼Œä»¥åŠé™æ€åˆ†ææ“ä½œï¼Œæ¶µç›–å†…å­˜æ“ä½œå’Œå®‰å…¨ç­‰æ–¹é¢ã€‚</p>\n\n        <h4 id=\"CodeGené˜¶æ®µ\"   >\n          <a href=\"#CodeGené˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#CodeGené˜¶æ®µ\" class=\"headerlink\" title=\"CodeGené˜¶æ®µ\"></a>CodeGené˜¶æ®µ</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; ModuleID = &#x27;nihao.m&#x27;</span><br><span class=\"line\">source_filename = &quot;nihao.m&quot;</span><br><span class=\"line\">target datalayout = &quot;e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><br><span class=\"line\">target triple = &quot;x86_64-apple-macosx11.0.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">%struct.__NSConstantString_tag = type &#123; i32*, i32, i8*, i64 &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@__CFConstantStringClassReference = external global [0 x i32]</span><br><span class=\"line\">@.str = private unnamed_addr constant [9 x i8] c&quot;nihao!!!\\00&quot;, section &quot;__TEXT,__cstring,cstring_literals&quot;, align 1</span><br><span class=\"line\">@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag &#123; i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 &#125;, section &quot;__DATA,__cfstring&quot;, align 8 #0</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: noinline optnone ssp uwtable</span><br><span class=\"line\">define i32 @main(i32 %0, i8** %1) #1 &#123;</span><br><span class=\"line\">  %3 = alloca i32, align 4</span><br><span class=\"line\">  %4 = alloca i32, align 4</span><br><span class=\"line\">  %5 = alloca i8**, align 8</span><br><span class=\"line\">  store i32 0, i32* %3, align 4</span><br><span class=\"line\">  store i32 %0, i32* %4, align 4</span><br><span class=\"line\">  store i8** %1, i8*** %5, align 8</span><br><span class=\"line\">  %6 = call i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\">  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*))</span><br><span class=\"line\">  store i32 0, i32* %3, align 4</span><br><span class=\"line\">  call void @llvm.objc.autoreleasePoolPop(i8* %6)</span><br><span class=\"line\">  %7 = load i32, i32* %3, align 4</span><br><span class=\"line\">  ret i32 %7</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\"></span><br><span class=\"line\">declare void @NSLog(i8*, ...) #3</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare void @llvm.objc.autoreleasePoolPop(i8*) #2</span><br><span class=\"line\"></span><br><span class=\"line\">attributes #0 = &#123; &quot;objc_arc_inert&quot; &#125;</span><br><span class=\"line\">attributes #1 = &#123; noinline optnone ssp uwtable &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-jump-tables&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\">attributes #2 = &#123; nounwind &#125;</span><br><span class=\"line\">attributes #3 = &#123; &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!llvm.module.flags = !&#123;!0, !1, !2, !3, !4, !5, !6, !7&#125;</span><br><span class=\"line\">!llvm.ident = !&#123;!8&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!0 = !&#123;i32 2, !&quot;SDK Version&quot;, [2 x i32] [i32 12, i32 0]&#125;</span><br><span class=\"line\">!1 = !&#123;i32 1, !&quot;Objective-C Version&quot;, i32 2&#125;</span><br><span class=\"line\">!2 = !&#123;i32 1, !&quot;Objective-C Image Info Version&quot;, i32 0&#125;</span><br><span class=\"line\">!3 = !&#123;i32 1, !&quot;Objective-C Image Info Section&quot;, !&quot;__DATA,__objc_imageinfo,regular,no_dead_strip&quot;&#125;</span><br><span class=\"line\">!4 = !&#123;i32 1, !&quot;Objective-C Garbage Collection&quot;, i8 0&#125;</span><br><span class=\"line\">!5 = !&#123;i32 1, !&quot;Objective-C Class Properties&quot;, i32 64&#125;</span><br><span class=\"line\">!6 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class=\"line\">!7 = !&#123;i32 7, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class=\"line\">!8 = !&#123;!&quot;Apple clang version 13.0.0 (clang-1300.0.29.3)&quot;&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>CodeGen</strong> é˜¶æ®µè´Ÿè´£å°† <strong>AST</strong> è‡ªé¡¶å‘ä¸‹éå†é€æ­¥ç¿»è¯‘æˆ <strong>LLVM IR</strong>ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨åç«¯æ‰€éœ€è¦çš„ä¸­é—´ä»£ç ï¼ŒåŒæ—¶ <strong>Objective-C</strong> ä»£ç ä¹Ÿä¼šåœ¨è¿™ä¸€æ­¥è¿›è¡Œ <strong>Runtime</strong> æ¡¥æ¥ï¼š <strong>property</strong> åˆæˆï¼Œ<strong>ARC</strong> å¤„ç†ç­‰ï¼Œå¦‚ä¸Šæ–¹å¯ä»¥çœ‹è§ <strong>autoreleasePoolPush</strong> ã€ <strong>autoreleasePoolPop</strong> æ“ä½œã€‚</p>\n<p>è‡³æ­¤ <strong>Clang</strong> å‰ç«¯å·¥ä½œç®—æ˜¯å®Œæˆï¼Œæ¥ä¸‹æ¥å°±äº¤ç»™åç«¯è¿›è¡Œå¤„ç†ã€‚</p>\n\n        <h3 id=\"3-3-LLVM-Optimizer-é˜¶æ®µ\"   >\n          <a href=\"#3-3-LLVM-Optimizer-é˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-3-LLVM-Optimizer-é˜¶æ®µ\" class=\"headerlink\" title=\"3.3 LLVM Optimizer é˜¶æ®µ\"></a>3.3 LLVM Optimizer é˜¶æ®µ</h3>\n      \n        <h4 id=\"IRä»£ç ä¼˜åŒ–\"   >\n          <a href=\"#IRä»£ç ä¼˜åŒ–\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#IRä»£ç ä¼˜åŒ–\" class=\"headerlink\" title=\"IRä»£ç ä¼˜åŒ–\"></a>IRä»£ç ä¼˜åŒ–</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -Os -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; ModuleID = &#x27;nihao.m&#x27;</span><br><span class=\"line\">source_filename = &quot;nihao.m&quot;</span><br><span class=\"line\">target datalayout = &quot;e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><br><span class=\"line\">target triple = &quot;x86_64-apple-macosx11.0.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">%struct.__NSConstantString_tag = type &#123; i32*, i32, i8*, i64 &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@__CFConstantStringClassReference = external global [0 x i32]</span><br><span class=\"line\">@.str = private unnamed_addr constant [9 x i8] c&quot;nihao!!!\\00&quot;, section &quot;__TEXT,__cstring,cstring_literals&quot;, align 1</span><br><span class=\"line\">@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag &#123; i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 &#125;, section &quot;__DATA,__cfstring&quot;, align 8 #0</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: optsize ssp uwtable</span><br><span class=\"line\">define i32 @main(i32 %0, i8** nocapture readnone %1) local_unnamed_addr #1 &#123;</span><br><span class=\"line\">  %3 = tail call i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\">  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*)) #4, !clang.arc.no_objc_arc_exceptions !9</span><br><span class=\"line\">  tail call void @llvm.objc.autoreleasePoolPop(i8* %3) #2</span><br><span class=\"line\">  ret i32 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: optsize</span><br><span class=\"line\">declare void @NSLog(i8*, ...) local_unnamed_addr #3</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare void @llvm.objc.autoreleasePoolPop(i8*) #2</span><br><span class=\"line\"></span><br><span class=\"line\">attributes #0 = &#123; &quot;objc_arc_inert&quot; &#125;</span><br><span class=\"line\">attributes #1 = &#123; optsize ssp uwtable &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-jump-tables&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\">attributes #2 = &#123; nounwind &#125;</span><br><span class=\"line\">attributes #3 = &#123; optsize &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\">attributes #4 = &#123; optsize &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!llvm.module.flags = !&#123;!0, !1, !2, !3, !4, !5, !6, !7&#125;</span><br><span class=\"line\">!llvm.ident = !&#123;!8&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!0 = !&#123;i32 2, !&quot;SDK Version&quot;, [2 x i32] [i32 12, i32 0]&#125;</span><br><span class=\"line\">!1 = !&#123;i32 1, !&quot;Objective-C Version&quot;, i32 2&#125;</span><br><span class=\"line\">!2 = !&#123;i32 1, !&quot;Objective-C Image Info Version&quot;, i32 0&#125;</span><br><span class=\"line\">!3 = !&#123;i32 1, !&quot;Objective-C Image Info Section&quot;, !&quot;__DATA,__objc_imageinfo,regular,no_dead_strip&quot;&#125;</span><br><span class=\"line\">!4 = !&#123;i32 1, !&quot;Objective-C Garbage Collection&quot;, i8 0&#125;</span><br><span class=\"line\">!5 = !&#123;i32 1, !&quot;Objective-C Class Properties&quot;, i32 64&#125;</span><br><span class=\"line\">!6 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class=\"line\">!7 = !&#123;i32 7, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class=\"line\">!8 = !&#123;!&quot;Apple clang version 13.0.0 (clang-1300.0.29.3)&quot;&#125;</span><br><span class=\"line\">!9 = !&#123;&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>IR</strong> ä»£ç ä¼˜åŒ–ä¼šè°ƒç”¨ç›¸åº” <strong>Pass</strong> è¿›è¡Œå¤„ç†ï¼Œ<strong>Pass</strong> ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œéƒ½æ˜¯ <strong>Pass</strong> ç±»çš„å­ç±»ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„ä¼˜åŒ–ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè‡ªä¸»çš„æ§åˆ¶ä¼˜åŒ–çš„å¼ºåº¦ï¼Œåœ¨<strong>Build Strrings -&gt; Optimization Level</strong> ä¸­å¯æŒ‡å®šä¼˜åŒ–ç¨‹åº¦ï¼Œä¸€äº›å¸¸è§çš„ä»£ç ä¼˜åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>åˆ é™¤å…¬å…±å­è¡¨è¾¾å¼</li>\n<li>åˆ é™¤æ— ç”¨ä»£ç </li>\n<li>å¸¸é‡åˆå¹¶</li>\n<li>ä»£ç ç§»åŠ¨</li>\n<li>åˆ é™¤å½’çº³å˜é‡</li>\n</ul>\n\n        <h4 id=\"ç”Ÿæˆ-BitCodeï¼ˆArchiveæ—¶ï¼‰\"   >\n          <a href=\"#ç”Ÿæˆ-BitCodeï¼ˆArchiveæ—¶ï¼‰\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ç”Ÿæˆ-BitCodeï¼ˆArchiveæ—¶ï¼‰\" class=\"headerlink\" title=\"ç”Ÿæˆ BitCodeï¼ˆArchiveæ—¶ï¼‰\"></a>ç”Ÿæˆ BitCodeï¼ˆArchiveæ—¶ï¼‰</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xrun clang -emit-llvm -c nihao.m -o nihao.bc</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dec0 170b 0000 0000 1400 0000 0010 0000</span><br><span class=\"line\">0700 0001 4243 c0de 3514 0000 0700 0000</span><br><span class=\"line\">620c 3024 9596 a6a5 f7d7 7f7d d3b4 4ffb</span><br><span class=\"line\">76ef df3f 2d44 0132 0500 0000 210c 0000</span><br><span class=\"line\">4903 0000 0b02 2100 0200 0000 1600 0000</span><br><span class=\"line\">0781 2391 41c8 0449 0610 3239 9201 840c</span><br><span class=\"line\">2505 0819 1e04 8b62 8014 4502 4292 0b42</span><br><span class=\"line\">a410 3214 3808 184b 0a32 5288 4870 c421</span><br><span class=\"line\">...</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>BitCode</strong> æ˜¯ <strong>LLVM</strong> å¼•å…¥çš„å¦ä¸€ç§ä¸­é—´ä»£ç ï¼Œè™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒæ¥è¿‘æœºå™¨ç ï¼Œä½†æ˜¯åœ¨å‡½æ•°å’ŒæŒ‡ä»¤å±‚é¢ä½¿ç”¨äº†å¾ˆå¤šé«˜çº§è¯­è¨€çš„ç‰¹æ€§ã€‚</p>\n<p>ä½†åªä¼šåœ¨ <strong>Archive</strong> æ—¶ï¼Œ<strong>BitCode</strong> æ‰ä¼šè¢«åµŒå…¥åˆ°é“¾æ¥åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºæäº¤ç»™ <strong>App Store</strong>ï¼ŒåŒ…å« <strong>Bitcode</strong> é…ç½®çš„ç¨‹åºå°†ä¼šåœ¨ <strong>App Store</strong> ä¸Šè¢«é‡æ–°ç¼–è¯‘å’Œé“¾æ¥ï¼Œè¿›è€Œå¯¹å¯æ‰§è¡Œæ–‡ä»¶åšä¼˜åŒ–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¼˜åŒ–è¿™ä¸€æ­¥æ˜¯åœ¨ <strong>App Store</strong> ä¸­åšçš„å¤„ç†ï¼Œæœ¬åœ°æ²¡æœ‰åšå¤„ç†ã€‚è¿›è¡Œå…¶ä»–ç±»å‹çš„ <strong>Build</strong> (é <strong>Archive</strong> )æ—¶ï¼Œç¼–è¯‘å™¨åªä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³å¼€å¯ <strong>BitCode</strong> çš„æ¡ä»¶ï¼Œä½†å¹¶ä¸ä¼šçœŸæ­£ç”Ÿæˆ <strong>BitCode</strong> ã€‚</p>\n\n        <h3 id=\"3-4-LLVM-Code-Generatoré˜¶æ®µ\"   >\n          <a href=\"#3-4-LLVM-Code-Generatoré˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-4-LLVM-Code-Generatoré˜¶æ®µ\" class=\"headerlink\" title=\"3.4 LLVM Code Generatoré˜¶æ®µ\"></a>3.4 LLVM Code Generatoré˜¶æ®µ</h3>\n      \n        <h4 id=\"ç”Ÿæˆæ±‡ç¼–ä»£ç \"   >\n          <a href=\"#ç”Ÿæˆæ±‡ç¼–ä»£ç \" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ç”Ÿæˆæ±‡ç¼–ä»£ç \" class=\"headerlink\" title=\"ç”Ÿæˆæ±‡ç¼–ä»£ç \"></a>ç”Ÿæˆæ±‡ç¼–ä»£ç </h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -S -fobjc-arc nihao.m -o nihao.s</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t.section\t__TEXT,__text,regular,pure_instructions</span><br><span class=\"line\">\t.build_version macos, 11, 0\tsdk_version 12, 0</span><br><span class=\"line\">\t.globl\t_main                           ## -- Begin function main</span><br><span class=\"line\">\t.p2align\t4, 0x90</span><br><span class=\"line\">_main:                                  ## @main</span><br><span class=\"line\">\t.cfi_startproc</span><br><span class=\"line\">## %bb.0:</span><br><span class=\"line\">\tpushq\t%rbp</span><br><span class=\"line\">\t.cfi_def_cfa_offset 16</span><br><span class=\"line\">\t.cfi_offset %rbp, -16</span><br><span class=\"line\">\tmovq\t%rsp, %rbp</span><br><span class=\"line\">\t.cfi_def_cfa_register %rbp</span><br><span class=\"line\">\tsubq\t$32, %rsp</span><br><span class=\"line\">\tmovl\t$0, -4(%rbp)</span><br><span class=\"line\">\tmovl\t%edi, -8(%rbp)</span><br><span class=\"line\">\tmovq\t%rsi, -16(%rbp)</span><br><span class=\"line\">\tcallq\t_objc_autoreleasePoolPush</span><br><span class=\"line\">\tmovq\t%rax, -24(%rbp)                 ## 8-byte Spill</span><br><span class=\"line\">\tleaq\tL__unnamed_cfstring_(%rip), %rdi</span><br><span class=\"line\">\tmovb\t$0, %al</span><br><span class=\"line\">\tcallq\t_NSLog</span><br><span class=\"line\">\tmovq\t-24(%rbp), %rdi                 ## 8-byte Reload</span><br><span class=\"line\">\tmovl\t$0, -4(%rbp)</span><br><span class=\"line\">\tcallq\t_objc_autoreleasePoolPop</span><br><span class=\"line\">\tmovl\t-4(%rbp), %eax</span><br><span class=\"line\">\taddq\t$32, %rsp</span><br><span class=\"line\">\tpopq\t%rbp</span><br><span class=\"line\">\tretq</span><br><span class=\"line\">\t.cfi_endproc</span><br><span class=\"line\">                                        ## -- End function</span><br><span class=\"line\">\t.section\t__TEXT,__cstring,cstring_literals</span><br><span class=\"line\">L_.str:                                 ## @.str</span><br><span class=\"line\">\t.asciz\t&quot;nihao!!!&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\t.section\t__DATA,__cfstring</span><br><span class=\"line\">\t.p2align\t3                               ## @_unnamed_cfstring_</span><br><span class=\"line\">L__unnamed_cfstring_:</span><br><span class=\"line\">\t.quad\t___CFConstantStringClassReference</span><br><span class=\"line\">\t.long\t1992                            ## 0x7c8</span><br><span class=\"line\">\t.space\t4</span><br><span class=\"line\">\t.quad\tL_.str</span><br><span class=\"line\">\t.quad\t8                               ## 0x8</span><br><span class=\"line\"></span><br><span class=\"line\">\t.section\t__DATA,__objc_imageinfo,regular,no_dead_strip</span><br><span class=\"line\">L_OBJC_IMAGE_INFO:</span><br><span class=\"line\">\t.long\t0</span><br><span class=\"line\">\t.long\t64</span><br><span class=\"line\"></span><br><span class=\"line\">.subsections_via_symbols</span><br></pre></td></tr></table></div></figure>\n\n<p>æ±‡ç¼–è¯­è¨€æ›´åŠ æ¥è¿‘æœºå™¨è¯­è¨€ï¼Œèƒ½å¤Ÿç›´æ¥å¯¹ç¡¬ä»¶è¿›è¡Œæ“ä½œï¼Œç”Ÿæˆçš„ç¨‹åºä¸å…¶ä»–çš„è¯­è¨€ç›¸æ¯”å…·æœ‰æ›´é«˜çš„è¿è¡Œé€Ÿåº¦ï¼Œå ç”¨æ›´å°çš„å†…å­˜ã€‚</p>\n<p>ç›®å‰æ‰€æœ‰ <strong>iOS</strong> è®¾å¤‡éƒ½é‡‡ç”¨ <strong>ARM</strong> å¤„ç†å™¨ï¼Œè¿™æ„å‘³ç€éƒ½æ˜¯é‡‡ç”¨ <strong>ARM</strong> æŒ‡ä»¤é›†ï¼Œå¦‚ <strong>armv6 / armv7 / armv7s / arm64</strong>ï¼Œè¿™äº›æŒ‡ä»¤é›†éƒ½æ˜¯å‘ä¸‹å…¼å®¹çš„ã€‚</p>\n<p>æ¯ç§ <strong>CPU</strong> æ¶æ„éƒ½æœ‰ç€ç›¸åº”çš„æŒ‡ä»¤é›†ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ¶æ„äº§ç”Ÿä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤ï¼ŒåŠ ä¸Šä¸Šé¢ <strong>- arch arch_type</strong> é€‰é¡¹å³å¯ï¼Œæ›´å¤šè¯·å‚è§<span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://developer.apple.com/library/archive/documentation/DeveloperTools/Reference/Assembler/000-Introduction/introduction.html\" >å®˜ç½‘</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span>ã€‚åœ¨ <strong>Xcode</strong> ä¸­å¯åœ¨ <strong>Build Settings -&gt; Architectrues</strong> æŒ‡å®šäº§ç”Ÿçš„ <strong>CPU</strong> æŒ‡ä»¤é›†ã€‚</p>\n\n        <h4 id=\"ç”Ÿæˆæœºå™¨ä»£ç \"   >\n          <a href=\"#ç”Ÿæˆæœºå™¨ä»£ç \" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ç”Ÿæˆæœºå™¨ä»£ç \" class=\"headerlink\" title=\"ç”Ÿæˆæœºå™¨ä»£ç \"></a>ç”Ÿæˆæœºå™¨ä»£ç </h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -fmodules -c nihao.s -o nihao.o</span><br></pre></td></tr></table></div></figure>\n\n<p>å¯ä»¥å‘ç°æœºå™¨ç äºŒè¿›åˆ¶æ–‡ä»¶æ— æ³•é˜…è¯»ï¼Œå¯å€ŸåŠ© <strong>otool</strong> æˆ–è€… <strong>MachOView</strong> ç­‰å·¥å…·æŸ¥çœ‹æ–‡ä»¶ä¸­çš„ç›¸å…³å†…å®¹ï¼š</p>\n<figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">otool -v -h nihao.o</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nihao.o:</span><br><span class=\"line\">Mach header</span><br><span class=\"line\">      magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags</span><br><span class=\"line\">MH_MAGIC_64   X86_64        ALL  0x00      OBJECT     4        680 SUBSECTIONS_VIA_SYMBOLS</span><br></pre></td></tr></table></div></figure>\n\n<p>å¯ä»¥çœ‹è§ <strong>.o</strong> æ–‡ä»¶å®é™…ä¸Šæ˜¯ <strong>mach-o</strong> æ ¼å¼ï¼Œè¿™é‡Œæˆ‘ä»¬è¾“å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„å¤´éƒ¨ï¼Œè§„å®šäº†è¿™ä¸ªæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œé€‚åº”æ¶æ„çš„ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠæ–‡ä»¶æ˜¯å¦‚ä½•è¢«åŠ è½½çš„ã€‚æ›´å¤šå…³äº <strong>mach-o</strong> çš„çŸ¥è¯†<span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://www.jianshu.com/p/54d842db3f69\" >å‚è§</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span>ã€‚</p>\n\n        <h4 id=\"é“¾æ¥\"   >\n          <a href=\"#é“¾æ¥\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é“¾æ¥\" class=\"headerlink\" title=\"é“¾æ¥\"></a>é“¾æ¥</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang nihao.o -Wl,`xcrun --show-sdk-path`/System/Library/Frameworks/Foundation.framework/Foundation</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./a.out</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2021-11-03 16:06:41.734 a.out[6394:220026] nihao!!!</span><br></pre></td></tr></table></div></figure>\n\n<p>ç”±äºæˆ‘ä»¬å¼•å…¥äº† <strong>Foundation</strong> é‡Œé¢çš„æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°†ç›®æ ‡æ–‡ä»¶å’Œ <strong>Foundation framework</strong>è¿›è¡Œé“¾æ¥ï¼Œæ¥ç€å°±å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºäº†ã€‚</p>\n<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šç¬¦å·è¡¨ï¼Œé‡Œé¢å­˜å‚¨çš„å…ƒç´ å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight xml\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;èµ·å§‹åœ°å€&gt; &lt;ç»“æŸåœ°å€&gt; &lt;å‡½æ•°&gt; [&lt;æ–‡ä»¶å:è¡Œå·&gt;]</span><br></pre></td></tr></table></div></figure>\n\n<p>è¿™é‡Œæˆ‘ä»¬è¾“å…¥a.outçš„ç¬¦å·ä¿¡æ¯</p>\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nm -nm a.out</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                 (undefined) external _NSLog (from Foundation)</span><br><span class=\"line\">                 (undefined) external ___CFConstantStringClassReference (from CoreFoundation)</span><br><span class=\"line\">                 (undefined) external _objc_autoreleasePoolPop (from libobjc)</span><br><span class=\"line\">                 (undefined) external _objc_autoreleasePoolPush (from libobjc)</span><br><span class=\"line\">                 (undefined) external dyld_stub_binder (from libSystem)</span><br><span class=\"line\">0000000100000000 (__TEXT,__text) [referenced dynamically] external __mh_execute_header</span><br><span class=\"line\">0000000100003f20 (__TEXT,__text) external _main</span><br><span class=\"line\">0000000100008018 (__DATA,__data) non-external __dyld_private</span><br></pre></td></tr></table></div></figure>\n\n<p>å¯¹äºåŠ¨æ€é“¾æ¥åº“çš„ç¬¦å·ï¼ˆå¦‚ <strong>Foundation</strong>ï¼‰ï¼Œæœ€ç»ˆä¼šè®°å½•ä¸‹è¿™ä¸ªç¬¦å·æ˜¯é€šè¿‡è¿›è¡Œé“¾æ¥çš„ï¼Œå¹¶è®°å½•ä¸‹ä¾èµ–äºå“ªä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨ï¼ˆ<strong>dyld</strong>ï¼‰ä¼šå»è§£æè¿™äº› <strong>undefined</strong> ç¬¦å·ã€‚å¯¹äºå…¶ä»–ä½ç½®çš„ç¬¦å·ï¼Œä¼šç›´æ¥ä¿®æ­£è¿™äº›ç¬¦å·çš„å…·ä½“ä½ç½®ä¿¡æ¯ã€‚</p>\n\n        <h2 id=\"4-æ€»ç»“\"   >\n          <a href=\"#4-æ€»ç»“\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#4-æ€»ç»“\" class=\"headerlink\" title=\"4. æ€»ç»“\"></a>4. æ€»ç»“</h2>\n      <p>æœ¬æ–‡ä»‹ç»äº†å…³äº iOS ç¼–è¯‘å™¨ã€iOS ç¼–è¯‘è¿‡ç¨‹çš„åŸºç¡€çŸ¥è¯†ã€‚å­¦ä¹ äº†è¿™äº›ï¼Œå¯¹ iOS ç¼–è¯‘æœ‰ä¸ªæ•´ä½“è®¤è¯†ã€‚å°±æœ¬äººè€Œè¨€ï¼Œåœ¨ä¸€è·¯æœå¯»èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹ä¹‹å‰ä¸€äº›é›¶æ•£çš„çŸ¥è¯†ç‚¹æœ‰äº†ä¸€äº›æ›´åŠ æ·±å…¥çš„è®¤è¯†ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œå…³äº SwiftC çš„ç¼–è¯‘è¿‡ç¨‹æ²¡æœ‰å¤šåšä»‹ç»ï¼Œåé¢ä¼šå†å‡ºä¸€ç¯‡è¿›è¡Œä»‹ç»ã€‚</p>\n<p>ğŸ”—ï¼š</p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://objccn.io/issue-6-3/\" >ObjC ä¸­å›½ - Mach-O å¯æ‰§è¡Œæ–‡ä»¶</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://kiprey.github.io/2020/06/LLVM-IR-pass/\" >ä»£ç ä¼˜åŒ–ä¸LLVM IR pass</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"http://xelz.info/blog/2018/11/24/all-you-need-to-know-about-bitcode/\" >å…³äºbitcode, çŸ¥é“è¿™äº›å°±å¤Ÿäº†</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://zhuanlan.zhihu.com/p/340782811\" >iOS ç¼–è¯‘é“¾æ¥ï¼šObjective-C ç¼–è¯‘é“¾æ¥</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://www.jianshu.com/p/54d842db3f69\" >è¶£æ¢ Mach-Oï¼šæ–‡ä»¶æ ¼å¼åˆ†æ</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n","site":{"data":{}},"excerpt":"","more":"\n        <h1 id=\"iOS-ç¼–è¯‘è¿‡ç¨‹\"   >\n          <a href=\"#iOS-ç¼–è¯‘è¿‡ç¨‹\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#iOS-ç¼–è¯‘è¿‡ç¨‹\" class=\"headerlink\" title=\"iOS ç¼–è¯‘è¿‡ç¨‹\"></a>iOS ç¼–è¯‘è¿‡ç¨‹</h1>\n      \n        <h2 id=\"1-å‰è¨€\"   >\n          <a href=\"#1-å‰è¨€\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#1-å‰è¨€\" class=\"headerlink\" title=\"1. å‰è¨€\"></a>1. å‰è¨€</h2>\n      <p>å­¦ä¹  <strong>iOS</strong> ç¼–è¯‘è¿‡ç¨‹ï¼ˆ<strong>Compile</strong>ï¼‰æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½ç†è§£ä»£ç æ˜¯å¦‚ä½•è¢«è®¡ç®—æœºè¿ä½œèµ·æ¥ï¼Œç¼–è¯‘å™¨ä¸ºä»£ç åšäº†å“ªäº›ä¼˜åŒ–ï¼Œè®©æˆ‘ä»¬å­¦ä¼šä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹å¾…é—®é¢˜ã€‚</p>\n\n        <h2 id=\"2-ç¼–è¯‘å™¨ç»“æ„\"   >\n          <a href=\"#2-ç¼–è¯‘å™¨ç»“æ„\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#2-ç¼–è¯‘å™¨ç»“æ„\" class=\"headerlink\" title=\"2. ç¼–è¯‘å™¨ç»“æ„\"></a>2. ç¼–è¯‘å™¨ç»“æ„</h2>\n      <p>ç°ä»£ç¼–è¯‘å™¨æ˜¯å°†æºä»£ç è½¬æ¢æˆå¯æ‰§è¡Œæ–‡ä»¶çš„ç¨‹åºï¼Œå·¥ä½œæµç¨‹ä¸»è¦åˆ†ä¸º <strong>å‰ç«¯</strong> å’Œ <strong>åç«¯</strong> ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>\n<ol>\n<li>å‰ç«¯ï¼šå¯¹æºä»£ç è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆä¸­é—´ä»£ç ã€‚</li>\n<li>åç«¯ï¼šé’ˆå¯¹ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬æ¢æˆç›®æ ‡æœºå™¨çš„ä»£ç æŒ‡ä»¤ã€‚</li>\n</ol>\n<pre class=\"mermaid\">graph LR\n    A(SourceCode) --> B(Frontend)\n    B(Frontend) --> C(Backend)\n    C(Backend) --> D(Machine Code)</pre>\n\n<p>é’ˆå¯¹iOSå¹³å°ï¼Œä¸åŒè¯­è¨€é‡‡ç”¨äº†ä¸åŒçš„ç¼–è¯‘å™¨å‰ç«¯ï¼š</p>\n<ol>\n<li><p><strong>Frontendï¼šClang / SwiftC</strong></p>\n<p>å¯¹äº <strong>Objective-C / C / C++ / Objective-C++</strong>  æ¥è¯´é‡‡ç”¨ <strong>Clang</strong> ç¼–è¯‘å™¨å‰ç«¯ï¼›</p>\n<p>å¯¹äº <strong>Swift</strong> æ¥è¯´åˆ™é‡‡ç”¨ <strong>SwiftC</strong>ï¼›</p>\n</li>\n<li><p><strong>Backendï¼šLLVM</strong></p>\n<p>æ— è®ºæ˜¯ <strong>C</strong> ç³»è¯­è¨€è¿˜æ˜¯ <strong>Swift</strong> éƒ½é‡‡ç”¨ <strong>LLVM</strong> ä½œä¸ºç¼–è¯‘å™¨åç«¯ï¼›</p>\n</li>\n</ol>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯åœ¨ <strong>Xcode3</strong> ä»¥å‰ï¼Œéƒ½é‡‡ç”¨ <strong>GCC</strong> ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ï¼Œä½†ä¸º <strong>Apple</strong> å¿«é€Ÿå‘å±•éœ€è¦åŠŸèƒ½æ›´å¼ºå¤§å’Œæ€§èƒ½æ›´å¥½çš„ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥ <strong>Apple</strong> è‡ªå·±å¼€å‘äº† <strong>Clang</strong> ä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ã€‚ä¸‹é¢å¯¹ç¼–è¯‘å™¨åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼š</p>\n<ul>\n<li><strong>GCC</strong></li>\n</ul>\n<p><strong>GCC</strong>ï¼ˆ<strong>GNU Compile Collection</strong>ï¼Œ**GNU **ç¼–è¯‘å™¨å¥—è£…ï¼‰ï¼Œæ˜¯ä¸€å¥—ç”± <strong>GNU</strong> å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ç¼–è¯‘å™¨ã€‚æ¥æœ¬åªèƒ½å¤„ç† <em>C</em> è¯­è¨€ï¼Œåæ¥å¿«é€Ÿæ¼”è¿›ï¼Œå˜å¾—å¯å¤„ç† <strong>C++ã€Objective-Cã€Javaã€Fortran</strong> ç­‰å…¶ä»–è¯­è¨€ã€‚ä½†ç”±äºä¸€äº›ç¼ºé™·ï¼Œå¯¼è‡´äº† <strong>Apple</strong> æŠ›å¼ƒäº† <strong>GCC</strong> ï¼Œå¼€å‘å‡ºäº† <strong>Clang</strong> ä½œä¸ºå…¶å‰ç«¯ç¼–è¯‘å™¨ã€‚</p>\n<ol>\n<li><strong>GCC</strong> çš„ <strong>Objective-C Frontend</strong> ä¸æ˜¯ <strong>Apple</strong> ç»´æŠ¤ï¼Œå¯¼è‡´æƒ³è¦æ·»åŠ ä¸€äº›è¯­æ³•æç¤ºç­‰åŠŸèƒ½å¾—å»è¦æ±‚ <strong>GCC</strong> å›¢é˜Ÿåšã€‚</li>\n<li><strong>GCC</strong> çš„æ’ä»¶ã€å·¥å…·ã€<strong>IDE</strong> çš„æ”¯æŒè–„å¼±ã€‚</li>\n<li><strong>GCC</strong> çš„ç¼–è¯‘æ•ˆç‡å’Œæ€§èƒ½ä¸è¶³ã€‚</li>\n</ol>\n<ul>\n<li><strong>Clang</strong></li>\n</ul>\n<p><strong>Clang1.0</strong> äº <strong>2009</strong> å¹´æ­£å¼ä¸ <strong>LLVM2.6</strong> æ­£å¼å‘å¸ƒï¼Œæ—¨åœ¨æä¾› <strong>GCC</strong> çš„æ›¿ä»£å“ï¼Œæ”¯æŒäº† <strong>GUN</strong> ç¼–è¯‘å™¨å¤§å¤šæ•°çš„ç¼–è¯‘å™¨è®¾ç½®ä»¥åŠéå®˜æ–¹è¯­è¨€çš„æ‹“å±•ï¼Œç›¸è¾ƒäº <strong>GCC</strong> ï¼Œ<strong>Clang</strong> å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ol>\n<li>ç¼–è¯‘é€Ÿåº¦æ›´å¿«ã€‚</li>\n<li>å ç”¨å†…å­˜æ›´å°ã€‚</li>\n<li>æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‹“å±•ä¸é‡ç”¨ã€‚</li>\n<li>è¯Šæ–­ä¿¡æ¯å¯è¯»æ€§å¼ºã€‚</li>\n</ol>\n<ul>\n<li><strong>SwiftC</strong></li>\n</ul>\n<p><strong>SwiftC</strong> åœ¨å‰ç«¯é‡‡ç”¨äº† <strong>SIL</strong> ä¸­é—´è¯­è¨€ï¼Œè¿™æ˜¯å› ä¸º <strong>Swift</strong> ä½œä¸ºä¸€ç§é«˜çº§è¯­è¨€ï¼Œæœ‰è®¸å¤šç‰¹æ€§ï¼Œå¦‚ <strong>protocol</strong> çš„æ³›å‹ï¼Œä¹Ÿæ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œç¡®ä¿å˜é‡åœ¨ä½¿ç”¨ä¹‹å‰è¢«åˆå§‹åŒ–ã€æ£€æµ‹ä¸å¯æ‰§è¡Œçš„ä»£ç ï¼Œäºæ˜¯å¢åŠ äº†ä¸€å±‚ <strong>SIL</strong> æ¥åšè¿™äº›äº‹æƒ…ã€‚</p>\n<ul>\n<li><strong>LLVM</strong></li>\n</ul>\n<p><strong>LLVM</strong> æ˜¯ä¸€å¥—ç¼–è¯‘å™¨åŸºç¡€è®¾å¤‡é¡¹ç›®ï¼Œç”± <strong>C++</strong> å†™æˆï¼ŒåŒ…å«ä¸€ç³»åˆ—æ¨¡å—åŒ–çš„ç¼–è¯‘å™¨ç»„ä»¶å’Œå·¥å…·é“¾ï¼Œç”¨æ¥å¼€å‘ç¼–è¯‘å™¨çš„å‰ç«¯å’Œåç«¯ã€‚åœ¨ <strong>iOS</strong> ä¸­ï¼Œ<strong>LLVM</strong> ä½œä¸ºç¼–è¯‘å™¨åç«¯ä¸»è¦æä¾› <strong>Optimizer</strong> å’Œ <strong>Code Generator</strong> ï¼Œå°†æ¥æ”¶åˆ°çš„ <strong>IR</strong> ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»¥åŠæœºå™¨ä»£ç ç”Ÿæˆã€‚</p>\n\n        <h2 id=\"3-ç¼–è¯‘è¿‡ç¨‹\"   >\n          <a href=\"#3-ç¼–è¯‘è¿‡ç¨‹\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-ç¼–è¯‘è¿‡ç¨‹\" class=\"headerlink\" title=\"3. ç¼–è¯‘è¿‡ç¨‹\"></a>3. ç¼–è¯‘è¿‡ç¨‹</h2>\n      \n        <h3 id=\"3-1-æµç¨‹æ¢³ç†\"   >\n          <a href=\"#3-1-æµç¨‹æ¢³ç†\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-1-æµç¨‹æ¢³ç†\" class=\"headerlink\" title=\"3.1 æµç¨‹æ¢³ç†\"></a>3.1 æµç¨‹æ¢³ç†</h3>\n      <pre class=\"mermaid\">graph TD\n    subgraph Clang\n    id1(æºä»£ç ) --> id2(é¢„å¤„ç†) \n    id2(é¢„å¤„ç†) --> id3(è¯­æ³•åˆ†æ)   \n    id3(è¯­æ³•åˆ†æ) --  token  --> id4(è¯­æ³•åˆ†æ)\n    id4(è¯­æ³•åˆ†æ) --  AST  --> id5(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    subgraph Optimizer, Backend\n    id6(ä¸­é—´ä»£ç ä¼˜åŒ–) --> id7(BitCodeç”Ÿæˆ)\n    id7(BitCodeç”Ÿæˆ) --> id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ)\n    id8(æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ) --> id9(æœºå™¨ç ç”Ÿæˆ)\n    id9(æœºå™¨ç ç”Ÿæˆ) --> id11(é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶)\n    end\n    \n    subgraph SwiftC\n    id12(æºä»£ç ) --> id13(è§£æ)\n    id13(è§£æ) --> id14(è¯­ä¹‰åˆ†æ)\n    id14(è¯­ä¹‰åˆ†æ) --> id15(Clangå¯¼å…¥å™¨)\n    id15(Clangå¯¼å…¥å™¨) --> id16(SILç”Ÿæˆ)\n    id16(SILç”Ÿæˆ) --> id17(SILä¿è¯è½¬æ¢)\n    id17 --> id18(SILä¼˜åŒ–)\n    id18(SILä¼˜åŒ–) --> id19(ä¸­é—´ä»£ç ç”Ÿæˆ)\n    end\n    \n    id5 --  IR  --> id6\n    id19 --  IR  --> id6</pre>\n\n<p>åœ¨å‰ç«¯ <strong>Objective-C</strong> å’Œ <strong>Swift</strong> åˆ†åˆ«ç”±è‡ªå·±çš„å¤„ç†é˜¶æ®µï¼Œä½†æœ€åéƒ½ä¼šç”Ÿæˆ <strong>IR</strong> ä¸­é—´ä»£ç ï¼Œäº¤ç”±åç«¯è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„.mæ–‡ä»¶è¿›è¡Œç¼–è¯‘è¿‡ç¨‹æ¢³ç†ï¼Œé¦–å…ˆåœ¨æŸä¸€ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <strong>nihao.m</strong>æ–‡ä»¶</p>\n<figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch nihao.m</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>nihao.mï¼š</strong></p>\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#import &lt;Foundation/Foundation.h&gt;</span><br><span class=\"line\">int main(int argc, char *argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    @autoreleasepool &#123;</span><br><span class=\"line\">        NSLog(@&quot;nihao!!!&quot;);</span><br><span class=\"line\">        return 0;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n\n        <h3 id=\"3-2-Clangé˜¶æ®µï¼ˆObjective-C-C-C-Objective-C-ï¼‰\"   >\n          <a href=\"#3-2-Clangé˜¶æ®µï¼ˆObjective-C-C-C-Objective-C-ï¼‰\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-2-Clangé˜¶æ®µï¼ˆObjective-C-C-C-Objective-C-ï¼‰\" class=\"headerlink\" title=\"3.2 Clangé˜¶æ®µï¼ˆObjective-C / C++ / C / Objective-C++ï¼‰\"></a>3.2 Clangé˜¶æ®µï¼ˆObjective-C / C++ / C / Objective-C++ï¼‰</h3>\n      \n        <h4 id=\"é¢„å¤„ç†é˜¶æ®µï¼š\"   >\n          <a href=\"#é¢„å¤„ç†é˜¶æ®µï¼š\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é¢„å¤„ç†é˜¶æ®µï¼š\" class=\"headerlink\" title=\"é¢„å¤„ç†é˜¶æ®µï¼š\"></a>é¢„å¤„ç†é˜¶æ®µï¼š</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -E helloworld.c | open -f</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1 &quot;nihao.m&quot;</span><br><span class=\"line\"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class=\"line\"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class=\"line\"># 380 &quot;&lt;built-in&gt;&quot; 3</span><br><span class=\"line\"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class=\"line\"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class=\"line\"># 1 &quot;nihao.m&quot; 2</span><br><span class=\"line\"># 1 &quot;/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/Foundation.framework/Headers/Foundation.h&quot; 1 3</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char *argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    @autoreleasepool &#123;</span><br><span class=\"line\">        NSLog(@&quot;nihao!!!&quot;);</span><br><span class=\"line\">        return 0;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>å°†é¢„å¤„ç†é˜¶æ®µè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œ å¯ä»¥çœ‹åˆ°å¾ˆå¤šä»¥ <strong>#</strong> å¼€å¤´çš„è¯­å¥ï¼Œè¿™äº›è¯­å¥å‘Šè¯‰æˆ‘ä»¬åé¢è·Ÿç€çš„å†…å®¹æ¥è‡ªå“ªé‡Œï¼Œè¿™é‡Œå¯ä»¥çœ‹è§ <strong>Foundation.h</strong> æ–‡ä»¶çš„å†…å®¹ä¹ŸåŒ…å«äº†è¿›æ¥ã€‚åœ¨ <strong>Xcode</strong> ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <strong>Product -&gt;  Perfrom Action -&gt; Preprocess</strong> æŸ¥çœ‹é¢„å¤„ç†é˜¶æ®µä¹‹åçš„ä»£ç ã€‚åœ¨é¢„å¤„ç†é˜¶æ®µåšäº†ä»¥ä¸‹è¿™äº›äº‹æƒ…ï¼š</p>\n<ul>\n<li>å°†å¤´æ–‡ä»¶å¼•å…¥çš„å…¶ä»–æ–‡ä»¶åŠ å…¥æºæ–‡ä»¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚</li>\n<li>è¿›è¡Œæ¡ä»¶ç¼–è¯‘å¤„ç†ã€‚</li>\n<li>å°†å®å®šä¹‰ç›´æ¥æ›¿æ¢ï¼Œä¸è¿›è¡Œè¯­æ³•æ£€æŸ¥ã€‚</li>\n<li>å°†æ³¨é‡Šè¿›è¡Œåˆ é™¤å¤„ç†ã€‚</li>\n</ul>\n\n        <h4 id=\"è¯æ³•åˆ†æé˜¶æ®µ\"   >\n          <a href=\"#è¯æ³•åˆ†æé˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#è¯æ³•åˆ†æé˜¶æ®µ\" class=\"headerlink\" title=\"è¯æ³•åˆ†æé˜¶æ®µ\"></a>è¯æ³•åˆ†æé˜¶æ®µ</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -fmodules -fsyntax-only -Xclang -dump-tokens nihao.m</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">annot_module_include &#x27;#import &lt;Foundation/Foundation.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x27;\t\tLoc=&lt;nihao.m:1:1&gt;</span><br><span class=\"line\">int &#x27;int&#x27;\t [StartOfLine]\tLoc=&lt;nihao.m:3:1&gt;</span><br><span class=\"line\">identifier &#x27;main&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:5&gt;</span><br><span class=\"line\">l_paren &#x27;(&#x27;\t\tLoc=&lt;nihao.m:3:9&gt;</span><br><span class=\"line\">int &#x27;int&#x27;\t\tLoc=&lt;nihao.m:3:10&gt;</span><br><span class=\"line\">identifier &#x27;argc&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:14&gt;</span><br><span class=\"line\">comma &#x27;,&#x27;\t\tLoc=&lt;nihao.m:3:18&gt;</span><br><span class=\"line\">char &#x27;char&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:20&gt;</span><br><span class=\"line\">star &#x27;*&#x27;\t [LeadingSpace]\tLoc=&lt;nihao.m:3:25&gt;</span><br><span class=\"line\">identifier &#x27;argv&#x27;\t\tLoc=&lt;nihao.m:3:26&gt;</span><br><span class=\"line\">l_square &#x27;[&#x27;\t\tLoc=&lt;nihao.m:3:30&gt;</span><br><span class=\"line\">r_square &#x27;]&#x27;\t\tLoc=&lt;nihao.m:3:31&gt;</span><br><span class=\"line\">r_paren &#x27;)&#x27;\t\tLoc=&lt;nihao.m:3:32&gt;</span><br><span class=\"line\">l_brace &#x27;&#123;&#x27;\t [StartOfLine]\tLoc=&lt;nihao.m:4:1&gt;</span><br><span class=\"line\">at &#x27;@&#x27;\t [StartOfLine] [LeadingSpace]\tLoc=&lt;nihao.m:5:5&gt;</span><br><span class=\"line\">identifier &#x27;autoreleasepool&#x27;\t\tLoc=&lt;nihao.m:5:6&gt;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></div></figure>\n\n<p>è¯æ³•åˆ†æé˜¶æ®µå…¶å®æ˜¯å°†æºä»£ç ä»¥å­—ç¬¦æ–‡æœ¬çš„å½¢å¼è½¬æ¢æˆ <strong>Token</strong> æµçš„å½¢å¼ï¼Œä¸æ¶‰åŠè¯­ä¹‰æ ¡éªŒï¼Œç”¨æ¥æ ‡è¯†å‡ºè¿™ä¸ªå­—ç¬¦æ˜¯æ ‡è¯†ç¬¦ã€æ‹¬å·ã€ifè¯­å¥â€¦ï¼Œæœ€åè¿˜ä¼šæ ‡è¯†å‡ºå…¶æ‰€åœ¨ä½ç½®ï¼Œæ–¹ä¾¿åç»­åˆ†æèƒ½å¤Ÿæ‰¾å‡ºå‡ºé”™çš„åŸå§‹ä½ç½®ã€‚</p>\n\n        <h4 id=\"è¯­æ³•åˆ†æé˜¶æ®µ\"   >\n          <a href=\"#è¯­æ³•åˆ†æé˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#è¯­æ³•åˆ†æé˜¶æ®µ\" class=\"headerlink\" title=\"è¯­æ³•åˆ†æé˜¶æ®µ\"></a>è¯­æ³•åˆ†æé˜¶æ®µ</h4>\n      <figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -fsyntax-only -Xclang -ast-dump nihao.m | open -f</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">`-FunctionDecl 0x7f9eb4bd61a0 &lt;nihao.m:3:1, line:9:1&gt; line:3:5 main &#x27;int (int, char **)&#x27;</span><br><span class=\"line\">  |-ParmVarDecl 0x7f9eb4bd5fc0 &lt;col:10, col:14&gt; col:14 argc &#x27;int&#x27;</span><br><span class=\"line\">  |-ParmVarDecl 0x7f9eb4bd6080 &lt;col:20, col:31&gt; col:26 argv &#x27;char **&#x27;:&#x27;char **&#x27;</span><br><span class=\"line\">  `-CompoundStmt 0x7f9eb4bd63d0 &lt;line:4:1, line:9:1&gt;</span><br><span class=\"line\">    `-ObjCAutoreleasePoolStmt 0x7f9eb4bd63b8 &lt;line:5:5, line:8:5&gt;</span><br><span class=\"line\">      `-CompoundStmt 0x7f9eb4bd6398 &lt;line:5:22, line:8:5&gt;</span><br><span class=\"line\">        |-CallExpr 0x7f9eb4bd6328 &lt;line:6:9, col:26&gt; &#x27;void&#x27;</span><br><span class=\"line\">        | |-ImplicitCastExpr 0x7f9eb4bd6310 &lt;col:9&gt; &#x27;void (*)(id, ...)&#x27; &lt;FunctionToPointerDecay&gt;</span><br><span class=\"line\">        | | `-DeclRefExpr 0x7f9eb4bd6250 &lt;col:9&gt; &#x27;void (id, ...)&#x27; Function 0x7f9eb0c8d6c8 &#x27;NSLog&#x27; &#x27;void (id, ...)&#x27;</span><br><span class=\"line\">        | `-ImplicitCastExpr 0x7f9eb4bd6350 &lt;col:15, col:16&gt; &#x27;id&#x27;:&#x27;id&#x27; &lt;BitCast&gt;</span><br><span class=\"line\">        |   `-ObjCStringLiteral 0x7f9eb4bd6290 &lt;col:15, col:16&gt; &#x27;NSString *&#x27;</span><br><span class=\"line\">        |     `-StringLiteral 0x7f9eb4bd6270 &lt;col:16&gt; &#x27;char [9]&#x27; lvalue &quot;nihao!!!&quot;</span><br><span class=\"line\">        `-ReturnStmt 0x7f9eb4bd6388 &lt;line:7:9, col:16&gt;</span><br><span class=\"line\">          `-IntegerLiteral 0x7f9eb4bd6368 &lt;col:16&gt; &#x27;int&#x27; 0</span><br></pre></td></tr></table></div></figure>\n\n<p>è¯­æ³•åˆ†æé˜¶æ®µä¼šè¾“å‡º <strong>AST</strong>ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œå®ƒæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚é€šè¿‡å®ƒï¼Œå¯ä»¥è¿›è¡Œè¯­æ³•é”™è¯¯åˆ†æï¼Œä»¥åŠé™æ€åˆ†ææ“ä½œï¼Œæ¶µç›–å†…å­˜æ“ä½œå’Œå®‰å…¨ç­‰æ–¹é¢ã€‚</p>\n\n        <h4 id=\"CodeGené˜¶æ®µ\"   >\n          <a href=\"#CodeGené˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#CodeGené˜¶æ®µ\" class=\"headerlink\" title=\"CodeGené˜¶æ®µ\"></a>CodeGené˜¶æ®µ</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; ModuleID = &#x27;nihao.m&#x27;</span><br><span class=\"line\">source_filename = &quot;nihao.m&quot;</span><br><span class=\"line\">target datalayout = &quot;e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><br><span class=\"line\">target triple = &quot;x86_64-apple-macosx11.0.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">%struct.__NSConstantString_tag = type &#123; i32*, i32, i8*, i64 &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@__CFConstantStringClassReference = external global [0 x i32]</span><br><span class=\"line\">@.str = private unnamed_addr constant [9 x i8] c&quot;nihao!!!\\00&quot;, section &quot;__TEXT,__cstring,cstring_literals&quot;, align 1</span><br><span class=\"line\">@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag &#123; i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 &#125;, section &quot;__DATA,__cfstring&quot;, align 8 #0</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: noinline optnone ssp uwtable</span><br><span class=\"line\">define i32 @main(i32 %0, i8** %1) #1 &#123;</span><br><span class=\"line\">  %3 = alloca i32, align 4</span><br><span class=\"line\">  %4 = alloca i32, align 4</span><br><span class=\"line\">  %5 = alloca i8**, align 8</span><br><span class=\"line\">  store i32 0, i32* %3, align 4</span><br><span class=\"line\">  store i32 %0, i32* %4, align 4</span><br><span class=\"line\">  store i8** %1, i8*** %5, align 8</span><br><span class=\"line\">  %6 = call i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\">  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*))</span><br><span class=\"line\">  store i32 0, i32* %3, align 4</span><br><span class=\"line\">  call void @llvm.objc.autoreleasePoolPop(i8* %6)</span><br><span class=\"line\">  %7 = load i32, i32* %3, align 4</span><br><span class=\"line\">  ret i32 %7</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\"></span><br><span class=\"line\">declare void @NSLog(i8*, ...) #3</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare void @llvm.objc.autoreleasePoolPop(i8*) #2</span><br><span class=\"line\"></span><br><span class=\"line\">attributes #0 = &#123; &quot;objc_arc_inert&quot; &#125;</span><br><span class=\"line\">attributes #1 = &#123; noinline optnone ssp uwtable &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-jump-tables&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\">attributes #2 = &#123; nounwind &#125;</span><br><span class=\"line\">attributes #3 = &#123; &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!llvm.module.flags = !&#123;!0, !1, !2, !3, !4, !5, !6, !7&#125;</span><br><span class=\"line\">!llvm.ident = !&#123;!8&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!0 = !&#123;i32 2, !&quot;SDK Version&quot;, [2 x i32] [i32 12, i32 0]&#125;</span><br><span class=\"line\">!1 = !&#123;i32 1, !&quot;Objective-C Version&quot;, i32 2&#125;</span><br><span class=\"line\">!2 = !&#123;i32 1, !&quot;Objective-C Image Info Version&quot;, i32 0&#125;</span><br><span class=\"line\">!3 = !&#123;i32 1, !&quot;Objective-C Image Info Section&quot;, !&quot;__DATA,__objc_imageinfo,regular,no_dead_strip&quot;&#125;</span><br><span class=\"line\">!4 = !&#123;i32 1, !&quot;Objective-C Garbage Collection&quot;, i8 0&#125;</span><br><span class=\"line\">!5 = !&#123;i32 1, !&quot;Objective-C Class Properties&quot;, i32 64&#125;</span><br><span class=\"line\">!6 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class=\"line\">!7 = !&#123;i32 7, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class=\"line\">!8 = !&#123;!&quot;Apple clang version 13.0.0 (clang-1300.0.29.3)&quot;&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>CodeGen</strong> é˜¶æ®µè´Ÿè´£å°† <strong>AST</strong> è‡ªé¡¶å‘ä¸‹éå†é€æ­¥ç¿»è¯‘æˆ <strong>LLVM IR</strong>ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨åç«¯æ‰€éœ€è¦çš„ä¸­é—´ä»£ç ï¼ŒåŒæ—¶ <strong>Objective-C</strong> ä»£ç ä¹Ÿä¼šåœ¨è¿™ä¸€æ­¥è¿›è¡Œ <strong>Runtime</strong> æ¡¥æ¥ï¼š <strong>property</strong> åˆæˆï¼Œ<strong>ARC</strong> å¤„ç†ç­‰ï¼Œå¦‚ä¸Šæ–¹å¯ä»¥çœ‹è§ <strong>autoreleasePoolPush</strong> ã€ <strong>autoreleasePoolPop</strong> æ“ä½œã€‚</p>\n<p>è‡³æ­¤ <strong>Clang</strong> å‰ç«¯å·¥ä½œç®—æ˜¯å®Œæˆï¼Œæ¥ä¸‹æ¥å°±äº¤ç»™åç«¯è¿›è¡Œå¤„ç†ã€‚</p>\n\n        <h3 id=\"3-3-LLVM-Optimizer-é˜¶æ®µ\"   >\n          <a href=\"#3-3-LLVM-Optimizer-é˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-3-LLVM-Optimizer-é˜¶æ®µ\" class=\"headerlink\" title=\"3.3 LLVM Optimizer é˜¶æ®µ\"></a>3.3 LLVM Optimizer é˜¶æ®µ</h3>\n      \n        <h4 id=\"IRä»£ç ä¼˜åŒ–\"   >\n          <a href=\"#IRä»£ç ä¼˜åŒ–\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#IRä»£ç ä¼˜åŒ–\" class=\"headerlink\" title=\"IRä»£ç ä¼˜åŒ–\"></a>IRä»£ç ä¼˜åŒ–</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -Os -S -fobjc-arc -emit-llvm nihao.m -o nihao.ll</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; ModuleID = &#x27;nihao.m&#x27;</span><br><span class=\"line\">source_filename = &quot;nihao.m&quot;</span><br><span class=\"line\">target datalayout = &quot;e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><br><span class=\"line\">target triple = &quot;x86_64-apple-macosx11.0.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">%struct.__NSConstantString_tag = type &#123; i32*, i32, i8*, i64 &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@__CFConstantStringClassReference = external global [0 x i32]</span><br><span class=\"line\">@.str = private unnamed_addr constant [9 x i8] c&quot;nihao!!!\\00&quot;, section &quot;__TEXT,__cstring,cstring_literals&quot;, align 1</span><br><span class=\"line\">@_unnamed_cfstring_ = private global %struct.__NSConstantString_tag &#123; i32* getelementptr inbounds ([0 x i32], [0 x i32]* @__CFConstantStringClassReference, i32 0, i32 0), i32 1992, i8* getelementptr inbounds ([9 x i8], [9 x i8]* @.str, i32 0, i32 0), i64 8 &#125;, section &quot;__DATA,__cfstring&quot;, align 8 #0</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: optsize ssp uwtable</span><br><span class=\"line\">define i32 @main(i32 %0, i8** nocapture readnone %1) local_unnamed_addr #1 &#123;</span><br><span class=\"line\">  %3 = tail call i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\">  notail call void (i8*, ...) @NSLog(i8* bitcast (%struct.__NSConstantString_tag* @_unnamed_cfstring_ to i8*)) #4, !clang.arc.no_objc_arc_exceptions !9</span><br><span class=\"line\">  tail call void @llvm.objc.autoreleasePoolPop(i8* %3) #2</span><br><span class=\"line\">  ret i32 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare i8* @llvm.objc.autoreleasePoolPush() #2</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: optsize</span><br><span class=\"line\">declare void @NSLog(i8*, ...) local_unnamed_addr #3</span><br><span class=\"line\"></span><br><span class=\"line\">; Function Attrs: nounwind</span><br><span class=\"line\">declare void @llvm.objc.autoreleasePoolPop(i8*) #2</span><br><span class=\"line\"></span><br><span class=\"line\">attributes #0 = &#123; &quot;objc_arc_inert&quot; &#125;</span><br><span class=\"line\">attributes #1 = &#123; optsize ssp uwtable &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-jump-tables&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\">attributes #2 = &#123; nounwind &#125;</span><br><span class=\"line\">attributes #3 = &#123; optsize &quot;darwin-stkchk-strong-link&quot; &quot;disable-tail-calls&quot;=&quot;false&quot; &quot;frame-pointer&quot;=&quot;all&quot; &quot;less-precise-fpmad&quot;=&quot;false&quot; &quot;no-infs-fp-math&quot;=&quot;false&quot; &quot;no-nans-fp-math&quot;=&quot;false&quot; &quot;no-signed-zeros-fp-math&quot;=&quot;false&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;probe-stack&quot;=&quot;___chkstk_darwin&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;penryn&quot; &quot;target-features&quot;=&quot;+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &quot;unsafe-fp-math&quot;=&quot;false&quot; &quot;use-soft-float&quot;=&quot;false&quot; &#125;</span><br><span class=\"line\">attributes #4 = &#123; optsize &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!llvm.module.flags = !&#123;!0, !1, !2, !3, !4, !5, !6, !7&#125;</span><br><span class=\"line\">!llvm.ident = !&#123;!8&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">!0 = !&#123;i32 2, !&quot;SDK Version&quot;, [2 x i32] [i32 12, i32 0]&#125;</span><br><span class=\"line\">!1 = !&#123;i32 1, !&quot;Objective-C Version&quot;, i32 2&#125;</span><br><span class=\"line\">!2 = !&#123;i32 1, !&quot;Objective-C Image Info Version&quot;, i32 0&#125;</span><br><span class=\"line\">!3 = !&#123;i32 1, !&quot;Objective-C Image Info Section&quot;, !&quot;__DATA,__objc_imageinfo,regular,no_dead_strip&quot;&#125;</span><br><span class=\"line\">!4 = !&#123;i32 1, !&quot;Objective-C Garbage Collection&quot;, i8 0&#125;</span><br><span class=\"line\">!5 = !&#123;i32 1, !&quot;Objective-C Class Properties&quot;, i32 64&#125;</span><br><span class=\"line\">!6 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class=\"line\">!7 = !&#123;i32 7, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class=\"line\">!8 = !&#123;!&quot;Apple clang version 13.0.0 (clang-1300.0.29.3)&quot;&#125;</span><br><span class=\"line\">!9 = !&#123;&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>IR</strong> ä»£ç ä¼˜åŒ–ä¼šè°ƒç”¨ç›¸åº” <strong>Pass</strong> è¿›è¡Œå¤„ç†ï¼Œ<strong>Pass</strong> ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œéƒ½æ˜¯ <strong>Pass</strong> ç±»çš„å­ç±»ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„ä¼˜åŒ–ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿè‡ªä¸»çš„æ§åˆ¶ä¼˜åŒ–çš„å¼ºåº¦ï¼Œåœ¨<strong>Build Strrings -&gt; Optimization Level</strong> ä¸­å¯æŒ‡å®šä¼˜åŒ–ç¨‹åº¦ï¼Œä¸€äº›å¸¸è§çš„ä»£ç ä¼˜åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>åˆ é™¤å…¬å…±å­è¡¨è¾¾å¼</li>\n<li>åˆ é™¤æ— ç”¨ä»£ç </li>\n<li>å¸¸é‡åˆå¹¶</li>\n<li>ä»£ç ç§»åŠ¨</li>\n<li>åˆ é™¤å½’çº³å˜é‡</li>\n</ul>\n\n        <h4 id=\"ç”Ÿæˆ-BitCodeï¼ˆArchiveæ—¶ï¼‰\"   >\n          <a href=\"#ç”Ÿæˆ-BitCodeï¼ˆArchiveæ—¶ï¼‰\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ç”Ÿæˆ-BitCodeï¼ˆArchiveæ—¶ï¼‰\" class=\"headerlink\" title=\"ç”Ÿæˆ BitCodeï¼ˆArchiveæ—¶ï¼‰\"></a>ç”Ÿæˆ BitCodeï¼ˆArchiveæ—¶ï¼‰</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xrun clang -emit-llvm -c nihao.m -o nihao.bc</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dec0 170b 0000 0000 1400 0000 0010 0000</span><br><span class=\"line\">0700 0001 4243 c0de 3514 0000 0700 0000</span><br><span class=\"line\">620c 3024 9596 a6a5 f7d7 7f7d d3b4 4ffb</span><br><span class=\"line\">76ef df3f 2d44 0132 0500 0000 210c 0000</span><br><span class=\"line\">4903 0000 0b02 2100 0200 0000 1600 0000</span><br><span class=\"line\">0781 2391 41c8 0449 0610 3239 9201 840c</span><br><span class=\"line\">2505 0819 1e04 8b62 8014 4502 4292 0b42</span><br><span class=\"line\">a410 3214 3808 184b 0a32 5288 4870 c421</span><br><span class=\"line\">...</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>BitCode</strong> æ˜¯ <strong>LLVM</strong> å¼•å…¥çš„å¦ä¸€ç§ä¸­é—´ä»£ç ï¼Œè™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒæ¥è¿‘æœºå™¨ç ï¼Œä½†æ˜¯åœ¨å‡½æ•°å’ŒæŒ‡ä»¤å±‚é¢ä½¿ç”¨äº†å¾ˆå¤šé«˜çº§è¯­è¨€çš„ç‰¹æ€§ã€‚</p>\n<p>ä½†åªä¼šåœ¨ <strong>Archive</strong> æ—¶ï¼Œ<strong>BitCode</strong> æ‰ä¼šè¢«åµŒå…¥åˆ°é“¾æ¥åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºæäº¤ç»™ <strong>App Store</strong>ï¼ŒåŒ…å« <strong>Bitcode</strong> é…ç½®çš„ç¨‹åºå°†ä¼šåœ¨ <strong>App Store</strong> ä¸Šè¢«é‡æ–°ç¼–è¯‘å’Œé“¾æ¥ï¼Œè¿›è€Œå¯¹å¯æ‰§è¡Œæ–‡ä»¶åšä¼˜åŒ–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¼˜åŒ–è¿™ä¸€æ­¥æ˜¯åœ¨ <strong>App Store</strong> ä¸­åšçš„å¤„ç†ï¼Œæœ¬åœ°æ²¡æœ‰åšå¤„ç†ã€‚è¿›è¡Œå…¶ä»–ç±»å‹çš„ <strong>Build</strong> (é <strong>Archive</strong> )æ—¶ï¼Œç¼–è¯‘å™¨åªä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³å¼€å¯ <strong>BitCode</strong> çš„æ¡ä»¶ï¼Œä½†å¹¶ä¸ä¼šçœŸæ­£ç”Ÿæˆ <strong>BitCode</strong> ã€‚</p>\n\n        <h3 id=\"3-4-LLVM-Code-Generatoré˜¶æ®µ\"   >\n          <a href=\"#3-4-LLVM-Code-Generatoré˜¶æ®µ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#3-4-LLVM-Code-Generatoré˜¶æ®µ\" class=\"headerlink\" title=\"3.4 LLVM Code Generatoré˜¶æ®µ\"></a>3.4 LLVM Code Generatoré˜¶æ®µ</h3>\n      \n        <h4 id=\"ç”Ÿæˆæ±‡ç¼–ä»£ç \"   >\n          <a href=\"#ç”Ÿæˆæ±‡ç¼–ä»£ç \" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ç”Ÿæˆæ±‡ç¼–ä»£ç \" class=\"headerlink\" title=\"ç”Ÿæˆæ±‡ç¼–ä»£ç \"></a>ç”Ÿæˆæ±‡ç¼–ä»£ç </h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -S -fobjc-arc nihao.m -o nihao.s</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t.section\t__TEXT,__text,regular,pure_instructions</span><br><span class=\"line\">\t.build_version macos, 11, 0\tsdk_version 12, 0</span><br><span class=\"line\">\t.globl\t_main                           ## -- Begin function main</span><br><span class=\"line\">\t.p2align\t4, 0x90</span><br><span class=\"line\">_main:                                  ## @main</span><br><span class=\"line\">\t.cfi_startproc</span><br><span class=\"line\">## %bb.0:</span><br><span class=\"line\">\tpushq\t%rbp</span><br><span class=\"line\">\t.cfi_def_cfa_offset 16</span><br><span class=\"line\">\t.cfi_offset %rbp, -16</span><br><span class=\"line\">\tmovq\t%rsp, %rbp</span><br><span class=\"line\">\t.cfi_def_cfa_register %rbp</span><br><span class=\"line\">\tsubq\t$32, %rsp</span><br><span class=\"line\">\tmovl\t$0, -4(%rbp)</span><br><span class=\"line\">\tmovl\t%edi, -8(%rbp)</span><br><span class=\"line\">\tmovq\t%rsi, -16(%rbp)</span><br><span class=\"line\">\tcallq\t_objc_autoreleasePoolPush</span><br><span class=\"line\">\tmovq\t%rax, -24(%rbp)                 ## 8-byte Spill</span><br><span class=\"line\">\tleaq\tL__unnamed_cfstring_(%rip), %rdi</span><br><span class=\"line\">\tmovb\t$0, %al</span><br><span class=\"line\">\tcallq\t_NSLog</span><br><span class=\"line\">\tmovq\t-24(%rbp), %rdi                 ## 8-byte Reload</span><br><span class=\"line\">\tmovl\t$0, -4(%rbp)</span><br><span class=\"line\">\tcallq\t_objc_autoreleasePoolPop</span><br><span class=\"line\">\tmovl\t-4(%rbp), %eax</span><br><span class=\"line\">\taddq\t$32, %rsp</span><br><span class=\"line\">\tpopq\t%rbp</span><br><span class=\"line\">\tretq</span><br><span class=\"line\">\t.cfi_endproc</span><br><span class=\"line\">                                        ## -- End function</span><br><span class=\"line\">\t.section\t__TEXT,__cstring,cstring_literals</span><br><span class=\"line\">L_.str:                                 ## @.str</span><br><span class=\"line\">\t.asciz\t&quot;nihao!!!&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\t.section\t__DATA,__cfstring</span><br><span class=\"line\">\t.p2align\t3                               ## @_unnamed_cfstring_</span><br><span class=\"line\">L__unnamed_cfstring_:</span><br><span class=\"line\">\t.quad\t___CFConstantStringClassReference</span><br><span class=\"line\">\t.long\t1992                            ## 0x7c8</span><br><span class=\"line\">\t.space\t4</span><br><span class=\"line\">\t.quad\tL_.str</span><br><span class=\"line\">\t.quad\t8                               ## 0x8</span><br><span class=\"line\"></span><br><span class=\"line\">\t.section\t__DATA,__objc_imageinfo,regular,no_dead_strip</span><br><span class=\"line\">L_OBJC_IMAGE_INFO:</span><br><span class=\"line\">\t.long\t0</span><br><span class=\"line\">\t.long\t64</span><br><span class=\"line\"></span><br><span class=\"line\">.subsections_via_symbols</span><br></pre></td></tr></table></div></figure>\n\n<p>æ±‡ç¼–è¯­è¨€æ›´åŠ æ¥è¿‘æœºå™¨è¯­è¨€ï¼Œèƒ½å¤Ÿç›´æ¥å¯¹ç¡¬ä»¶è¿›è¡Œæ“ä½œï¼Œç”Ÿæˆçš„ç¨‹åºä¸å…¶ä»–çš„è¯­è¨€ç›¸æ¯”å…·æœ‰æ›´é«˜çš„è¿è¡Œé€Ÿåº¦ï¼Œå ç”¨æ›´å°çš„å†…å­˜ã€‚</p>\n<p>ç›®å‰æ‰€æœ‰ <strong>iOS</strong> è®¾å¤‡éƒ½é‡‡ç”¨ <strong>ARM</strong> å¤„ç†å™¨ï¼Œè¿™æ„å‘³ç€éƒ½æ˜¯é‡‡ç”¨ <strong>ARM</strong> æŒ‡ä»¤é›†ï¼Œå¦‚ <strong>armv6 / armv7 / armv7s / arm64</strong>ï¼Œè¿™äº›æŒ‡ä»¤é›†éƒ½æ˜¯å‘ä¸‹å…¼å®¹çš„ã€‚</p>\n<p>æ¯ç§ <strong>CPU</strong> æ¶æ„éƒ½æœ‰ç€ç›¸åº”çš„æŒ‡ä»¤é›†ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ¶æ„äº§ç”Ÿä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤ï¼ŒåŠ ä¸Šä¸Šé¢ <strong>- arch arch_type</strong> é€‰é¡¹å³å¯ï¼Œæ›´å¤šè¯·å‚è§<span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://developer.apple.com/library/archive/documentation/DeveloperTools/Reference/Assembler/000-Introduction/introduction.html\" >å®˜ç½‘</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span>ã€‚åœ¨ <strong>Xcode</strong> ä¸­å¯åœ¨ <strong>Build Settings -&gt; Architectrues</strong> æŒ‡å®šäº§ç”Ÿçš„ <strong>CPU</strong> æŒ‡ä»¤é›†ã€‚</p>\n\n        <h4 id=\"ç”Ÿæˆæœºå™¨ä»£ç \"   >\n          <a href=\"#ç”Ÿæˆæœºå™¨ä»£ç \" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ç”Ÿæˆæœºå™¨ä»£ç \" class=\"headerlink\" title=\"ç”Ÿæˆæœºå™¨ä»£ç \"></a>ç”Ÿæˆæœºå™¨ä»£ç </h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang -fmodules -c nihao.s -o nihao.o</span><br></pre></td></tr></table></div></figure>\n\n<p>å¯ä»¥å‘ç°æœºå™¨ç äºŒè¿›åˆ¶æ–‡ä»¶æ— æ³•é˜…è¯»ï¼Œå¯å€ŸåŠ© <strong>otool</strong> æˆ–è€… <strong>MachOView</strong> ç­‰å·¥å…·æŸ¥çœ‹æ–‡ä»¶ä¸­çš„ç›¸å…³å†…å®¹ï¼š</p>\n<figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">otool -v -h nihao.o</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nihao.o:</span><br><span class=\"line\">Mach header</span><br><span class=\"line\">      magic  cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags</span><br><span class=\"line\">MH_MAGIC_64   X86_64        ALL  0x00      OBJECT     4        680 SUBSECTIONS_VIA_SYMBOLS</span><br></pre></td></tr></table></div></figure>\n\n<p>å¯ä»¥çœ‹è§ <strong>.o</strong> æ–‡ä»¶å®é™…ä¸Šæ˜¯ <strong>mach-o</strong> æ ¼å¼ï¼Œè¿™é‡Œæˆ‘ä»¬è¾“å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„å¤´éƒ¨ï¼Œè§„å®šäº†è¿™ä¸ªæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œé€‚åº”æ¶æ„çš„ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠæ–‡ä»¶æ˜¯å¦‚ä½•è¢«åŠ è½½çš„ã€‚æ›´å¤šå…³äº <strong>mach-o</strong> çš„çŸ¥è¯†<span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://www.jianshu.com/p/54d842db3f69\" >å‚è§</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span>ã€‚</p>\n\n        <h4 id=\"é“¾æ¥\"   >\n          <a href=\"#é“¾æ¥\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é“¾æ¥\" class=\"headerlink\" title=\"é“¾æ¥\"></a>é“¾æ¥</h4>\n      <figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcrun clang nihao.o -Wl,`xcrun --show-sdk-path`/System/Library/Frameworks/Foundation.framework/Foundation</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight shell\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./a.out</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2021-11-03 16:06:41.734 a.out[6394:220026] nihao!!!</span><br></pre></td></tr></table></div></figure>\n\n<p>ç”±äºæˆ‘ä»¬å¼•å…¥äº† <strong>Foundation</strong> é‡Œé¢çš„æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°†ç›®æ ‡æ–‡ä»¶å’Œ <strong>Foundation framework</strong>è¿›è¡Œé“¾æ¥ï¼Œæ¥ç€å°±å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºäº†ã€‚</p>\n<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šç¬¦å·è¡¨ï¼Œé‡Œé¢å­˜å‚¨çš„å…ƒç´ å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight xml\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;èµ·å§‹åœ°å€&gt; &lt;ç»“æŸåœ°å€&gt; &lt;å‡½æ•°&gt; [&lt;æ–‡ä»¶å:è¡Œå·&gt;]</span><br></pre></td></tr></table></div></figure>\n\n<p>è¿™é‡Œæˆ‘ä»¬è¾“å…¥a.outçš„ç¬¦å·ä¿¡æ¯</p>\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nm -nm a.out</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plaintext\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                 (undefined) external _NSLog (from Foundation)</span><br><span class=\"line\">                 (undefined) external ___CFConstantStringClassReference (from CoreFoundation)</span><br><span class=\"line\">                 (undefined) external _objc_autoreleasePoolPop (from libobjc)</span><br><span class=\"line\">                 (undefined) external _objc_autoreleasePoolPush (from libobjc)</span><br><span class=\"line\">                 (undefined) external dyld_stub_binder (from libSystem)</span><br><span class=\"line\">0000000100000000 (__TEXT,__text) [referenced dynamically] external __mh_execute_header</span><br><span class=\"line\">0000000100003f20 (__TEXT,__text) external _main</span><br><span class=\"line\">0000000100008018 (__DATA,__data) non-external __dyld_private</span><br></pre></td></tr></table></div></figure>\n\n<p>å¯¹äºåŠ¨æ€é“¾æ¥åº“çš„ç¬¦å·ï¼ˆå¦‚ <strong>Foundation</strong>ï¼‰ï¼Œæœ€ç»ˆä¼šè®°å½•ä¸‹è¿™ä¸ªç¬¦å·æ˜¯é€šè¿‡è¿›è¡Œé“¾æ¥çš„ï¼Œå¹¶è®°å½•ä¸‹ä¾èµ–äºå“ªä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨ï¼ˆ<strong>dyld</strong>ï¼‰ä¼šå»è§£æè¿™äº› <strong>undefined</strong> ç¬¦å·ã€‚å¯¹äºå…¶ä»–ä½ç½®çš„ç¬¦å·ï¼Œä¼šç›´æ¥ä¿®æ­£è¿™äº›ç¬¦å·çš„å…·ä½“ä½ç½®ä¿¡æ¯ã€‚</p>\n\n        <h2 id=\"4-æ€»ç»“\"   >\n          <a href=\"#4-æ€»ç»“\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#4-æ€»ç»“\" class=\"headerlink\" title=\"4. æ€»ç»“\"></a>4. æ€»ç»“</h2>\n      <p>æœ¬æ–‡ä»‹ç»äº†å…³äº iOS ç¼–è¯‘å™¨ã€iOS ç¼–è¯‘è¿‡ç¨‹çš„åŸºç¡€çŸ¥è¯†ã€‚å­¦ä¹ äº†è¿™äº›ï¼Œå¯¹ iOS ç¼–è¯‘æœ‰ä¸ªæ•´ä½“è®¤è¯†ã€‚å°±æœ¬äººè€Œè¨€ï¼Œåœ¨ä¸€è·¯æœå¯»èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹ä¹‹å‰ä¸€äº›é›¶æ•£çš„çŸ¥è¯†ç‚¹æœ‰äº†ä¸€äº›æ›´åŠ æ·±å…¥çš„è®¤è¯†ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œå…³äº SwiftC çš„ç¼–è¯‘è¿‡ç¨‹æ²¡æœ‰å¤šåšä»‹ç»ï¼Œåé¢ä¼šå†å‡ºä¸€ç¯‡è¿›è¡Œä»‹ç»ã€‚</p>\n<p>ğŸ”—ï¼š</p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://objccn.io/issue-6-3/\" >ObjC ä¸­å›½ - Mach-O å¯æ‰§è¡Œæ–‡ä»¶</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://kiprey.github.io/2020/06/LLVM-IR-pass/\" >ä»£ç ä¼˜åŒ–ä¸LLVM IR pass</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"http://xelz.info/blog/2018/11/24/all-you-need-to-know-about-bitcode/\" >å…³äºbitcode, çŸ¥é“è¿™äº›å°±å¤Ÿäº†</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://zhuanlan.zhihu.com/p/340782811\" >iOS ç¼–è¯‘é“¾æ¥ï¼šObjective-C ç¼–è¯‘é“¾æ¥</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://www.jianshu.com/p/54d842db3f69\" >è¶£æ¢ Mach-Oï¼šæ–‡ä»¶æ ¼å¼åˆ†æ</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n"},{"title":"NSTimerå¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³","_content":"\n### å‰è¨€\n\næœ¬æ–‡å°†ä»å¦‚ä½•ä½¿ç”¨ **NSTimer** ã€ **NSTimer** ä½•ç§æƒ…å†µä¸‹ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œä»¥åŠå¦‚ä½•é¿å…å¾ªç¯å¼•ç”¨å‡ ä¸ªè§’åº¦è¿›è¡Œä»‹ç»ã€‚\n\n### NSTimer å¦‚ä½•ä½¿ç”¨\n\n> A timer that fires after a certain time interval has elapsed, sending a specified message to a target object.\n>\n> ç¿»è¯‘ï¼šä¸€ç§è®¡æ—¶å™¨ï¼Œåœ¨ç»è¿‡ä¸€å®šçš„æ—¶é—´é—´éš”åè§¦å‘ï¼Œå‘ç›®æ ‡å¯¹è±¡å‘é€æŒ‡å®šçš„æ¶ˆæ¯ã€‚\n\n#### åˆ›å»º\n\n**NSTimer** æä¾›äº†ä¸‰ç§åˆ›å»ºæ–¹å¼ï¼š\n\n1. ä»¥ `scheduledTimerWithTimeInterval` ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹\n\n2. ä»¥ `timerWithTimeInterval` å¼€å¤´çš„åˆ›å»ºå®ä¾‹\n\n3. ä»¥ `init` æ–¹æ³•åˆå§‹åŒ–æ–¹æ³•åˆ›å»ºå®ä¾‹\n\nè‹¥é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºï¼Œä¼šä»¥ **default mode** æ–¹å¼è‡ªåŠ¨åŠ å…¥åˆ°å½“å‰çš„ **RunLoop** ä¸­ã€‚\n\nè‹¥é‡‡ç”¨ç¬¬äºŒã€ä¸‰ç§æ–¹å¼åˆ›å»ºï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨NSRunLoopå¯¹è±¡çš„ `addTimer:forMode:` æ–¹æ³•ã€‚\n\n```swift\nlet timer = Timer.init(timeInterval: 1.0, repeats: true) { timer in\n   print(\"This\")\n}\nRunLoop.main.add(timer, forMode: .default)\n```\n\n#### é”€æ¯\n\n`invalidate()` \n\nè¯¥æ–¹æ³•æ˜¯åœ¨å…¶åŠ å…¥çš„ **RunLoop** å¯¹è±¡ä¸­ç§»é™¤timerçš„å”¯ä¸€æ–¹æ³•ï¼ŒåŒæ—¶ä¼š **RunLoop** å¯¹è±¡ä¼šç§»é™¤å…¶å¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œè‹¥é…ç½®äº† **target** å’Œ **user info** å¯¹è±¡ï¼Œ **timer** ä¹Ÿä¼šç§»é™¤å¯¹è¿™äº›å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚\n\n### ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\n\n#### å¾ªç¯å¼•ç”¨\n\nè€ƒè™‘ä¸€ä¸ªå¸¸è§ä½¿ç”¨ **NSTimer** çš„åœºæ™¯ï¼šåœ¨ **ViewController** ä¸­å°† **timer** ä½œä¸ºå±æ€§ï¼Œè€Œ **timer** åœ¨åˆ›å»ºé‡‡ç”¨äº† **target-action** çš„æ–¹å¼ï¼Œæ ¹æ® **Apple** æ–‡æ¡£ï¼Œ**timer** ä¼šå¯¹ **target** äº§ç”Ÿå¼ºå¼•ç”¨ï¼Œè¿™å°±äº§ç”Ÿäº†æœ‰å‘ç¯ï¼Œå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œä¸‹å›¾æ˜¯ä¸Šä¾‹å¯¹è±¡å¼•ç”¨å›¾ï¼š\n\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817112104936.png\" alt=\"image-20210817112104936\" style=\"zoom:40%;\" />\n\n#### RunLoopæŒæœ‰timer\n\nè¿˜æ˜¯ä¸Šä¾‹çš„åœºæ™¯ï¼Œè‹¥åœ¨ **timer** åˆ›å»ºæ—¶ä¸é‡‡ç”¨ **target-action** ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è§£å†³äº†ï¼Ÿ\n\nç¡®å®å¯ä»¥è§£å†³ï¼Œä½†è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”±äº **RunLoop** å¯¹è±¡è¿˜æŒæœ‰ç€ **timer** å¯¹è±¡ï¼Œè¿™æ—¶ **ViewController** èƒ½è¢«æ­£å¸¸é‡Šæ”¾ï¼Œä½† **timer** çš„å¼•ç”¨è®¡æ•°ç”±äºä¸ä¸º **1** ï¼Œæ— æ³•è¢«é‡Šæ”¾ï¼Œè¿™ç§æƒ…å†µåªæ˜¯ **timer** æ— æ³•è¢«é‡Šæ”¾ï¼Œå¹¶ä¸ç®—å¾ªç¯å¼•ç”¨èŒƒç•´ï¼Œå½“ç„¶è‹¥ **RunLoop** å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œåˆ™è¿™ä¸ª **timer** ä¹Ÿä¼šè¢«é‡Šæ”¾æ‰ã€‚\n\n\n\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817145841853.png\" alt=\"image-20210817145841853\" style=\"zoom:40%;\" />\n\nå½“ç„¶æ­¤ä¸Šä¸¤ç§æƒ…å†µéƒ½æ˜¯å°† **timer** çš„ `repeat` å‚æ•°è®¾ç½®ä¸º `true` æ—¶ï¼Œè‹¥ä¸º `false` åˆ™åœ¨å®šæ—¶å™¨ç¬¬ä¸€æ¬¡è§¦å‘åï¼Œä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œå³ **RunLoop** ä¼šç§»é™¤å¯¹ **timer** çš„å¼ºå¼•ç”¨ï¼Œ **timer** ä¹Ÿä¼šç§»é™¤å¯¹ **target** å’Œ **user info** å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚\n\n### è§£å†³æ–¹æ¡ˆ\n\n#### åˆé€‚çš„æ—¶æœºè°ƒç”¨ `invalidate()`\n\nåœ¨ä¸Šæ–‡ä»‹ç»äº†`invalidate()` ï¼Œ æˆ‘ä»¬åªéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨ `invalidate()`å³å¯ã€‚\n\né‚£ä¹ˆä»€ä¹ˆæ˜¯åˆé€‚çš„æ—¶æœºå‘¢ï¼Ÿ\n\n1. è‹¥æ¸…æ¥šçŸ¥é“ä»€ä¹ˆæ—¶å€™ **timer** ä¸å†ä½¿ç”¨ï¼Œåˆ™åº”ç«‹å³è°ƒç”¨ã€‚\n2. è‹¥ä¸æ¸…æ¥šåˆ™åº”ç ´é™¤å¾ªç¯å¼•ç”¨ï¼Œæœ€ååœ¨ **ViewController** çš„ `deinit` ä¸­è¿›è¡Œè°ƒç”¨ã€‚\n\n#### é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\n\n1. é‡‡ç”¨ `weak` å…³é”®å­—ä¿®é¥° **timer** ï¼Œä½†éœ€é‡‡ç”¨`scheduledTimerWithTimeInterval` ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šå°† **timer** åŠ å…¥åˆ° **RunLoop** å¯¹è±¡ä¸­ï¼Œå¦åˆ™ç”±äº `weak` ä¿®é¥°ï¼Œ **timer** ä¼šè¢«è‡ªåŠ¨è®¾ä¸º`nil`ã€‚\n2. é‡‡ç”¨ `weak` å…³é”®å­—ä¿®é¥° **target** å¯¹è±¡ï¼Œä½†éœ€åœ¨ **block** ä¸­è¿›è¡Œä½¿ç”¨ï¼ŒåŸç†å¤§æ¦‚æ˜¯ **block** ä¸­çš„ **weakSelf** ç›¸å½“äºä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œè¿›è€Œé˜»æ­¢äº†å¾ªç¯å¼•ç”¨ã€‚\n3. é‡‡ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼Œè®©å…¶ä»–å¯¹è±¡æ‰¿æ‹… `target` è§’è‰²ï¼Œä»è€Œé˜»æ­¢å¾ªç¯å¼•ç”¨ã€‚\n4. åŸºäº **NSProxy** æ–¹å¼ï¼Œä¸ **3** ç±»ä¼¼ï¼Œé€šè¿‡å…¶ä»–å¯¹è±¡æ¥é˜»æ­¢å¾ªç¯å¼•ç”¨ï¼Œéœ€æ³¨æ„çš„æ˜¯ **NSProxy** æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚\n5. ä¹Ÿå¯ç›´æ¥ä½¿ç”¨ **Apple** æä¾›çš„æ–° **API**ï¼š\n\n```swift\nclass func scheduledTimer(withTimeInterval interval: TimeInterval, repeats: Bool, block: @escaping (Timer) -> Void) -> Timer\n\ninit(timeInterval interval: TimeInterval, repeats: Bool, block: @escaping (Timer) -> Void)\n\nconvenience init(fire date: Date, interval: TimeInterval, repeats: Bool, block: @escaping (Timer) -> Void)\n```\n\n\n\n> the timer itself is passed as the parameter to this block when executed to aid in avoiding cyclical referencesã€‚\n>\n> ç¿»è¯‘ï¼šåœ¨æ‰§è¡Œæ—¶ï¼Œå®šæ—¶å™¨æœ¬èº«ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªå—ï¼Œä»¥å¸®åŠ©é¿å…å¾ªç¯å¼•ç”¨ã€‚\n\n### å¼•ç”¨\n\n[iOSä¹‹NSTimerå¾ªç¯å¼•ç”¨çš„è§£å†³æ–¹æ¡ˆ](https://juejin.cn/post/6844903968250789896#heading-5)\n\n[iOSä¸­Timerå¾ªç¯å¼•ç”¨åŸå› åŠè§£å†³æ–¹æ¡ˆ](https://www.jianshu.com/p/e8fc6c2b3afa)\n\n[Appleæ–‡æ¡£ - NSTimer](https://developer.apple.com/documentation/foundation/nstimer/)\n\n","source":"_posts/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³.md","raw":"---\ntitle: \"NSTimerå¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³\"\ncategories:\n  - iOS\ntags:\n  - NSTimer\n  - iOS\n---\n\n### å‰è¨€\n\næœ¬æ–‡å°†ä»å¦‚ä½•ä½¿ç”¨ **NSTimer** ã€ **NSTimer** ä½•ç§æƒ…å†µä¸‹ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œä»¥åŠå¦‚ä½•é¿å…å¾ªç¯å¼•ç”¨å‡ ä¸ªè§’åº¦è¿›è¡Œä»‹ç»ã€‚\n\n### NSTimer å¦‚ä½•ä½¿ç”¨\n\n> A timer that fires after a certain time interval has elapsed, sending a specified message to a target object.\n>\n> ç¿»è¯‘ï¼šä¸€ç§è®¡æ—¶å™¨ï¼Œåœ¨ç»è¿‡ä¸€å®šçš„æ—¶é—´é—´éš”åè§¦å‘ï¼Œå‘ç›®æ ‡å¯¹è±¡å‘é€æŒ‡å®šçš„æ¶ˆæ¯ã€‚\n\n#### åˆ›å»º\n\n**NSTimer** æä¾›äº†ä¸‰ç§åˆ›å»ºæ–¹å¼ï¼š\n\n1. ä»¥ `scheduledTimerWithTimeInterval` ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹\n\n2. ä»¥ `timerWithTimeInterval` å¼€å¤´çš„åˆ›å»ºå®ä¾‹\n\n3. ä»¥ `init` æ–¹æ³•åˆå§‹åŒ–æ–¹æ³•åˆ›å»ºå®ä¾‹\n\nè‹¥é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºï¼Œä¼šä»¥ **default mode** æ–¹å¼è‡ªåŠ¨åŠ å…¥åˆ°å½“å‰çš„ **RunLoop** ä¸­ã€‚\n\nè‹¥é‡‡ç”¨ç¬¬äºŒã€ä¸‰ç§æ–¹å¼åˆ›å»ºï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨NSRunLoopå¯¹è±¡çš„ `addTimer:forMode:` æ–¹æ³•ã€‚\n\n```swift\nlet timer = Timer.init(timeInterval: 1.0, repeats: true) { timer in\n   print(\"This\")\n}\nRunLoop.main.add(timer, forMode: .default)\n```\n\n#### é”€æ¯\n\n`invalidate()` \n\nè¯¥æ–¹æ³•æ˜¯åœ¨å…¶åŠ å…¥çš„ **RunLoop** å¯¹è±¡ä¸­ç§»é™¤timerçš„å”¯ä¸€æ–¹æ³•ï¼ŒåŒæ—¶ä¼š **RunLoop** å¯¹è±¡ä¼šç§»é™¤å…¶å¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œè‹¥é…ç½®äº† **target** å’Œ **user info** å¯¹è±¡ï¼Œ **timer** ä¹Ÿä¼šç§»é™¤å¯¹è¿™äº›å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚\n\n### ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\n\n#### å¾ªç¯å¼•ç”¨\n\nè€ƒè™‘ä¸€ä¸ªå¸¸è§ä½¿ç”¨ **NSTimer** çš„åœºæ™¯ï¼šåœ¨ **ViewController** ä¸­å°† **timer** ä½œä¸ºå±æ€§ï¼Œè€Œ **timer** åœ¨åˆ›å»ºé‡‡ç”¨äº† **target-action** çš„æ–¹å¼ï¼Œæ ¹æ® **Apple** æ–‡æ¡£ï¼Œ**timer** ä¼šå¯¹ **target** äº§ç”Ÿå¼ºå¼•ç”¨ï¼Œè¿™å°±äº§ç”Ÿäº†æœ‰å‘ç¯ï¼Œå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œä¸‹å›¾æ˜¯ä¸Šä¾‹å¯¹è±¡å¼•ç”¨å›¾ï¼š\n\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817112104936.png\" alt=\"image-20210817112104936\" style=\"zoom:40%;\" />\n\n#### RunLoopæŒæœ‰timer\n\nè¿˜æ˜¯ä¸Šä¾‹çš„åœºæ™¯ï¼Œè‹¥åœ¨ **timer** åˆ›å»ºæ—¶ä¸é‡‡ç”¨ **target-action** ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è§£å†³äº†ï¼Ÿ\n\nç¡®å®å¯ä»¥è§£å†³ï¼Œä½†è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”±äº **RunLoop** å¯¹è±¡è¿˜æŒæœ‰ç€ **timer** å¯¹è±¡ï¼Œè¿™æ—¶ **ViewController** èƒ½è¢«æ­£å¸¸é‡Šæ”¾ï¼Œä½† **timer** çš„å¼•ç”¨è®¡æ•°ç”±äºä¸ä¸º **1** ï¼Œæ— æ³•è¢«é‡Šæ”¾ï¼Œè¿™ç§æƒ…å†µåªæ˜¯ **timer** æ— æ³•è¢«é‡Šæ”¾ï¼Œå¹¶ä¸ç®—å¾ªç¯å¼•ç”¨èŒƒç•´ï¼Œå½“ç„¶è‹¥ **RunLoop** å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œåˆ™è¿™ä¸ª **timer** ä¹Ÿä¼šè¢«é‡Šæ”¾æ‰ã€‚\n\n\n\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817145841853.png\" alt=\"image-20210817145841853\" style=\"zoom:40%;\" />\n\nå½“ç„¶æ­¤ä¸Šä¸¤ç§æƒ…å†µéƒ½æ˜¯å°† **timer** çš„ `repeat` å‚æ•°è®¾ç½®ä¸º `true` æ—¶ï¼Œè‹¥ä¸º `false` åˆ™åœ¨å®šæ—¶å™¨ç¬¬ä¸€æ¬¡è§¦å‘åï¼Œä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œå³ **RunLoop** ä¼šç§»é™¤å¯¹ **timer** çš„å¼ºå¼•ç”¨ï¼Œ **timer** ä¹Ÿä¼šç§»é™¤å¯¹ **target** å’Œ **user info** å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚\n\n### è§£å†³æ–¹æ¡ˆ\n\n#### åˆé€‚çš„æ—¶æœºè°ƒç”¨ `invalidate()`\n\nåœ¨ä¸Šæ–‡ä»‹ç»äº†`invalidate()` ï¼Œ æˆ‘ä»¬åªéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨ `invalidate()`å³å¯ã€‚\n\né‚£ä¹ˆä»€ä¹ˆæ˜¯åˆé€‚çš„æ—¶æœºå‘¢ï¼Ÿ\n\n1. è‹¥æ¸…æ¥šçŸ¥é“ä»€ä¹ˆæ—¶å€™ **timer** ä¸å†ä½¿ç”¨ï¼Œåˆ™åº”ç«‹å³è°ƒç”¨ã€‚\n2. è‹¥ä¸æ¸…æ¥šåˆ™åº”ç ´é™¤å¾ªç¯å¼•ç”¨ï¼Œæœ€ååœ¨ **ViewController** çš„ `deinit` ä¸­è¿›è¡Œè°ƒç”¨ã€‚\n\n#### é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\n\n1. é‡‡ç”¨ `weak` å…³é”®å­—ä¿®é¥° **timer** ï¼Œä½†éœ€é‡‡ç”¨`scheduledTimerWithTimeInterval` ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šå°† **timer** åŠ å…¥åˆ° **RunLoop** å¯¹è±¡ä¸­ï¼Œå¦åˆ™ç”±äº `weak` ä¿®é¥°ï¼Œ **timer** ä¼šè¢«è‡ªåŠ¨è®¾ä¸º`nil`ã€‚\n2. é‡‡ç”¨ `weak` å…³é”®å­—ä¿®é¥° **target** å¯¹è±¡ï¼Œä½†éœ€åœ¨ **block** ä¸­è¿›è¡Œä½¿ç”¨ï¼ŒåŸç†å¤§æ¦‚æ˜¯ **block** ä¸­çš„ **weakSelf** ç›¸å½“äºä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œè¿›è€Œé˜»æ­¢äº†å¾ªç¯å¼•ç”¨ã€‚\n3. é‡‡ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼Œè®©å…¶ä»–å¯¹è±¡æ‰¿æ‹… `target` è§’è‰²ï¼Œä»è€Œé˜»æ­¢å¾ªç¯å¼•ç”¨ã€‚\n4. åŸºäº **NSProxy** æ–¹å¼ï¼Œä¸ **3** ç±»ä¼¼ï¼Œé€šè¿‡å…¶ä»–å¯¹è±¡æ¥é˜»æ­¢å¾ªç¯å¼•ç”¨ï¼Œéœ€æ³¨æ„çš„æ˜¯ **NSProxy** æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚\n5. ä¹Ÿå¯ç›´æ¥ä½¿ç”¨ **Apple** æä¾›çš„æ–° **API**ï¼š\n\n```swift\nclass func scheduledTimer(withTimeInterval interval: TimeInterval, repeats: Bool, block: @escaping (Timer) -> Void) -> Timer\n\ninit(timeInterval interval: TimeInterval, repeats: Bool, block: @escaping (Timer) -> Void)\n\nconvenience init(fire date: Date, interval: TimeInterval, repeats: Bool, block: @escaping (Timer) -> Void)\n```\n\n\n\n> the timer itself is passed as the parameter to this block when executed to aid in avoiding cyclical referencesã€‚\n>\n> ç¿»è¯‘ï¼šåœ¨æ‰§è¡Œæ—¶ï¼Œå®šæ—¶å™¨æœ¬èº«ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªå—ï¼Œä»¥å¸®åŠ©é¿å…å¾ªç¯å¼•ç”¨ã€‚\n\n### å¼•ç”¨\n\n[iOSä¹‹NSTimerå¾ªç¯å¼•ç”¨çš„è§£å†³æ–¹æ¡ˆ](https://juejin.cn/post/6844903968250789896#heading-5)\n\n[iOSä¸­Timerå¾ªç¯å¼•ç”¨åŸå› åŠè§£å†³æ–¹æ¡ˆ](https://www.jianshu.com/p/e8fc6c2b3afa)\n\n[Appleæ–‡æ¡£ - NSTimer](https://developer.apple.com/documentation/foundation/nstimer/)\n\n","slug":"2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³","published":1,"date":"2021-09-29T08:14:33.312Z","updated":"2021-09-30T06:04:28.614Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckvko2j2n0009qezuccskefx3","content":"\n        <h3 id=\"å‰è¨€\"   >\n          <a href=\"#å‰è¨€\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3>\n      <p>æœ¬æ–‡å°†ä»å¦‚ä½•ä½¿ç”¨ <strong>NSTimer</strong> ã€ <strong>NSTimer</strong> ä½•ç§æƒ…å†µä¸‹ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œä»¥åŠå¦‚ä½•é¿å…å¾ªç¯å¼•ç”¨å‡ ä¸ªè§’åº¦è¿›è¡Œä»‹ç»ã€‚</p>\n\n        <h3 id=\"NSTimer-å¦‚ä½•ä½¿ç”¨\"   >\n          <a href=\"#NSTimer-å¦‚ä½•ä½¿ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#NSTimer-å¦‚ä½•ä½¿ç”¨\" class=\"headerlink\" title=\"NSTimer å¦‚ä½•ä½¿ç”¨\"></a>NSTimer å¦‚ä½•ä½¿ç”¨</h3>\n      <blockquote>\n<p>A timer that fires after a certain time interval has elapsed, sending a specified message to a target object.</p>\n<p>ç¿»è¯‘ï¼šä¸€ç§è®¡æ—¶å™¨ï¼Œåœ¨ç»è¿‡ä¸€å®šçš„æ—¶é—´é—´éš”åè§¦å‘ï¼Œå‘ç›®æ ‡å¯¹è±¡å‘é€æŒ‡å®šçš„æ¶ˆæ¯ã€‚</p>\n</blockquote>\n\n        <h4 id=\"åˆ›å»º\"   >\n          <a href=\"#åˆ›å»º\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#åˆ›å»º\" class=\"headerlink\" title=\"åˆ›å»º\"></a>åˆ›å»º</h4>\n      <p><strong>NSTimer</strong> æä¾›äº†ä¸‰ç§åˆ›å»ºæ–¹å¼ï¼š</p>\n<ol>\n<li><p>ä»¥ <code>scheduledTimerWithTimeInterval</code> ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹</p>\n</li>\n<li><p>ä»¥ <code>timerWithTimeInterval</code> å¼€å¤´çš„åˆ›å»ºå®ä¾‹</p>\n</li>\n<li><p>ä»¥ <code>init</code> æ–¹æ³•åˆå§‹åŒ–æ–¹æ³•åˆ›å»ºå®ä¾‹</p>\n</li>\n</ol>\n<p>è‹¥é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºï¼Œä¼šä»¥ <strong>default mode</strong> æ–¹å¼è‡ªåŠ¨åŠ å…¥åˆ°å½“å‰çš„ <strong>RunLoop</strong> ä¸­ã€‚</p>\n<p>è‹¥é‡‡ç”¨ç¬¬äºŒã€ä¸‰ç§æ–¹å¼åˆ›å»ºï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨NSRunLoopå¯¹è±¡çš„ <code>addTimer:forMode:</code> æ–¹æ³•ã€‚</p>\n<figure class=\"highlight swift\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> timer <span class=\"operator\">=</span> <span class=\"type\">Timer</span>.<span class=\"keyword\">init</span>(timeInterval: <span class=\"number\">1.0</span>, repeats: <span class=\"literal\">true</span>) &#123; timer <span class=\"keyword\">in</span></span><br><span class=\"line\">   <span class=\"built_in\">print</span>(<span class=\"string\">&quot;This&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">RunLoop</span>.main.add(timer, forMode: .default)</span><br></pre></td></tr></table></div></figure>\n\n\n        <h4 id=\"é”€æ¯\"   >\n          <a href=\"#é”€æ¯\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é”€æ¯\" class=\"headerlink\" title=\"é”€æ¯\"></a>é”€æ¯</h4>\n      <p><code>invalidate()</code> </p>\n<p>è¯¥æ–¹æ³•æ˜¯åœ¨å…¶åŠ å…¥çš„ <strong>RunLoop</strong> å¯¹è±¡ä¸­ç§»é™¤timerçš„å”¯ä¸€æ–¹æ³•ï¼ŒåŒæ—¶ä¼š <strong>RunLoop</strong> å¯¹è±¡ä¼šç§»é™¤å…¶å¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œè‹¥é…ç½®äº† <strong>target</strong> å’Œ <strong>user info</strong> å¯¹è±¡ï¼Œ <strong>timer</strong> ä¹Ÿä¼šç§»é™¤å¯¹è¿™äº›å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚</p>\n\n        <h3 id=\"ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\"   >\n          <a href=\"#ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\" class=\"headerlink\" title=\"ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\"></a>ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨</h3>\n      \n        <h4 id=\"å¾ªç¯å¼•ç”¨\"   >\n          <a href=\"#å¾ªç¯å¼•ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#å¾ªç¯å¼•ç”¨\" class=\"headerlink\" title=\"å¾ªç¯å¼•ç”¨\"></a>å¾ªç¯å¼•ç”¨</h4>\n      <p>è€ƒè™‘ä¸€ä¸ªå¸¸è§ä½¿ç”¨ <strong>NSTimer</strong> çš„åœºæ™¯ï¼šåœ¨ <strong>ViewController</strong> ä¸­å°† <strong>timer</strong> ä½œä¸ºå±æ€§ï¼Œè€Œ <strong>timer</strong> åœ¨åˆ›å»ºé‡‡ç”¨äº† <strong>target-action</strong> çš„æ–¹å¼ï¼Œæ ¹æ® <strong>Apple</strong> æ–‡æ¡£ï¼Œ<strong>timer</strong> ä¼šå¯¹ <strong>target</strong> äº§ç”Ÿå¼ºå¼•ç”¨ï¼Œè¿™å°±äº§ç”Ÿäº†æœ‰å‘ç¯ï¼Œå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œä¸‹å›¾æ˜¯ä¸Šä¾‹å¯¹è±¡å¼•ç”¨å›¾ï¼š</p>\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817112104936.png\" alt=\"image-20210817112104936\" style=\"zoom:40%;\" />\n\n\n        <h4 id=\"RunLoopæŒæœ‰timer\"   >\n          <a href=\"#RunLoopæŒæœ‰timer\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#RunLoopæŒæœ‰timer\" class=\"headerlink\" title=\"RunLoopæŒæœ‰timer\"></a>RunLoopæŒæœ‰timer</h4>\n      <p>è¿˜æ˜¯ä¸Šä¾‹çš„åœºæ™¯ï¼Œè‹¥åœ¨ <strong>timer</strong> åˆ›å»ºæ—¶ä¸é‡‡ç”¨ <strong>target-action</strong> ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è§£å†³äº†ï¼Ÿ</p>\n<p>ç¡®å®å¯ä»¥è§£å†³ï¼Œä½†è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”±äº <strong>RunLoop</strong> å¯¹è±¡è¿˜æŒæœ‰ç€ <strong>timer</strong> å¯¹è±¡ï¼Œè¿™æ—¶ <strong>ViewController</strong> èƒ½è¢«æ­£å¸¸é‡Šæ”¾ï¼Œä½† <strong>timer</strong> çš„å¼•ç”¨è®¡æ•°ç”±äºä¸ä¸º <strong>1</strong> ï¼Œæ— æ³•è¢«é‡Šæ”¾ï¼Œè¿™ç§æƒ…å†µåªæ˜¯ <strong>timer</strong> æ— æ³•è¢«é‡Šæ”¾ï¼Œå¹¶ä¸ç®—å¾ªç¯å¼•ç”¨èŒƒç•´ï¼Œå½“ç„¶è‹¥ <strong>RunLoop</strong> å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œåˆ™è¿™ä¸ª <strong>timer</strong> ä¹Ÿä¼šè¢«é‡Šæ”¾æ‰ã€‚</p>\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817145841853.png\" alt=\"image-20210817145841853\" style=\"zoom:40%;\" />\n\n<p>å½“ç„¶æ­¤ä¸Šä¸¤ç§æƒ…å†µéƒ½æ˜¯å°† <strong>timer</strong> çš„ <code>repeat</code> å‚æ•°è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œè‹¥ä¸º <code>false</code> åˆ™åœ¨å®šæ—¶å™¨ç¬¬ä¸€æ¬¡è§¦å‘åï¼Œä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œå³ <strong>RunLoop</strong> ä¼šç§»é™¤å¯¹ <strong>timer</strong> çš„å¼ºå¼•ç”¨ï¼Œ <strong>timer</strong> ä¹Ÿä¼šç§»é™¤å¯¹ <strong>target</strong> å’Œ <strong>user info</strong> å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚</p>\n\n        <h3 id=\"è§£å†³æ–¹æ¡ˆ\"   >\n          <a href=\"#è§£å†³æ–¹æ¡ˆ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#è§£å†³æ–¹æ¡ˆ\" class=\"headerlink\" title=\"è§£å†³æ–¹æ¡ˆ\"></a>è§£å†³æ–¹æ¡ˆ</h3>\n      \n        <h4 id=\"åˆé€‚çš„æ—¶æœºè°ƒç”¨-invalidate\"   >\n          <a href=\"#åˆé€‚çš„æ—¶æœºè°ƒç”¨-invalidate\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#åˆé€‚çš„æ—¶æœºè°ƒç”¨-invalidate\" class=\"headerlink\" title=\"åˆé€‚çš„æ—¶æœºè°ƒç”¨ invalidate()\"></a>åˆé€‚çš„æ—¶æœºè°ƒç”¨ <code>invalidate()</code></h4>\n      <p>åœ¨ä¸Šæ–‡ä»‹ç»äº†<code>invalidate()</code> ï¼Œ æˆ‘ä»¬åªéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨ <code>invalidate()</code>å³å¯ã€‚</p>\n<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯åˆé€‚çš„æ—¶æœºå‘¢ï¼Ÿ</p>\n<ol>\n<li>è‹¥æ¸…æ¥šçŸ¥é“ä»€ä¹ˆæ—¶å€™ <strong>timer</strong> ä¸å†ä½¿ç”¨ï¼Œåˆ™åº”ç«‹å³è°ƒç”¨ã€‚</li>\n<li>è‹¥ä¸æ¸…æ¥šåˆ™åº”ç ´é™¤å¾ªç¯å¼•ç”¨ï¼Œæœ€ååœ¨ <strong>ViewController</strong> çš„ <code>deinit</code> ä¸­è¿›è¡Œè°ƒç”¨ã€‚</li>\n</ol>\n\n        <h4 id=\"é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\"   >\n          <a href=\"#é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\" class=\"headerlink\" title=\"é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\"></a>é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯</h4>\n      <ol>\n<li>é‡‡ç”¨ <code>weak</code> å…³é”®å­—ä¿®é¥° <strong>timer</strong> ï¼Œä½†éœ€é‡‡ç”¨<code>scheduledTimerWithTimeInterval</code> ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šå°† <strong>timer</strong> åŠ å…¥åˆ° <strong>RunLoop</strong> å¯¹è±¡ä¸­ï¼Œå¦åˆ™ç”±äº <code>weak</code> ä¿®é¥°ï¼Œ <strong>timer</strong> ä¼šè¢«è‡ªåŠ¨è®¾ä¸º<code>nil</code>ã€‚</li>\n<li>é‡‡ç”¨ <code>weak</code> å…³é”®å­—ä¿®é¥° <strong>target</strong> å¯¹è±¡ï¼Œä½†éœ€åœ¨ <strong>block</strong> ä¸­è¿›è¡Œä½¿ç”¨ï¼ŒåŸç†å¤§æ¦‚æ˜¯ <strong>block</strong> ä¸­çš„ <strong>weakSelf</strong> ç›¸å½“äºä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œè¿›è€Œé˜»æ­¢äº†å¾ªç¯å¼•ç”¨ã€‚</li>\n<li>é‡‡ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼Œè®©å…¶ä»–å¯¹è±¡æ‰¿æ‹… <code>target</code> è§’è‰²ï¼Œä»è€Œé˜»æ­¢å¾ªç¯å¼•ç”¨ã€‚</li>\n<li>åŸºäº <strong>NSProxy</strong> æ–¹å¼ï¼Œä¸ <strong>3</strong> ç±»ä¼¼ï¼Œé€šè¿‡å…¶ä»–å¯¹è±¡æ¥é˜»æ­¢å¾ªç¯å¼•ç”¨ï¼Œéœ€æ³¨æ„çš„æ˜¯ <strong>NSProxy</strong> æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚</li>\n<li>ä¹Ÿå¯ç›´æ¥ä½¿ç”¨ <strong>Apple</strong> æä¾›çš„æ–° <strong>API</strong>ï¼š</li>\n</ol>\n<figure class=\"highlight swift\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">func</span> <span class=\"title\">scheduledTimer</span>(<span class=\"title\">withTimeInterval</span> <span class=\"title\">interval</span>: <span class=\"title\">TimeInterval</span>, <span class=\"title\">repeats</span>: <span class=\"title\">Bool</span>, <span class=\"title\">block</span>: @<span class=\"title\">escaping</span> (<span class=\"title\">Timer</span>) -&gt; <span class=\"title\">Void</span>) -&gt; <span class=\"title\">Timer</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">init</span>(<span class=\"title\">timeInterval</span> <span class=\"title\">interval</span>: <span class=\"title\">TimeInterval</span>, <span class=\"title\">repeats</span>: <span class=\"title\">Bool</span>, <span class=\"title\">block</span>: @<span class=\"title\">escaping</span> (<span class=\"title\">Timer</span>) -&gt; <span class=\"title\">Void</span>)</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">convenience</span> <span class=\"title\">init</span>(<span class=\"title\">fire</span> <span class=\"title\">date</span>: <span class=\"title\">Date</span>, <span class=\"title\">interval</span>: <span class=\"title\">TimeInterval</span>, <span class=\"title\">repeats</span>: <span class=\"title\">Bool</span>, <span class=\"title\">block</span>: @<span class=\"title\">escaping</span> (<span class=\"title\">Timer</span>) -&gt; <span class=\"title\">Void</span>)</span></span><br></pre></td></tr></table></div></figure>\n\n\n\n<blockquote>\n<p>the timer itself is passed as the parameter to this block when executed to aid in avoiding cyclical referencesã€‚</p>\n<p>ç¿»è¯‘ï¼šåœ¨æ‰§è¡Œæ—¶ï¼Œå®šæ—¶å™¨æœ¬èº«ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªå—ï¼Œä»¥å¸®åŠ©é¿å…å¾ªç¯å¼•ç”¨ã€‚</p>\n</blockquote>\n\n        <h3 id=\"å¼•ç”¨\"   >\n          <a href=\"#å¼•ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#å¼•ç”¨\" class=\"headerlink\" title=\"å¼•ç”¨\"></a>å¼•ç”¨</h3>\n      <p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://juejin.cn/post/6844903968250789896#heading-5\" >iOSä¹‹NSTimerå¾ªç¯å¼•ç”¨çš„è§£å†³æ–¹æ¡ˆ</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://www.jianshu.com/p/e8fc6c2b3afa\" >iOSä¸­Timerå¾ªç¯å¼•ç”¨åŸå› åŠè§£å†³æ–¹æ¡ˆ</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://developer.apple.com/documentation/foundation/nstimer/\" >Appleæ–‡æ¡£ - NSTimer</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n","site":{"data":{}},"excerpt":"","more":"\n        <h3 id=\"å‰è¨€\"   >\n          <a href=\"#å‰è¨€\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3>\n      <p>æœ¬æ–‡å°†ä»å¦‚ä½•ä½¿ç”¨ <strong>NSTimer</strong> ã€ <strong>NSTimer</strong> ä½•ç§æƒ…å†µä¸‹ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œä»¥åŠå¦‚ä½•é¿å…å¾ªç¯å¼•ç”¨å‡ ä¸ªè§’åº¦è¿›è¡Œä»‹ç»ã€‚</p>\n\n        <h3 id=\"NSTimer-å¦‚ä½•ä½¿ç”¨\"   >\n          <a href=\"#NSTimer-å¦‚ä½•ä½¿ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#NSTimer-å¦‚ä½•ä½¿ç”¨\" class=\"headerlink\" title=\"NSTimer å¦‚ä½•ä½¿ç”¨\"></a>NSTimer å¦‚ä½•ä½¿ç”¨</h3>\n      <blockquote>\n<p>A timer that fires after a certain time interval has elapsed, sending a specified message to a target object.</p>\n<p>ç¿»è¯‘ï¼šä¸€ç§è®¡æ—¶å™¨ï¼Œåœ¨ç»è¿‡ä¸€å®šçš„æ—¶é—´é—´éš”åè§¦å‘ï¼Œå‘ç›®æ ‡å¯¹è±¡å‘é€æŒ‡å®šçš„æ¶ˆæ¯ã€‚</p>\n</blockquote>\n\n        <h4 id=\"åˆ›å»º\"   >\n          <a href=\"#åˆ›å»º\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#åˆ›å»º\" class=\"headerlink\" title=\"åˆ›å»º\"></a>åˆ›å»º</h4>\n      <p><strong>NSTimer</strong> æä¾›äº†ä¸‰ç§åˆ›å»ºæ–¹å¼ï¼š</p>\n<ol>\n<li><p>ä»¥ <code>scheduledTimerWithTimeInterval</code> ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹</p>\n</li>\n<li><p>ä»¥ <code>timerWithTimeInterval</code> å¼€å¤´çš„åˆ›å»ºå®ä¾‹</p>\n</li>\n<li><p>ä»¥ <code>init</code> æ–¹æ³•åˆå§‹åŒ–æ–¹æ³•åˆ›å»ºå®ä¾‹</p>\n</li>\n</ol>\n<p>è‹¥é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºï¼Œä¼šä»¥ <strong>default mode</strong> æ–¹å¼è‡ªåŠ¨åŠ å…¥åˆ°å½“å‰çš„ <strong>RunLoop</strong> ä¸­ã€‚</p>\n<p>è‹¥é‡‡ç”¨ç¬¬äºŒã€ä¸‰ç§æ–¹å¼åˆ›å»ºï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨NSRunLoopå¯¹è±¡çš„ <code>addTimer:forMode:</code> æ–¹æ³•ã€‚</p>\n<figure class=\"highlight swift\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> timer <span class=\"operator\">=</span> <span class=\"type\">Timer</span>.<span class=\"keyword\">init</span>(timeInterval: <span class=\"number\">1.0</span>, repeats: <span class=\"literal\">true</span>) &#123; timer <span class=\"keyword\">in</span></span><br><span class=\"line\">   <span class=\"built_in\">print</span>(<span class=\"string\">&quot;This&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">RunLoop</span>.main.add(timer, forMode: .default)</span><br></pre></td></tr></table></div></figure>\n\n\n        <h4 id=\"é”€æ¯\"   >\n          <a href=\"#é”€æ¯\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é”€æ¯\" class=\"headerlink\" title=\"é”€æ¯\"></a>é”€æ¯</h4>\n      <p><code>invalidate()</code> </p>\n<p>è¯¥æ–¹æ³•æ˜¯åœ¨å…¶åŠ å…¥çš„ <strong>RunLoop</strong> å¯¹è±¡ä¸­ç§»é™¤timerçš„å”¯ä¸€æ–¹æ³•ï¼ŒåŒæ—¶ä¼š <strong>RunLoop</strong> å¯¹è±¡ä¼šç§»é™¤å…¶å¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œè‹¥é…ç½®äº† <strong>target</strong> å’Œ <strong>user info</strong> å¯¹è±¡ï¼Œ <strong>timer</strong> ä¹Ÿä¼šç§»é™¤å¯¹è¿™äº›å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚</p>\n\n        <h3 id=\"ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\"   >\n          <a href=\"#ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\" class=\"headerlink\" title=\"ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨\"></a>ä¸ºä½•ä¼šé€ æˆå¾ªç¯å¼•ç”¨</h3>\n      \n        <h4 id=\"å¾ªç¯å¼•ç”¨\"   >\n          <a href=\"#å¾ªç¯å¼•ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#å¾ªç¯å¼•ç”¨\" class=\"headerlink\" title=\"å¾ªç¯å¼•ç”¨\"></a>å¾ªç¯å¼•ç”¨</h4>\n      <p>è€ƒè™‘ä¸€ä¸ªå¸¸è§ä½¿ç”¨ <strong>NSTimer</strong> çš„åœºæ™¯ï¼šåœ¨ <strong>ViewController</strong> ä¸­å°† <strong>timer</strong> ä½œä¸ºå±æ€§ï¼Œè€Œ <strong>timer</strong> åœ¨åˆ›å»ºé‡‡ç”¨äº† <strong>target-action</strong> çš„æ–¹å¼ï¼Œæ ¹æ® <strong>Apple</strong> æ–‡æ¡£ï¼Œ<strong>timer</strong> ä¼šå¯¹ <strong>target</strong> äº§ç”Ÿå¼ºå¼•ç”¨ï¼Œè¿™å°±äº§ç”Ÿäº†æœ‰å‘ç¯ï¼Œå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œä¸‹å›¾æ˜¯ä¸Šä¾‹å¯¹è±¡å¼•ç”¨å›¾ï¼š</p>\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817112104936.png\" alt=\"image-20210817112104936\" style=\"zoom:40%;\" />\n\n\n        <h4 id=\"RunLoopæŒæœ‰timer\"   >\n          <a href=\"#RunLoopæŒæœ‰timer\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#RunLoopæŒæœ‰timer\" class=\"headerlink\" title=\"RunLoopæŒæœ‰timer\"></a>RunLoopæŒæœ‰timer</h4>\n      <p>è¿˜æ˜¯ä¸Šä¾‹çš„åœºæ™¯ï¼Œè‹¥åœ¨ <strong>timer</strong> åˆ›å»ºæ—¶ä¸é‡‡ç”¨ <strong>target-action</strong> ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è§£å†³äº†ï¼Ÿ</p>\n<p>ç¡®å®å¯ä»¥è§£å†³ï¼Œä½†è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”±äº <strong>RunLoop</strong> å¯¹è±¡è¿˜æŒæœ‰ç€ <strong>timer</strong> å¯¹è±¡ï¼Œè¿™æ—¶ <strong>ViewController</strong> èƒ½è¢«æ­£å¸¸é‡Šæ”¾ï¼Œä½† <strong>timer</strong> çš„å¼•ç”¨è®¡æ•°ç”±äºä¸ä¸º <strong>1</strong> ï¼Œæ— æ³•è¢«é‡Šæ”¾ï¼Œè¿™ç§æƒ…å†µåªæ˜¯ <strong>timer</strong> æ— æ³•è¢«é‡Šæ”¾ï¼Œå¹¶ä¸ç®—å¾ªç¯å¼•ç”¨èŒƒç•´ï¼Œå½“ç„¶è‹¥ <strong>RunLoop</strong> å¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œåˆ™è¿™ä¸ª <strong>timer</strong> ä¹Ÿä¼šè¢«é‡Šæ”¾æ‰ã€‚</p>\n<img src=\"/assets/2021-09-29-NSTimer å¾ªç¯å¼•ç”¨åˆ†æä¸è§£å†³/image-20210817145841853.png\" alt=\"image-20210817145841853\" style=\"zoom:40%;\" />\n\n<p>å½“ç„¶æ­¤ä¸Šä¸¤ç§æƒ…å†µéƒ½æ˜¯å°† <strong>timer</strong> çš„ <code>repeat</code> å‚æ•°è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œè‹¥ä¸º <code>false</code> åˆ™åœ¨å®šæ—¶å™¨ç¬¬ä¸€æ¬¡è§¦å‘åï¼Œä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œå³ <strong>RunLoop</strong> ä¼šç§»é™¤å¯¹ <strong>timer</strong> çš„å¼ºå¼•ç”¨ï¼Œ <strong>timer</strong> ä¹Ÿä¼šç§»é™¤å¯¹ <strong>target</strong> å’Œ <strong>user info</strong> å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚</p>\n\n        <h3 id=\"è§£å†³æ–¹æ¡ˆ\"   >\n          <a href=\"#è§£å†³æ–¹æ¡ˆ\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#è§£å†³æ–¹æ¡ˆ\" class=\"headerlink\" title=\"è§£å†³æ–¹æ¡ˆ\"></a>è§£å†³æ–¹æ¡ˆ</h3>\n      \n        <h4 id=\"åˆé€‚çš„æ—¶æœºè°ƒç”¨-invalidate\"   >\n          <a href=\"#åˆé€‚çš„æ—¶æœºè°ƒç”¨-invalidate\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#åˆé€‚çš„æ—¶æœºè°ƒç”¨-invalidate\" class=\"headerlink\" title=\"åˆé€‚çš„æ—¶æœºè°ƒç”¨ invalidate()\"></a>åˆé€‚çš„æ—¶æœºè°ƒç”¨ <code>invalidate()</code></h4>\n      <p>åœ¨ä¸Šæ–‡ä»‹ç»äº†<code>invalidate()</code> ï¼Œ æˆ‘ä»¬åªéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨ <code>invalidate()</code>å³å¯ã€‚</p>\n<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯åˆé€‚çš„æ—¶æœºå‘¢ï¼Ÿ</p>\n<ol>\n<li>è‹¥æ¸…æ¥šçŸ¥é“ä»€ä¹ˆæ—¶å€™ <strong>timer</strong> ä¸å†ä½¿ç”¨ï¼Œåˆ™åº”ç«‹å³è°ƒç”¨ã€‚</li>\n<li>è‹¥ä¸æ¸…æ¥šåˆ™åº”ç ´é™¤å¾ªç¯å¼•ç”¨ï¼Œæœ€ååœ¨ <strong>ViewController</strong> çš„ <code>deinit</code> ä¸­è¿›è¡Œè°ƒç”¨ã€‚</li>\n</ol>\n\n        <h4 id=\"é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\"   >\n          <a href=\"#é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\" class=\"headerlink\" title=\"é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯\"></a>é’ˆå¯¹å¾ªç¯å¼•ç”¨ï¼Œéœ€ç ´é™¤æœ‰å‘ç¯</h4>\n      <ol>\n<li>é‡‡ç”¨ <code>weak</code> å…³é”®å­—ä¿®é¥° <strong>timer</strong> ï¼Œä½†éœ€é‡‡ç”¨<code>scheduledTimerWithTimeInterval</code> ç±»æ–¹æ³•å¼€å¤´çš„åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šå°† <strong>timer</strong> åŠ å…¥åˆ° <strong>RunLoop</strong> å¯¹è±¡ä¸­ï¼Œå¦åˆ™ç”±äº <code>weak</code> ä¿®é¥°ï¼Œ <strong>timer</strong> ä¼šè¢«è‡ªåŠ¨è®¾ä¸º<code>nil</code>ã€‚</li>\n<li>é‡‡ç”¨ <code>weak</code> å…³é”®å­—ä¿®é¥° <strong>target</strong> å¯¹è±¡ï¼Œä½†éœ€åœ¨ <strong>block</strong> ä¸­è¿›è¡Œä½¿ç”¨ï¼ŒåŸç†å¤§æ¦‚æ˜¯ <strong>block</strong> ä¸­çš„ <strong>weakSelf</strong> ç›¸å½“äºä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œè¿›è€Œé˜»æ­¢äº†å¾ªç¯å¼•ç”¨ã€‚</li>\n<li>é‡‡ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼Œè®©å…¶ä»–å¯¹è±¡æ‰¿æ‹… <code>target</code> è§’è‰²ï¼Œä»è€Œé˜»æ­¢å¾ªç¯å¼•ç”¨ã€‚</li>\n<li>åŸºäº <strong>NSProxy</strong> æ–¹å¼ï¼Œä¸ <strong>3</strong> ç±»ä¼¼ï¼Œé€šè¿‡å…¶ä»–å¯¹è±¡æ¥é˜»æ­¢å¾ªç¯å¼•ç”¨ï¼Œéœ€æ³¨æ„çš„æ˜¯ <strong>NSProxy</strong> æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚</li>\n<li>ä¹Ÿå¯ç›´æ¥ä½¿ç”¨ <strong>Apple</strong> æä¾›çš„æ–° <strong>API</strong>ï¼š</li>\n</ol>\n<figure class=\"highlight swift\"><div class=\"table-container\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">func</span> <span class=\"title\">scheduledTimer</span>(<span class=\"title\">withTimeInterval</span> <span class=\"title\">interval</span>: <span class=\"title\">TimeInterval</span>, <span class=\"title\">repeats</span>: <span class=\"title\">Bool</span>, <span class=\"title\">block</span>: @<span class=\"title\">escaping</span> (<span class=\"title\">Timer</span>) -&gt; <span class=\"title\">Void</span>) -&gt; <span class=\"title\">Timer</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">init</span>(<span class=\"title\">timeInterval</span> <span class=\"title\">interval</span>: <span class=\"title\">TimeInterval</span>, <span class=\"title\">repeats</span>: <span class=\"title\">Bool</span>, <span class=\"title\">block</span>: @<span class=\"title\">escaping</span> (<span class=\"title\">Timer</span>) -&gt; <span class=\"title\">Void</span>)</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">convenience</span> <span class=\"title\">init</span>(<span class=\"title\">fire</span> <span class=\"title\">date</span>: <span class=\"title\">Date</span>, <span class=\"title\">interval</span>: <span class=\"title\">TimeInterval</span>, <span class=\"title\">repeats</span>: <span class=\"title\">Bool</span>, <span class=\"title\">block</span>: @<span class=\"title\">escaping</span> (<span class=\"title\">Timer</span>) -&gt; <span class=\"title\">Void</span>)</span></span><br></pre></td></tr></table></div></figure>\n\n\n\n<blockquote>\n<p>the timer itself is passed as the parameter to this block when executed to aid in avoiding cyclical referencesã€‚</p>\n<p>ç¿»è¯‘ï¼šåœ¨æ‰§è¡Œæ—¶ï¼Œå®šæ—¶å™¨æœ¬èº«ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªå—ï¼Œä»¥å¸®åŠ©é¿å…å¾ªç¯å¼•ç”¨ã€‚</p>\n</blockquote>\n\n        <h3 id=\"å¼•ç”¨\"   >\n          <a href=\"#å¼•ç”¨\" class=\"heading-link\"><i class=\"fas fa-link\"></i></a><a href=\"#å¼•ç”¨\" class=\"headerlink\" title=\"å¼•ç”¨\"></a>å¼•ç”¨</h3>\n      <p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://juejin.cn/post/6844903968250789896#heading-5\" >iOSä¹‹NSTimerå¾ªç¯å¼•ç”¨çš„è§£å†³æ–¹æ¡ˆ</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://www.jianshu.com/p/e8fc6c2b3afa\" >iOSä¸­Timerå¾ªç¯å¼•ç”¨åŸå› åŠè§£å†³æ–¹æ¡ˆ</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n<p><span class=\"exturl\"><a class=\"exturl__link\"   href=\"https://developer.apple.com/documentation/foundation/nstimer/\" >Appleæ–‡æ¡£ - NSTimer</a><span class=\"exturl__icon\"><i class=\"fas fa-external-link-alt\"></i></span></span></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ckvko2j290001qezucdkignnj","category_id":"ckvko2j2d0003qezueplv40vs","_id":"ckvko2j2f0006qezuf8ax5p72"},{"post_id":"ckvko2j2n0009qezuccskefx3","category_id":"ckvko2j2d0003qezueplv40vs","_id":"ckvko2j2o000bqezucpveasra"}],"PostTag":[{"post_id":"ckvko2j290001qezucdkignnj","tag_id":"ckvko2j2e0004qezugevkhrs2","_id":"ckvko2j2g0007qezu8lqlcslt"},{"post_id":"ckvko2j290001qezucdkignnj","tag_id":"ckvko2j2f0005qezufovc71fo","_id":"ckvko2j2g0008qezu8w9ddctk"},{"post_id":"ckvko2j2n0009qezuccskefx3","tag_id":"ckvko2j2o000aqezuhuao3fzk","_id":"ckvko2j2o000cqezu61d3hp9n"},{"post_id":"ckvko2j2n0009qezuccskefx3","tag_id":"ckvko2j2e0004qezugevkhrs2","_id":"ckvko2j2o000dqezud9or894q"}],"Tag":[{"name":"iOS","_id":"ckvko2j2e0004qezugevkhrs2"},{"name":"Compile","_id":"ckvko2j2f0005qezufovc71fo"},{"name":"NSTimer","_id":"ckvko2j2o000aqezuhuao3fzk"}]}}