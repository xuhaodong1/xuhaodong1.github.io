<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>iOSä¸­çš„å†…å­˜ç®¡ç†ï½œARC</title><meta name="description" content="ä¸ä»¥åŠŸåˆ©ä¸ºç›®çš„."><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q || []).push(arguments)},i[r].l=1 * new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'GmOiGEvbpJTlBAXAXlJZrGhRTZOlLBC_CZ2yJaZ_Ktk', 'https://www.nihao.cn/');
ga('send', 'pageview');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/avatar.jpeg"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="iOS é‡‡ç”¨ä»€ä¹ˆå†…å­˜ç®¡ç†æ–¹å¼åœ¨ iOS ä¸­ï¼Œé‡‡ç”¨è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆARCï¼ŒAutomatic Reference Countingï¼‰æœºåˆ¶æ¥è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œè®©ç¼–è¯‘å™¨æ¥å¸®åŠ©å†…å­˜ç®¡ç†ï¼Œæ— éœ€ç¨‹åºå‘˜æ‰‹åŠ¨é”®å…¥ retainã€release ç­‰ä»£ç è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç”±ç¼–è¯‘å™¨æ¥æ’å…¥ç›¸å…³å†…å­˜ç®¡ç†çš„ä»£ç ã€‚è¿™ä¸€ç‚¹çš„å¥½å¤„åœ¨äºèƒ½å¤Ÿé™ä½ç¨‹åºå´©æºƒã€å†…å­˜æ³„æ¼ç­‰é£é™©çš„åŒæ—¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šä¹Ÿèƒ½å¤Ÿå‡å°‘ç¨‹åºå‘˜çš„å·¥ä½œé‡ã€‚


ä¸å¼•ç”¨è®¡æ•°ç›¸å¯¹åº”çš„ï¼Œæ˜¯åƒåœ¾å›æ”¶ï¼ˆGCï¼ŒGarbage Collectionï¼‰æœºåˆ¶ï¼ŒJavaScriptã€Javaã€Golong ç­‰è¯­è¨€éƒ½é‡‡ç”¨è¿™ç§æœºåˆ¶è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå®ƒå°†æ‰€æœ‰çš„å¯¹è±¡çœ‹æˆä¸€ä¸ªé›†åˆï¼Œç„¶ååœ¨ GC å¾ªç¯ä¸­å®šæ—¶ç›‘æµ‹æ´»åŠ¨å¯¹è±¡å’Œéæ´»åŠ¨å¯¹è±¡ï¼ŒåŠæ—¶å°†è¿™äº›ç”¨ä¸åˆ°çš„éæ´»åŠ¨å¯¹è±¡é‡Šæ”¾ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚
ç›¸å¯¹äº GC æ¥è¯´ï¼Œå¼•ç”¨è®¡æ•°æ˜¯å±€éƒ¨çš„ï¼Œåœ¨.."><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="nihao' Blog" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">nihao's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">iOSä¸­çš„å†…å­˜ç®¡ç†ï½œARC</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS-%E9%87%87%E7%94%A8%E4%BB%80%E4%B9%88%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-text">iOS é‡‡ç”¨ä»€ä¹ˆå†…å­˜ç®¡ç†æ–¹å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-text">å†…å­˜ç®¡ç†çš„ç›¸å…³æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#alloc-amp-retain-amp-release-amp-dealloc-%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6"><span class="toc-text">alloc &amp; retain &amp; release &amp; dealloc æºç æ¢ç©¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#alloc"><span class="toc-text">alloc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#retain"><span class="toc-text">retain</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#release"><span class="toc-text">release</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dealloc"><span class="toc-text">dealloc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E8%A6%81%E5%9C%A8-init-%E5%92%8C-dealloc-%E4%B8%AD%E8%B0%83%E7%94%A8-accessor-%E6%96%B9%E6%B3%95"><span class="toc-text">ä¸è¦åœ¨ init å’Œ dealloc ä¸­è°ƒç”¨ accessor æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%97"><span class="toc-text">ğŸ”—</span></a></li></ol></div><div class="column is-9"><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">iOSä¸­çš„å†…å­˜ç®¡ç†ï½œARC</h1><header class="my-5"><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><i class="tag post-item-tag">å†…å­˜ç®¡ç†</i></a><time class="has-text-grey" datetime="2023-07-20T01:49:00.000Z">2023-07-20</time></header><article class="mt-2 post-content"><h2 id="iOS-é‡‡ç”¨ä»€ä¹ˆå†…å­˜ç®¡ç†æ–¹å¼"><a href="#iOS-é‡‡ç”¨ä»€ä¹ˆå†…å­˜ç®¡ç†æ–¹å¼" class="headerlink" title="iOS é‡‡ç”¨ä»€ä¹ˆå†…å­˜ç®¡ç†æ–¹å¼"></a>iOS é‡‡ç”¨ä»€ä¹ˆå†…å­˜ç®¡ç†æ–¹å¼</h2><p>åœ¨ iOS ä¸­ï¼Œé‡‡ç”¨è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆARCï¼ŒAutomatic Reference Countingï¼‰æœºåˆ¶æ¥è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œè®©ç¼–è¯‘å™¨æ¥å¸®åŠ©å†…å­˜ç®¡ç†ï¼Œæ— éœ€ç¨‹åºå‘˜æ‰‹åŠ¨é”®å…¥ retainã€release ç­‰ä»£ç è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç”±ç¼–è¯‘å™¨æ¥æ’å…¥ç›¸å…³å†…å­˜ç®¡ç†çš„ä»£ç ã€‚è¿™ä¸€ç‚¹çš„å¥½å¤„åœ¨äºèƒ½å¤Ÿé™ä½ç¨‹åºå´©æºƒã€å†…å­˜æ³„æ¼ç­‰é£é™©çš„åŒæ—¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šä¹Ÿèƒ½å¤Ÿå‡å°‘ç¨‹åºå‘˜çš„å·¥ä½œé‡ã€‚</p>
<span id="more"></span>

<p>ä¸å¼•ç”¨è®¡æ•°ç›¸å¯¹åº”çš„ï¼Œæ˜¯åƒåœ¾å›æ”¶ï¼ˆGCï¼ŒGarbage Collectionï¼‰æœºåˆ¶ï¼ŒJavaScriptã€Javaã€Golong ç­‰è¯­è¨€éƒ½é‡‡ç”¨è¿™ç§æœºåˆ¶è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå®ƒå°†æ‰€æœ‰çš„å¯¹è±¡çœ‹æˆä¸€ä¸ªé›†åˆï¼Œç„¶ååœ¨ GC å¾ªç¯ä¸­å®šæ—¶ç›‘æµ‹æ´»åŠ¨å¯¹è±¡å’Œéæ´»åŠ¨å¯¹è±¡ï¼ŒåŠæ—¶å°†è¿™äº›ç”¨ä¸åˆ°çš„éæ´»åŠ¨å¯¹è±¡é‡Šæ”¾ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚</p>
<p>ç›¸å¯¹äº GC æ¥è¯´ï¼Œå¼•ç”¨è®¡æ•°æ˜¯å±€éƒ¨çš„ï¼Œåœ¨è¿è¡Œæ—¶æ— éœ€é¢å¤–å¼€é”€ï¼ŒåŒæ—¶å…¶å†…å­˜å›æ”¶æ˜¯å¹³ç¨³ã€æ—¶æœºæ˜ç¡®çš„ï¼Œæ²¡æœ‰è¢«æŒæœ‰çš„å¯¹è±¡ä¼šè¢«ç«‹å³é‡Šæ”¾ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼è¿™ç§æ–°çš„å†…å­˜ç®¡ç†é—®é¢˜ã€‚</p>
<h2 id="å†…å­˜ç®¡ç†çš„ç›¸å…³æ“ä½œ"><a href="#å†…å­˜ç®¡ç†çš„ç›¸å…³æ“ä½œ" class="headerlink" title="å†…å­˜ç®¡ç†çš„ç›¸å…³æ“ä½œ"></a>å†…å­˜ç®¡ç†çš„ç›¸å…³æ“ä½œ</h2><p>å½“ç”Ÿæˆæ–°çš„å¯¹è±¡æ—¶ï¼Œå…¶å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå½“æœ‰å…¶ä»–æŒ‡é’ˆæŒæœ‰è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œå…¶å¼•ç”¨è®¡æ•°åŠ  1ï¼Œå½“å…¶ä»–æŒ‡é’ˆé‡Šæ”¾è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œå…¶å¼•ç”¨è®¡æ•°å‡ 1ï¼Œå½“è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º 0 æ—¶ï¼Œå¯¹è±¡ä¼šè¢«åºŸå¼ƒã€‚ä¸Šæ–‡ä¸­å‡ºç°çš„â€œç”Ÿæˆâ€ã€â€œæŒæœ‰â€ã€â€œé‡Šæ”¾â€ã€â€œåºŸå¼ƒâ€å¯¹åº”çš„ Objective-C çš„æ–¹æ³•å¦‚ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å¯¹è±¡æ“ä½œ</th>
<th>Objective-C æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡</td>
<td>alloc / new / copy / mutableCopy æ–¹æ³•</td>
</tr>
<tr>
<td align="left">æŒæœ‰å¯¹è±¡</td>
<td>retain æ–¹æ³•</td>
</tr>
<tr>
<td align="left">é‡Šæ”¾å¯¹è±¡</td>
<td>release æ–¹æ³•</td>
</tr>
<tr>
<td align="left">åºŸå¼ƒå¯¹è±¡</td>
<td>dealloc æ–¹æ³•</td>
</tr>
</tbody></table>
<p>åœ¨ MRC æœºåˆ¶ä¸‹ï¼Œç”±äºéœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨æ’å…¥ retainã€release ä»£ç ï¼Œæ— éœ€è€ƒè™‘å¼•ç”¨è®¡æ•°ï¼ŒæŒ‰å¦‚ä¸‹æ€è€ƒæ–¹å¼è¿›è¡Œä»£ç ç¼–å†™å°±å¯ä»¥ç®¡ç†å¥½å†…å­˜ï¼š</p>
<ul>
<li>è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æ‰€æŒæœ‰ã€‚</li>
<li>éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰ã€‚</li>
<li>ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾ã€‚</li>
<li>éè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ— æ³•é‡Šæ”¾ã€‚</li>
</ul>
<p>ä½† ARC ä¸­ï¼Œç”±äºäº¤ç»™äº†ç¼–è¯‘å™¨è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ç›¸å½“äºå¼ºå¼•ç”¨ï¼Œä½†è¿™ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œç”±äºå¼•ç”¨è®¡æ•°ä¸èƒ½è¾¾åˆ° 0ï¼Œå¯¼è‡´å¯¹è±¡æ— æ³•è¢«é‡Šæ”¾ï¼Œå› æ­¤å¼•å…¥äº†æ‰€æœ‰æƒä¿®é¥°ç¬¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><p><code>__strong</code>ï¼šå¯¹è±¡çš„é»˜è®¤æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œå®ƒè¡¨ç¤ºå¯¹å¯¹è±¡çš„â€œå¼ºå¼•ç”¨â€ï¼Œåœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶ï¼Œå¼ºå¼•ç”¨å¤±æ•ˆã€‚</p>
</li>
<li><p><code>__weak</code>ï¼šä½¿ç”¨ <code>__weak </code> ä¿®é¥°çš„å¯¹è±¡ä¸ä¼šæŒæœ‰å¯¹è±¡ï¼Œå› æ­¤ä¸ä¼šä½¿å¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŠ  1ï¼ŒåŒæ—¶å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡è¢«åºŸå¼ƒæ—¶ï¼Œå¼±å¼•ç”¨ä¼šæŒ‡å‘ nilï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥æ¥è§£å†³å¾ªç¯å¼•ç”¨çš„åœºæ™¯ã€‚</p>
</li>
<li><p><code>__unsafe_unretained</code>ï¼šä¸ <code>__weak</code> ç±»ä¼¼ï¼Œ<code>__unsafe_unretained</code> ä¿®é¥°çš„å¯¹è±¡ä¸ä¼šæŒæœ‰å¯¹è±¡ï¼Œä½†åœ¨æŒ‡å‘çš„å¯¹è±¡è¢«åºŸå¼ƒæ—¶ï¼Œä¸ä¼šæŒ‡å‘ nilï¼Œä¼šå˜æˆé‡æŒ‡é’ˆã€‚ä½¿ç”¨ <code>__unsafe_unretained</code> æ—¶éœ€è¦æ˜ç¡®æ¸…æ¥šå®ƒçš„ç”Ÿå‘½å‘¨æœŸå°äºæˆ–è€…ç­‰äºè¢«æŒ‡å‘å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¸ Swift ä¸­çš„ <code>unowned</code> ç±»ä¼¼ï¼ŒåŒæ—¶å®ƒçš„æ•ˆç‡ä¹Ÿæ¯” <code>__weak</code> é«˜ã€‚</p>
</li>
<li><p><code>__autoreleasing</code>ï¼šä½¿ç”¨ <code>__autoreleaseing</code> ä¿®é¥°çš„å¯¹è±¡ä¼šè¢«æ³¨å†Œåˆ° AutoReleasePool ä¸­ï¼Œä¼šå»¶è¿Ÿåˆ° AutoReleasePool è¢«é”€æ¯æ—¶æ‰ä¼šè°ƒç”¨å¯¹è±¡çš„ release æ–¹æ³•ï¼Œè¿™ä¼šå»¶é•¿å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ä½†ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–çš„åŸå› ï¼Œå®é™…ç”¨åˆ°çš„åœ°æ–¹æ˜¯å¾ˆå°‘çš„ã€‚</p>
</li>
</ul>
<blockquote>
<p>å¾ªç¯å¼•ç”¨ï¼šå¯¹è±¡é—´çš„ç›¸äº’å¼ºå¼•ç”¨äº§ç”Ÿæœ‰å‘ç¯ï¼Œå¯¼è‡´æœ‰å‘ç¯ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ— æ³•è¢«é‡Šæ”¾ï¼ˆæ²¡æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 0ï¼‰ï¼Œè¿›è€Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
<pre><code class="objective-c">// test æŒæœ‰è‡ªèº«å¯¼è‡´çš„å¾ªç¯å¼•ç”¨
id test = [[Test alloc] init];
[test setObject: test];
</code></pre>
</blockquote>
<h2 id="alloc-amp-retain-amp-release-amp-dealloc-æºç æ¢ç©¶"><a href="#alloc-amp-retain-amp-release-amp-dealloc-æºç æ¢ç©¶" class="headerlink" title="alloc &amp; retain &amp; release &amp; dealloc æºç æ¢ç©¶"></a>alloc &amp; retain &amp; release &amp; dealloc æºç æ¢ç©¶</h2><h3 id="alloc"><a href="#alloc" class="headerlink" title="alloc"></a><code>alloc</code></h3><p>å¯¹è±¡å†…å­˜åˆ†é…çš„ä¸»è¦é€»è¾‘é›†ä¸­åœ¨ <code>callAlloc</code> ä¸ <code>_class_createInstanceFromZone</code> æ–¹æ³•é‡Œã€‚ä¸ºäº†æå‡æ•ˆç‡ï¼Œå…¶åœ¨ <code>callAlloc</code> é‡Œåˆ¤æ–­äº† <code>hasCustomAWZ</code>ï¼ˆè‡ªå®šä¹‰çš„ allocWithZone æ–¹æ³•ï¼‰ï¼Œæ²¡æœ‰æ‰§è¡Œ <code>_objc_rootAllocWithZone</code>ï¼Œæœ‰åˆ™è¿›å…¥æ¶ˆæ¯æ´¾å‘ <code>allocWithZone</code>ã€‚NSZone å·²è¢«ç³»ç»Ÿå¿½ç•¥ï¼Œç”±äºå†å²é—ç•™åŸå› æ‰å¾—ä»¥ä¿ç•™ï¼Œå› æ­¤è™½ç„¶æœ‰è®¸å¤šè·³è½¬æµç¨‹ï¼Œä½†æœ€ç»ˆéƒ½ä¼šæŒ‡å‘ <code>_class_createInstanceFromZone</code> æ–¹æ³•ã€‚</p>
<pre><code class="objc">static ALWAYS_INLINE id
callAlloc(Class cls, bool checkNil, bool allocWithZone=false)
{
#if __OBJC2__
    if (slowpath(checkNil &amp;&amp; !cls)) return nil;
    if (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ())) {
        return _objc_rootAllocWithZone(cls, nil);
    }
#endif
  
    if (allocWithZone) {
        return ((id(*)(id, SEL, struct _NSZone *))objc_msgSend)(cls, @selector(allocWithZone:), nil);
    }
    return ((id(*)(id, SEL))objc_msgSend)(cls, @selector(alloc));
}
</code></pre>
<p><code>_class_createInstanceFromZone</code> ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼Œè·å–å¯¹è±¡å†…å­˜å ç”¨å¤§å°å¹¶åˆ†é…ã€è®¾ç½® <code>isa</code> æŒ‡é’ˆã€ä»¥åŠæ‰§è¡Œ C++ æ„é€ æ–¹æ³•ã€‚</p>
<p>è·å–å†…å­˜å ç”¨å¹¶åˆ†é…ï¼š<code>cls-&gt;instanceSize(extraBytes);</code> é€šè¿‡åœ¨ <code>cache</code> æˆ–è€… <code>ro()-&gt;instanceSize </code> (ç¼–è¯‘æ—¶ç¡®å®š)è·å–å ç”¨å†…å­˜ï¼Œå¹¶è¿›è¡Œå†…å­˜å¯¹é½ï¼Œæœ€åè°ƒç”¨ <code>calloc</code> æ–¹æ³•è¿›è¡Œå†…å­˜åˆ†é…ã€‚</p>
<p>è®¾ç½® <code>isa</code> æŒ‡é’ˆï¼šè®¾ç½®å¦‚ has_cxx_dtorï¼ˆæ˜¯å¦æœ‰ C++ ææ„å‡½æ•°ï¼‰ã€shiftclsï¼ˆç±»å¯¹è±¡æˆ–è€…å…ƒç±»å¯¹è±¡çš„åœ°å€ï¼‰ã€extra_rcï¼ˆå¼•ç”¨è®¡æ•°ï¼‰ ç­‰ä¿¡æ¯ã€‚</p>
<p>æ‰§è¡Œ C++ æ„é€ æ–¹æ³•ï¼šä»åŸºç±»å¼€å§‹å‘ä¸‹é€’å½’æ‰§è¡Œ C++ çš„æ„é€ å‡½æ•°ã€‚</p>
<pre><code class="objc">// ç®€åŒ–åä»£ç 
static ALWAYS_INLINE id
_class_createInstanceFromZone(Class cls, size_t extraBytes, void *zone,
                              int construct_flags = OBJECT_CONSTRUCT_NONE,
                              bool cxxConstruct = true,
                              size_t *outAllocatedSize = nil)
{
    bool hasCxxCtor = cxxConstruct &amp;&amp; cls-&gt;hasCxxCtor();
    bool hasCxxDtor = cls-&gt;hasCxxDtor();
    bool fast = cls-&gt;canAllocNonpointer();
    size_t size;

    // è·å–å®ä¾‹å˜é‡å†…å­˜å ç”¨å¤§å°
    size = cls-&gt;instanceSize(extraBytes);

    id obj;
    obj = (id)calloc(1, size);
       
    // è®¾ç½® isa æŒ‡é’ˆ
    obj-&gt;initInstanceIsa(cls, hasCxxDtor);

    if (fastpath(!hasCxxCtor)) {
        return obj;
    }

    construct_flags |= OBJECT_CONSTRUCT_FREE_ONFAILURE;
    // æ‰§è¡Œ C++ æ„é€ å‡½æ•°
    return object_cxxConstructFromClass(obj, cls, construct_flags);
}
</code></pre>
<blockquote>
<p>NSZoneï¼šå®ƒæ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜ç¢ç‰‡åŒ–è€Œå¼•å…¥çš„ç»“æ„ï¼Œå¯¹å†…å­˜åˆ†é…çš„åŒºåŸŸæœ¬èº«è¿›è¡Œå¤šé‡åŒ–ç®¡ç†ï¼Œæ ¹æ®ä½¿ç”¨å¯¹è±¡çš„ç›®çš„ã€å¯¹è±¡çš„å¤§å°åˆ†é…å†…å­˜ï¼Œä»è€Œæé«˜äº†å†…å­˜ç®¡ç†çš„æ•ˆç‡ã€‚ä½†ç›®å‰è¿è¡Œæ—¶ç³»ç»Ÿä¸­çš„å†…å­˜ç®¡ç†æœ¬èº«å·²æå…·æ•ˆç‡ï¼Œä½¿ç”¨ NSZone æ¥ç®¡ç†åè€Œä¼šå¼•èµ·å†…å­˜ä½¿ç”¨æ•ˆç‡ä½ä¸‹ä»¥åŠæºä»£ç å¤æ‚åŒ–ç­‰é—®é¢˜ï¼Œå› æ­¤è¿è¡Œæ—¶åªæ˜¯ç®€å•åœ°å¿½ç•¥äº† NSZone çš„æ¦‚å¿µã€‚</p>
</blockquote>
<h4 id="retain"><a href="#retain" class="headerlink" title="retain"></a>retain</h4><p>retain ä¼šå°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•° + 1ï¼Œå…¶ä¸»è¦é€»è¾‘ä¸»è¦é›†ä¸­åœ¨ rootRetain æ–¹æ³•ä¸­ï¼Œå¼•ç”¨è®¡æ•°ä¸€èˆ¬ä¼šå­˜å‚¨åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œé¦–å…ˆæ˜¯ isa æŒ‡é’ˆçš„ extra_rc åŸŸä¸­ï¼Œè‹¥æœ‰æº¢å‡ºåˆ™ä¼šå°†ä¸€åŠçš„å¼•ç”¨è®¡æ•°å€¼å­˜å‚¨åˆ° SideTable ä¸­ã€‚</p>
<pre><code class="objective-c">// ç®€åŒ–åä»£ç 
ALWAYS_INLINE id
objc_object::rootRetain(bool tryRetain, objc_object::RRVariant variant)
{
    bool sideTableLocked = false;
    bool transcribeToSideTable = false;

    isa_t oldisa;
    isa_t newisa;

    oldisa = LoadExclusive(&amp;isa.bits); // åŠ è½½ isa æŒ‡é’ˆ

    do {
        newisa = oldisa;

        uintptr_t carry;
        newisa.bits = addc(newisa.bits, RC_ONE, 0, &amp;carry);  // extra_rc++
          
        // è‹¥ newisa.extra_rc++ æº¢å‡ºï¼Œå†è°ƒç”¨ä¸€æ¬¡ï¼Œå°† variant è®¾ç½®ä¸º RRVariant::Full
        if (slowpath(carry)) {
            if (variant != RRVariant::Full) {
                ClearExclusive(&amp;isa.bits);
                return rootRetain_overflow(tryRetain);
            }
            // ç•™ä¸‹ä¸€åŠçš„å¼•ç”¨è®¡æ•°å€¼ï¼Œå¹¶å°†å¦ä¸€åŠæ‹·è´åˆ° SideTableä¸­
            if (!tryRetain &amp;&amp; !sideTableLocked) sidetable_lock();
            sideTableLocked = true;
            transcribeToSideTable = true;
            newisa.extra_rc = RC_HALF;
            newisa.has_sidetable_rc = true;
        }
    } while (slowpath(!StoreExclusive(&amp;isa.bits, &amp;oldisa.bits, newisa.bits)));

    if (variant == RRVariant::Full) {
        if (slowpath(transcribeToSideTable)) {
            // æ‹·è´ä¸€åŠçš„å¼•ç”¨è®¡æ•°å€¼åˆ° SideTable ä¸­
            sidetable_addExtraRC_nolock(RC_HALF);
        }

        if (slowpath(!tryRetain &amp;&amp; sideTableLocked)) sidetable_unlock();
    }

    return (id)this;
}
</code></pre>
<p>å…³äº SideTableï¼Œå…¶æœ¬èº«æ˜¯å…¨å±€çš„ SideTables() çš„ value å…ƒç´ ï¼Œkey åˆ™æ˜¯é€šè¿‡å¯¹è±¡æŒ‡é’ˆåœ°å€çš„åç§»æ˜ å°„ï¼Œæ‰¾åˆ°å±äºå¯¹è±¡çš„ SideTableï¼Œå†é€šè¿‡å¯¹è±¡çš„åœ°å€ï¼Œè·å¾—å±äºå¯¹è±¡çš„å¼•ç”¨è®¡æ•°è¡¨ã€‚å½“ SideTable ä¸­å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æº¢å‡ºæ—¶ï¼Œä¼šå°†æ ‡å¿—ä½ï¼ˆSIDE_TABLE_RC_PINNEDï¼‰ç½®ä¸º 1ã€‚</p>
<pre><code class="c++">// é€šè¿‡å¯¹è±¡çš„åœ°å€åç§»ä¸ StripeCount å¤§å°æ˜ å°„åˆ°å±äºå¯¹è±¡çš„ SideTable çš„ä¸‹æ ‡
static unsigned int indexForPointer(const void *p) {
    uintptr_t addr = reinterpret_cast&lt;uintptr_t&gt;(p);
    return ((addr &gt;&gt; 4) ^ (addr &gt;&gt; 9)) % StripeCount;
}
// åŠ å…¥é¢å¤–çš„å¼•ç”¨è®¡æ•°åˆ° SideTable ä¸­
bool 
objc_object::sidetable_addExtraRC_nolock(size_t delta_rc)
{
    SideTable&amp; table = SideTables()[this];

    size_t&amp; refcntStorage = table.refcnts[this];
    size_t oldRefcnt = refcntStorage;

    if (oldRefcnt &amp; SIDE_TABLE_RC_PINNED) return true;

    uintptr_t carry;
    size_t newRefcnt = 
        addc(oldRefcnt, delta_rc &lt;&lt; SIDE_TABLE_RC_SHIFT, 0, &amp;carry);
    if (carry) {
        refcntStorage =
            SIDE_TABLE_RC_PINNED | (oldRefcnt &amp; SIDE_TABLE_FLAG_MASK);
        return true;
    }
    else {
        refcntStorage = newRefcnt;
        return false;
    }
}
</code></pre>
<h4 id="release"><a href="#release" class="headerlink" title="release"></a>release</h4><p>ä¸ retain å¯¹åº”ï¼Œrelease æ–¹æ³•çš„ä¸»è¦é€»è¾‘é›†ä¸­åœ¨ rootRelease ä¸­ï¼Œå®ƒä¼šå°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•° - 1ï¼Œå¦‚æœå‘ç”Ÿä¸‹æº¢ï¼ˆunderflowï¼‰ï¼Œåˆ™ä¼šä» SideTable ä¸­å€Ÿå–ä¸€åŠå¼•ç”¨è®¡æ•°å€¼ï¼Œè‹¥å¼•ç”¨è®¡æ•°ä¸º 0 åˆ™é”€æ¯å¯¹è±¡ã€‚</p>
<pre><code class="c++">// ç®€åŒ–åä»£ç 
ALWAYS_INLINE bool
objc_object::rootRelease(bool performDealloc, objc_object::RRVariant variant)
{
    if (slowpath(isTaggedPointer())) return false;

    bool sideTableLocked = false;

    isa_t newisa, oldisa;

    oldisa = LoadExclusive(&amp;isa.bits);
retry:
    do {
        newisa = oldisa;

        uintptr_t carry;
        newisa.bits = subc(newisa.bits, RC_ONE, 0, &amp;carry);  // extra_rc--
        if (slowpath(carry)) { // å‘ç”Ÿä¸‹æº¢
            goto underflow;
        }
    } while (slowpath(!StoreReleaseExclusive(&amp;isa.bits, &amp;oldisa.bits, newisa.bits)));
    
    // é”€æ¯å¯¹è±¡
    if (slowpath(newisa.isDeallocating()))
        goto deallocate;

    return false;

 underflow:
    newisa = oldisa;

    if (slowpath(newisa.has_sidetable_rc)) {
        if (variant != RRVariant::Full) {
            ClearExclusive(&amp;isa.bits);
            return rootRelease_underflow(performDealloc);
        }
      
        auto borrow = sidetable_subExtraRC_nolock(RC_HALF);
                bool emptySideTable = borrow.remaining == 0;
      
        if (borrow.borrowed &gt; 0) {
            newisa.extra_rc = borrow.borrowed - 1;
            newisa.has_sidetable_rc = !emptySideTable;
        }
        if (emptySideTable)
                sidetable_clearExtraRC_nolock();
    }

deallocate:
    if (performDealloc) {
        ((void(*)(objc_object *, SEL))objc_msgSend)(this, @selector(dealloc));
    }
    return true;
}
</code></pre>
<h4 id="dealloc"><a href="#dealloc" class="headerlink" title="dealloc"></a>dealloc</h4><p>å¯¹è±¡å†…å­˜é‡Šæ”¾çš„ä¸»è¦é€»è¾‘é›†ä¸­åœ¨ <code>rootDealloc</code> ä¸ <code>objc_destructInstance</code> æ–¹æ³•é‡Œã€‚å…¶ä¸­ï¼ŒtaggedPointer å¯¹è±¡æ— éœ€é‡Šæ”¾(å…¶åœ¨æ ˆä¸Šå­˜å‚¨)ã€è‹¥åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶åˆ™ç›´æ¥ <code>free</code>ï¼Œå¦åˆ™è¿›å…¥ <code>objc_destructInstance</code>ã€‚</p>
<p><code>dealloc</code> åœ¨æ‰§è¡Œæœ€ç»ˆé‡Šæ”¾æ“ä½œï¼ˆreleaseï¼‰çš„é‚£ä¸ªçº¿ç¨‹ä¸­è¢«æ‰§è¡Œï¼Œè€Œä¸æ˜¯ä¸»çº¿ç¨‹ï¼›</p>
<p>åœ¨ <code>dealloc</code> ä¹Ÿä¸è¦ä½¿ç”¨ <code>__weak __typeof(self)weak_self = self</code> è¿™æ ·çš„ä»£ç ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ weak æ³¨å†Œæ—¶ä¼šåˆ¤æ–­å…¶æ˜¯å¦å¤„äº <code>deallocating</code> çŠ¶æ€ï¼Œä¼šäº§ç”Ÿå´©æºƒã€‚</p>
<ol>
<li><code>isa.nonpointer</code> ä¸º 1ï¼Œå³å­˜åœ¨ <code>ISA_BITFIELD</code> ä½åŸŸæ•°æ®</li>
<li>æ­¤å¯¹è±¡ä¸æ˜¯å…¶ä»–å¯¹è±¡çš„å¼±å¼•ç”¨å¯¹è±¡</li>
<li>æ­¤å¯¹è±¡æ²¡æœ‰å…³è”å¯¹è±¡</li>
<li>æ²¡æœ‰ C++ çš„ææ„å‡½æ•°</li>
<li>ä¸å­˜åœ¨ SideTable è®°å½•å¼•ç”¨è®¡æ•°</li>
</ol>
<pre><code class="objc">inline void
objc_object::rootDealloc()
{
    if (isTaggedPointer()) return;  // fixme necessary?
    if (fastpath(isa.nonpointer                     &amp;&amp;
                 !isa.weakly_referenced             &amp;&amp;
                 !isa.has_assoc                     &amp;&amp;
#if ISA_HAS_CXX_DTOR_BIT
                 !isa.has_cxx_dtor                  &amp;&amp;
#else
                 !isa.getClass(false)-&gt;hasCxxDtor() &amp;&amp;
#endif
                 !isa.has_sidetable_rc))
    {
        assert(!sidetable_present());
        free(this);
    } 
    else {
        object_dispose((id)this);
    }
}
</code></pre>
<p><code>objc_destructInstance</code> åˆ™æ˜¯æ¸…ç†å¯¹è±¡å…³è”çš„èµ„æºï¼ŒC++ çš„ææ„å‡½æ•°ã€å…³è”å¯¹è±¡ã€SideTable ä¸­çš„å¼±å¼•ç”¨æŒ‡é’ˆå’Œå¼•ç”¨è®¡æ•°è¡¨ï¼Œä¹‹åå† <code>free</code>ã€‚åœ¨ C++ ææ„å‡½æ•°ä¸­ï¼Œä¼šéå†å…¶æ‰€æœ‰çš„å®ä¾‹å˜é‡ï¼Œå½¢å¦‚ <code>objc_storeStrong(&amp;ivar, null)</code> è°ƒç”¨ï¼Œåˆ™ä¼šå¯¹æ‰€æœ‰çš„å®ä¾‹å˜é‡è¿›è¡Œ releaseï¼Œå¹¶å°†å…¶ç½®ä¸º nilã€‚åŒæ—¶ç»ç”±ç¼–è¯‘å™¨æ’å…¥ç±»ä¼¼ <code>[super dealloc]</code>ï¼Œåˆ™ä¼šå®ç°äº†ç”±å­ç±»å¼€å§‹éå†åˆ°åŸºç±»çš„ <code>dealloc</code>ã€‚</p>
<pre><code class="objc">void *objc_destructInstance(id obj) 
{
    if (obj) {
        // Read all of the flags at once for performance.
        bool cxx = obj-&gt;hasCxxDtor();
        bool assoc = obj-&gt;hasAssociatedObjects();

        // This order is important.
        if (cxx) object_cxxDestruct(obj);
        if (assoc) _object_remove_assocations(obj, /*deallocating*/true);
        obj-&gt;clearDeallocating();
    }
    return obj;
}
</code></pre>
<h2 id="ä¸è¦åœ¨-init-å’Œ-dealloc-ä¸­è°ƒç”¨-accessor-æ–¹æ³•"><a href="#ä¸è¦åœ¨-init-å’Œ-dealloc-ä¸­è°ƒç”¨-accessor-æ–¹æ³•" class="headerlink" title="ä¸è¦åœ¨ init å’Œ dealloc ä¸­è°ƒç”¨ accessor æ–¹æ³•"></a>ä¸è¦åœ¨ init å’Œ dealloc ä¸­è°ƒç”¨ accessor æ–¹æ³•</h2><p>åœ¨ <code>init</code>ã€å’Œ <code>dealloc</code> ä¸­ï¼Œè¿™ä¸ªé˜¶æ®µå¤„äºæœªå®Œå…¨åˆå§‹åŒ–æˆåŠŸæˆ–è€…æ­£åœ¨åºŸå¼ƒé˜¶æ®µï¼ŒåŒæ—¶ç”±äºç»§æ‰¿ã€å¤šæ€ç‰¹æ€§ï¼Œæœ¬æ¥ç›®çš„åˆ°è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•è°ƒç”¨åˆ°äº†å­ç±»ï¼Œå°±å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚åœ¨ init ä¸­ï¼š</p>
<pre><code class="objc">@interface BaseClass : NSObject
@property(nonatomic) NSString* info;
@end

@implementation BaseClass
- (instancetype)init {  
    if ([super init]) {
        self.info = @"baseInfo"; 
    } 
    return self;
}
@end

@interface SubClass : BaseClass
@end
@interface SubClass ()
@property (nonatomic) NSString* subInfo;
@end

@implementation SubClass
- (instancetype)init {
     if (self = [super init]) {
         self.subInfo = @"subInfo"; 
    } 
    return self;
}

- (void)setInfo:(NSString *)info {
    [super setInfo:info]; 
    NSString* copyString = [NSString stringWithString:self.subInfo]; NSLog(@"%@",copyString);
}
@end
</code></pre>
<p>è¿™æ—¶å€™åˆ›å»ºä¸€ä¸ª SubClass å®ä¾‹å˜é‡ï¼Œç”±äºç»§æ‰¿ã€å¤šæ€ç‰¹æ€§ä¼šè°ƒç”¨åˆ°å­ç±»çš„ <code>setInfo</code>ï¼Œå­ç±»çš„ accessor å®ç°çš„ä»£ç å®Œå…¨ä»¥å­ç±»å·²å®Œå…¨åˆå§‹åŒ–çš„å‰æç¼–å†™çš„ï¼Œæ­¤æ—¶çš„ <code>subInfo</code> è¿˜å¹¶æœªå®Œå…¨åˆå§‹åŒ–ï¼Œè¿›è€Œä¼šé€ æˆå´©æºƒã€‚</p>
<p>è¿™ä¸€ç‚¹ä¸ Swift ä¸­ï¼Œæ„é€ å™¨åœ¨ç¬¬ä¸€é˜¶æ®µæ„é€ å®Œæˆä¹‹å‰ï¼Œä¸èƒ½è°ƒç”¨ä»»ä½•å®ä¾‹æ–¹æ³•ï¼Œä¸èƒ½è¯»å–ä»»ä½•å®ä¾‹å±æ€§çš„å€¼ï¼Œä¸èƒ½å¼•ç”¨ <code>self</code> ä½œä¸ºä¸€ä¸ªå€¼ç±»ä¼¼ã€‚</p>
<p>ç¬¬ä¸€é˜¶æ®µï¼šç±»ä¸­çš„æ¯ä¸ªå­˜å‚¨å‹å±æ€§èµ‹ä¸€ä¸ªåˆå§‹å€¼ã€‚</p>
<p>ç¬¬äºŒé˜¶æ®µï¼šç»™æ¯ä¸ªç±»ä¸€æ¬¡æœºä¼šï¼Œåœ¨æ–°å®ä¾‹å‡†å¤‡ä½¿ç”¨ä¹‹å‰è¿›ä¸€æ­¥è‡ªå®šä¹‰å®ƒä»¬çš„å­˜å‚¨å‹å±æ€§ã€‚</p>
<p>ä¸¤æ®µå¼æ„é€ è¿‡ç¨‹çš„ä½¿ç”¨è®©æ„é€ è¿‡ç¨‹æ›´å®‰å…¨ï¼ŒåŒæ—¶åœ¨æ•´ä¸ªç±»å±‚çº§ç»“æ„ä¸­ç»™äºˆäº†æ¯ä¸ªç±»å®Œå…¨çš„çµæ´»æ€§ã€‚ä¸¤æ®µå¼æ„é€ è¿‡ç¨‹å¯ä»¥é˜²æ­¢å±æ€§å€¼åœ¨åˆå§‹åŒ–ä¹‹å‰è¢«è®¿é—®ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢å±æ€§è¢«å¦å¤–ä¸€ä¸ªæ„é€ å™¨æ„å¤–åœ°èµ‹äºˆä¸åŒçš„å€¼ã€‚</p>
<blockquote>
<p>åœ¨ã€ŠEffective Objective-C 2.0 ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„æœ‰æ•ˆ52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹ä¸­ä¹ŸæŒ‡å‡ºï¼š</p>
<p>åœ¨deallocé‡Œä¸è¦è°ƒç”¨å±æ€§çš„å­˜å–æ–¹æ³•ï¼Œå› ä¸ºæœ‰äººå¯èƒ½ä¼šè¦†å†™è¿™äº›æ–¹æ³•ï¼Œå¹¶äºå…¶ä¸­åšä¸€äº›æ— æ³•å†å›æ”¶é˜¶æ®µå®‰å…¨æ‰§è¡Œçš„æ“ä½œã€‚æ­¤å¤–ï¼Œå±æ€§å¯èƒ½æ­£å¤„äºâ€œé”®å€¼è§‚å¯Ÿâ€(Key-Value Observationï¼ŒKVO)æœºåˆ¶çš„ç›‘æ§ä¹‹ä¸‹ï¼Œè¯¥å±æ€§çš„è§‚å¯Ÿè€…(Observer)å¯èƒ½ä¼šåœ¨å±æ€§å€¼æ”¹å˜æ—¶â€œä¿ç•™â€æˆ–ä½¿ç”¨è¿™ä¸ªå³å°†å›æ”¶çš„å¯¹è±¡ã€‚è¿™ç§åšæ³•ä¼šä»¤è¿è¡ŒæœŸç³»ç»Ÿçš„çŠ¶æ€å®Œå…¨å¤±è°ƒï¼Œä»è€Œå¯¼è‡´ä¸€äº›è«åå…¶å¦™çš„é”™è¯¯ã€‚</p>
</blockquote>
<h2 id="ğŸ”—"><a href="#ğŸ”—" class="headerlink" title="ğŸ”—"></a>ğŸ”—</h2><p>[1] <a target="_blank" rel="noopener" href="https://book.douban.com/subject/24720270/">Objective-C é«˜çº§ç¼–ç¨‹ iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†</a></p>
<p>[2] <a target="_blank" rel="noopener" href="http://blog.sunnyxx.com/2014/04/02/objc_dig_arc_dealloc/">ARCä¸‹deallocè¿‡ç¨‹åŠ.cxxdestructçš„æ¢ç©¶</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://draveness.me/rr/">é»‘ç®±ä¸­çš„ retain å’Œ release</a></p>
<p>[4] <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1143323">ä¸ºä»€ä¹ˆä¸èƒ½åœ¨initå’Œdeallocå‡½æ•°ä¸­ä½¿ç”¨accessoræ–¹æ³•</a></p>
<p>[5] <a target="_blank" rel="noopener" href="https://swift.bootcss.com/02_language_guide/14_Initialization#memberwise-initializers-for-structure-types">Swiftæ„é€ è¿‡ç¨‹</a></p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2022/12/24/2022-12-24-nihao%E7%9A%842022%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" title="nihao' 2022å¹´ç»ˆæ€»ç»“"><span class="has-text-weight-semibold">Next: nihao' 2022å¹´ç»ˆæ€»ç»“</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xuhaodong1/xuhaodong1.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/xuhaodong1"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--></section><p> <span>PV:</span><span id="busuanzi_value_site_pv"></span><span>  UV: </span><span id="busuanzi_value_site_uv"></span></p><p><span>Copyright Â©</span><span> nihao 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>